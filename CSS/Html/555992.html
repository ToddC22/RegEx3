<header><h1>Changing Static IP Address of Client Computers to DHCP and Vice-Versa.</h1></header><div class='kb-notice-section section'>Nirmal Sharma MVP</div><div class='kb-notice-section section'><div class='kb-disclaimer-msi'>MICROSOFT CORPORATION AND/OR ITS RESPECTIVE SUPPLIERS MAKE NO REPRESENTATIONS ABOUT THE SUITABILITY, RELIABILITY, OR ACCURACY OF THE INFORMATION AND RELATED GRAPHICS CONTAINED HEREIN. ALL SUCH INFORMATION AND RELATED GRAPHICS ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND. MICROSOFT AND/OR ITS RESPECTIVE SUPPLIERS HEREBY DISCLAIM ALL WARRANTIES AND CONDITIONS WITH REGARD TO THIS INFORMATION AND RELATED GRAPHICS, INCLUDING ALL IMPLIED WARRANTIES AND CONDITIONS OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, WORKMANLIKE EFFORT, TITLE AND NON-INFRINGEMENT.  YOU SPECIFICALLY AGREE THAT IN NO EVENT SHALL MICROSOFT AND/OR ITS SUPPLIERS BE LIABLE FOR ANY DIRECT, INDIRECT, PUNITIVE, INCIDENTAL, SPECIAL, CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF USE, DATA OR PROFITS, ARISING OUT OF OR IN ANY WAY CONNECTED WITH THE USE OF OR INABILITY TO USE THE INFORMATION AND RELATED GRAPHICS CONTAINED HEREIN, WHETHER BASED ON CONTRACT, TORT, NEGLIGENCE, STRICT LIABILITY OR OTHERWISE, EVEN IF MICROSOFT OR ANY OF ITS SUPPLIERS HAS BEEN ADVISED OF THE POSSIBILITY OF DAMAGES.</div></div><div class='kb-summary-section section'><div class='indent'><span class='sbody-italic'>This article explains about changing Static IP address of client computers over the network.</span></div></div><div class='kb-moreinformation-section section'>Microsoft has already published an article to change Static IP address of client computers to DHCP (make DHCP Enable)&#160;over the network. <br>&#160;<br>The following article can be used to change&#160;all static clients to DHCP-aware <br>&#160;<br>.&#160;<br>&#160;<br>In deed, the above article is useful but it requires a lot of manual effort. You need to connect every computer through &quot;Remote Registry API&quot; and then change the required detail in registry for all computers.<br>&#160;<br>This is lengthy task when you need to do the manual work on more than 100 computers. I have pointed out a solution for&#160;this situation.<br>&#160;<br>Please follow the steps outlined here:<br>&#160;<br><ol class='sbody-num_list'><li>You need have the following tools handy before you can accomplish this:<br></li></ol>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; WininstLE<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PSEXEC<br>&#160;<br><ol class='sbody-num_list'><li>Using WININSTLE you need to find out the registry keys for DHCP Client machine when they obtain IP Address automatically from DHCP Server.<br></li><li>Using PSEXEC (if your network is in Workgroup Security Model)&#160;or Group Policy (If you are in Domain Security Model) to deploy DHCP Client settings remotely with a text file pre-configured which can be used to differentiate between IP addresses used by client machines.<br></li><li>You need to install and run WinInstLE on one of your client computer.<br></li><li>Go to a client machine.<br></li><li>Install WININSTLE. This utility is located at Windows 2000 CD.<br></li><li>Run WININSTLE. Perform *Before Snapshot* operation.<br></li><li>Give a path to save MSI file and registry informations.<br></li><li>Restart client computer.<br></li><li>Configure client machine to <strong class='sbody-strong'>obtain IP address automatically from DHCP Server</strong>.<br></li><li>After restarting client computer, run *After Snapshot*. This will record any changes made during the operation DHCP Client contacted and received&#160;IP Address information from DHCP Server.<br></li><li>Edit the *.REG file and delete the IP Address DHCP Client received&#160;from DHCP Server. This will make sure that all the client computers use unique IP Address on network. Save this file.<br></li><li>Now you have two files to deploy either using PSEXEC or Group Policy.<br></li><li>&#160;&#160;&#160;&#160;&#160;&#160; MSI file<br></li><li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;REG file<br></li><li>You can deploy&#160;MSI file (that is the configuration of DHCP Client) using Group Policy Software Installation snap-in. OR<br></li><li>You can deploy&#160;MSI file or REG file using PSEXEC remotely on all client computers. <br></li></ol>&#160;<br>By using PSEXEC you can specify a text file&#160;which keeps information about the IP Address and Client computer name.<br>&#160;<br>Now you need to put everything together to get things working. This is how you do it:<br>&#160;<br><strong class='sbody-strong'>Note: The only unique filed required in DHCP Configuration is IP Address.</strong><br>&#160;<br><ol class='sbody-num_list'><li>You have got a REG file with you from WININSTLE. Edit this REG file and remove the IP Address value. I think you have already done in above steps.<br></li><li>Save this REG file. <br></li><li>Copy the full MSI folder to server from where you want to deploy DHCP settings.<br></li><li>Deploy&#160;MSI file using Software Installation snap-in.<br></li><li>After deploying MSI file all configuration settings will be saved in all client computers except IP Address.<br></li><li>Next client computers will restart they will obtain IP Address from DHCP Server.<br></li></ol>&#160;<br>Note:&#160;If you want to enable DHCP for other connection specify the name of connection in netsh command.<br>&#160;<br><strong class='sbody-strong'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; netsh interface ip set address &quot;Local Area Connection&quot; dhcp</strong><br>&#160;<br>This should work well. <br><strong class='sbody-strong'></strong>&#160;<br><strong class='sbody-strong'>SUMMARY: - </strong><br><strong class='sbody-strong'></strong>&#160;<br>The following is required for client to be a DHCP Client when configuring manually: <br>&#160;<br>DHCP Client service should be started.<br>&#160;<br>Client LAN connection should be set to *Obtain IP from DHCP Server*.<br>&#160;<br>netsh interface ip set address &quot;Local Area Connection&quot; dhcp<br>&#160;<br>DHCP Client must have a unique IP Address on network.<br>&#160;<br>Some registry entries as described in the above article must be set.<br>&#160;<br>HKLM\SYSTEM\CurrentControlSet\Services\XXXXXX\Parameters\TCPIP, where XXXXXX is the value of ServiceName found in the step 3 in the above article.<br>EnableDHCP = 1<br>IPAddress = 0.0.0.0<br>SubnetMask = 0.0.0.0<br>DHCPDefaultGateway = 192.168.0.1 -- If you are using some other gateway then you need to put it in script or manually in registry.<br>DHCPIPAddress = 192.168.0.5 --- IP got from DHCP server.<br>DHCPServer = 192.168.0.1 -- IP Address of DHCP server.<br>&#160;<br>You don not need to restart workstation. Simply restart <strong class='sbody-strong'>DHCP Client service</strong> on destination computer using a&#160;script.<br>&#160;<br>&#160;<br></div>