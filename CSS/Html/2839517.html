<header><h1>Outlook is unable to connect to Exchange 2013 public folder or auto-mapped mailbox</h1></header><div class='kb-symptoms-section section'>When you use Microsoft Office Outlook 2007, Microsoft Outlook 2010, or Microsoft Outlook 2013 to connect to a Microsoft Exchange Server 2013 public folder or to an auto-mapped mailbox, you see the following error: <br><div class='indent'><div class='sbody-error'>Cannot expand the folder. Microsoft Exchange is not available. Either there are network problems or the Exchange server is down for maintenance.</div></div>Additionally, you may see a credentials prompt if the Exchange Server administrator set ExternalAuthentication to Basic.</div><div class='kb-cause-section section'>Exchange Server 2013 introduced separate internal and external client settings for Outlook Anywhere connectivity. Outlook uses the external namespace to connect to alternate mailboxes, even though Outlook is located on the internal network. Alternate mailboxes include auto-mapped mailboxes and public folders. </div><div class='kb-resolution-section section'>For Outlook 2013, this issue is fixed in the August 13, 2013 hotfix package. For more information about obtaining the hotfix package, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-1' href='/en-us/help/2817347'>2817347 </a>   Description of the Outlook 2013 hotfix package (Outlook-x-none.msp; Outlookintl-en-us.msp): August 13, 2013 </div>BUG #: <a href='http://bugcheck/bugs/Office15/3357654.asp' title='Link only available for Microsoft corporate network users' target='_blank'>3357654 (Office15)</a><br><br>For Outlook 2010, this issue is fixed in the June 11, 2013 hotfix package. For more information about obtaining the hotfix package, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-2' href='/en-us/help/2817371'>2817371 </a>  Description of the Outlook 2010 hotfix package (Outlook-x-none.msp): June 11, 2013 </div>BUG #: <a href='http://bugcheck/bugs/Office14/892756.asp' title='Link only available for Microsoft corporate network users' target='_blank'>892756 (Office14)</a><br><br>For Outlook 2007, this issue is fixed in the August 13, 2013 hotfix package. For more information about obtaining this hotfix package, click the following article number to view the article in the Microsoft Knowledge Base: &#160;<div class='indent'><a id='kb-link-3' href='/en-us/help/2768023'>2768023 </a>   Description of the Outlook 2007 update: August 13, 2013 </div>BUG #: <a href='http://bugcheck/bugs/Office12/856778.asp' title='Link only available for Microsoft corporate network users' target='_blank'>856778 (Office12)</a><br><br></div><div class='kb-moreinformation-section section'>For more information about the Autodiscover service, view the following Microsoft TechNet article:<br><div class='indent'><a id='kb-link-4' href='http://technet.microsoft.com/library/bb124251.aspx' target='_self'>Autodiscover Service</a></div>The internal part of the Autodiscover response typically looks as follows:<br><br><div class='sbody-code'><pre><code>&lt;Type&gt;EXHTTP&lt;/Type&gt;<br>&lt;Server&gt;exch1.contoso.com&lt;/Server&gt;<br>&lt;SSL&gt;Off&lt;/SSL&gt;<br>&lt;AuthPackage&gt;NTLM&lt;/AuthPackage&gt;<br>&lt;ASUrl&gt;https://exch1.contoso.com/EWS/Exchange.asmx&lt;/ASUrl&gt;<br>&lt;EwsUrl&gt;https://exch1.contoso.com/EWS/Exchange.asmx&lt;/EwsUrl&gt;<br>&lt;OOFUrl&gt;https://exch1.contoso.com/EWS/Exchange.asmx&lt;/OOFUrl&gt;<br>&lt;OABUrl&gt;https://exch1.contoso.com/OAB/9f2dd03f-064b-4356-b0d0-6789c44ebf29/&lt;/OABUrl&gt;<br>&lt;/Protocol&gt;</code></pre></div>The external part of the Autodiscover response typically looks as follows:<br><div class='sbody-code'><pre><code>&lt;Protocol&gt;&lt;Type&gt;EXHTTP&lt;/Type&gt;<br>&lt;Server&gt;mail.contoso.com&lt;/Server&gt;<br>&lt;SSL&gt;On&lt;/SSL&gt;<br>&lt;AuthPackage&gt;Ntlm&lt;/AuthPackage&gt;<br>&lt;ASUrl&gt;https://mail.contoso.com/EWS/Exchange.asmx&lt;/ASUrl&gt;<br>&lt;EwsUrl&gt;https://mail.contoso.com/EWS/Exchange.asmx&lt;/EwsUrl&gt;<br>&lt;OOFUrl&gt;https://mail.contoso.com/EWS/Exchange.asmx&lt;/OOFUrl&gt;<br>&lt;/Protocol&gt;</code></pre></div><br>In this example, the first entry represents InternalHostname and is set to <span class='sbody-italic'>exch1.contoso.com</span>. The second entry represents ExternalHostname and is set to <span class='sbody-italic'>mail.contoso.com</span>.<br><br>Outlook generally tries to connect with the first EXHTTP block. If that connection fails, Outlook then tries to connect by using the second EXHTTP block. By default, Outlook uses this logic for the primary mailbox. However, it incorrectly skips to the second EXHTTP block for alternate mailbox connections.</div><div class="kb-securedata-section section">Steps to reproduce:<br>
1) Create two mailboxes on Exchange 2013 server, primary and auto<br>
2) Assign Full Mailbox access on Auto mailbox to Primary with Auto mapping enabled (this is default)<br>
Add-MailboxPermission auto -User Primary -AccessRights FullAccess -AutoMapping $true<br>
3) Configure below kind of settings for E15 Outlook Anywhere, make sure the externalhostname is different than internalhostname.<br>
Example:<br>
[PS] C:\Windows\system32&gt;Get-OutlookAnywhere | fl *hostname*<br>
ExternalHostname : mail.contoso.com<br>
InternalHostname : exch1.contoso.com<br>
4) Login to a domain joined Outlook client using Primary user configure profile in &quot;online mode&quot;<br>
5) Launch Outlook with &quot;outlook /rpcdiag&quot; switch<br>
6) Observe the difference in URL Outlook uses to connect to Primary Vs. Auto mailbox<br>
<br>
Product Bug Number: Office15:3231769; Office15:3225002, MCExchangeTAP:1587, Office14:892756,<br>
Author ID (email alias): batre<br>
Writer ID (email alias): aruiz<br>
Tech Review ID (email alias): billja;sercast<br>
Confirm Article has been Tech Reviewed: Yes<br>
Confirm Article released for Publishing: Yes</div>
