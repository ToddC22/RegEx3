<header><h1>Error message when you start a PXE client to connect to a WDS server on a Windows Server 2003 SP1-based computer or on a Windows Server 2008-based computer: &quot;WdsClient: An error occurred while starting networking&quot;</h1></header><div class='kb-notice-section section'>BUG #: <a href='http://bugcheck/bugs/ContentMaintenance/60406.asp' title='Link only available for Microsoft corporate network users' target='_blank'>60406 (Content Maintenance)</a></div><div class='kb-symptoms-section section'>Consider the following scenario. You start a Pre-boot execution Environment (PXE) client to connect to a Microsoft Windows Server 2003 Service Pack 1 (SP1)-based computer running Windows Deployment Service (WDS) or a Windows Server 2008-based computer that has the WDS role installed. In this scenario, you  receive an error message that resembles the following:<div class='sbody-error'>WdsClient: An error occurred while starting networking: a matching network card driver was not found in this image. Please have your Administrator add the network driver for this machine to the Windows PE image on the Windows Deployment Services server.<br><br></div></div><div class='kb-cause-section section'>This issue  occurs if the WDS boot image does not contain a network driver for your third-party network adapter.</div><div class='kb-resolution-section section'>To resolve this issue, follow these steps:<ol class='sbody-num_list'><li>Find the network driver that is missing from the WDS boot image. To do this, follow these steps:<ol class='sbody-alpha_list'><li>When you receive the error message that is mentioned in the &quot;Symptoms&quot; section, press SHIFT+F10  to open a command prompt.</li><li>At the command prompt, type the  following command:<div class='indent'><span class='sbody-userinput'>Notepad.exe x:\Windows\INF\setupapi.app.log</span></div></li><li>In the Setupapi.app.log file that is displayed,locate the section that identifies the Plug and Play ID (PnPID) of the third-party network adapter. For example, &quot;DIF_SELECTBESTCOMPATDRV - PCI\VEN_10B7&amp;DEV_9200&amp;SUBSYS_010D1028&quot; is the section that identifies the PnPID of the network adapter in the following Setupapi.app.log file:<div class='sbody-code'><pre><code>&gt;&gt;&gt;  [DIF_SELECTBESTCOMPATDRV - PCI\VEN_10B7&amp;DEV_9200&amp;SUBSYS_010D1028&amp;REV_78\4&amp;19FD8D60&amp;0&amp;60F0]<br>&gt;&gt;&gt;  Section start 2006/05/05 12:42:59.281<br>      cmd: X:\Sources\setup.exe <br>     dvi: No class installer for &#39;Ethernet Controller&#39;<br>     dvi: No CoInstallers found<br>     dvi: Default installer: Enter<br>     dvi:      {Select Best Driver}<br>!    dvi:           Selecting driver failed(0xe0000228)<br>     dvi:      {Select Best Driver - exit(0xe0000228)}<br>!    dvi: Default installer: failed!<br>!    dvi: Error 0xe0000228: There are no compatible drivers for this device.<br>&lt;&lt;&lt;  Section end 2006/05/05 12:42:59.296<br>&lt;&lt;&lt;  [Exit status: FAILURE(0xe0000228)]<br></code></pre></div></li><li>Locate the correct driver for the  network adapter that you identified in step 1c. Then, copy the driver onto a floppy disk or onto a universal serial bus (USB) flash drive.</li></ol></li><li>Manually load the network driver, and then verify that it is the correct driver. To do this, follow these steps:<ol class='sbody-alpha_list'><li>At a command prompt, type the following command, and then press ENTER:<div class='indent'><span class='sbody-userinput'>drvload <strong class='sbody-strong'>driver</strong>.inf</span></div><span class='text-base'>Notes</span><ul class='sbody-free_list'><li><strong class='sbody-strong'>Driver</strong>.inf is the name of the third-party network driver.</li><li>You have to specify the full path and the name of the driver. For example, if <strong class='sbody-strong'>Driver</strong>.inf is on a CD, and the CD drive  is drive D,  type the following command, and then press ENTER: <div class='indent'><span class='sbody-userinput'>drvload.exe d:\<strong class='sbody-strong'>Folder</strong>\<strong class='sbody-strong'>Driver</strong>.inf</span></div></li></ul></li><li>Type <span class='sbody-userinput'>wpeutil InitializeNetwork</span>, and then press ENTER.</li><li>To verify network connectivity, type <span class='sbody-userinput'>ipconfig /all</span>.<br><br><span class='text-base'>Note</span> The <span class='text-base'>ipconfig /all</span> command generates a detailed configuration report for all interfaces that include any remote access adapters.</li></ol></li><li>Update the WDS boot image to include the new third-party network driver. To do this, follow these steps.<br><br><span class='text-base'>Note</span> The following procedure  assumes that the Windows Automated Installation Kit (AIK) is installed on the WDS server.  If the Windows AIK is not installed on the WDS server, you can perform the same procedure on another computer that does have the Windows AIK installed. Then, map a network drive to the WDS server.<ol class='sbody-alpha_list'><li>On the WDS server, click <strong class='uiterm'>Start</strong>, click <strong class='uiterm'>Run</strong>, type <span class='sbody-userinput'>wdsmgmt.msc</span>, and then press <strong class='uiterm'>OK</strong>.</li><li>Under your WDS server, double-click <strong class='uiterm'>Boot images</strong>.</li><li>Right-click the boot image that you want, and then click <strong class='uiterm'>Disable</strong>.</li><li>Right-click the same boot image, click <strong class='uiterm'>Properties</strong>, and then click <strong class='uiterm'>General</strong>.</li><li>Note the name and location of the boot image that is displayed in the <strong class='uiterm'>File name</strong> box.</li><li>At a command prompt, type the following:<div class='indent'><span class='sbody-userinput'>C:\program files\windows aik\tools\petools\copype.cmd x86 c:\windowspe-x86<br><br></span><span class='text-base'>Note</span>  Keep this command prompt window open for the next step.<br><span class='sbody-userinput'>Imagex /info <strong class='sbody-strong'>Drive:</strong>\remoteinstall\boot\x86\images\<strong class='sbody-strong'>boot</strong>.wim</span></div><span class='text-base'>Notes </span><ul class='sbody-free_list'><li><strong class='sbody-strong'>Drive</strong>:\remoteinstall represents the path at which the Remoteinstall folder is installed.</li><li><strong class='sbody-strong'> Boot</strong>.wim is the name of the boot image.</li></ul></li><li>Note the boot index number of the bootable image that is displayed. To identify the boot index number, locate the line that contains &quot;boot index: <strong class='sbody-strong'>X</strong>.&quot;<br><br><span class='text-base'>Note </span><strong class='sbody-strong'>X</strong> is the boot index number. The number indicates that image number <strong class='sbody-strong'>X</strong> is marked as bootable and that the image  is to be updated. The second image is the default image that you would typically modify. However, always verify which image is marked as bootable.</li><li>At a command prompt, type the following:<div class='indent'><span class='sbody-userinput'>Imagex /mountrw <strong class='sbody-strong'>Drive</strong>:\remoteinstall\boot\x86\images\boot.wim 2 mount<br><br>peimg /inf=driver.inf mount\Windows<br>imagex /unmount /commit mount</span></div><span class='text-base'>Notes</span><ul class='sbody-free_list'><li><strong class='sbody-strong'>Drive</strong>:\remoteinstall represents the path at which the Remoteinstall folder is installed.</li><li><strong class='sbody-strong'>Driver</strong>.inf is the name of the third-party driver.</li><li>The <span class='sbody-userinput'>Imagex /mountrw</span> command mounts the specified image, with read/write permissions, to the specified directory.</li></ul></li></ol></li><li>Enable the boot image on the WDS server. To do this, follow these steps:<ol class='sbody-alpha_list'><li>On the WDS server, click <strong class='uiterm'>Start</strong>, click <strong class='uiterm'>Run</strong>,  type <span class='sbody-userinput'>wdsmgmt.msc</span>, and then click <strong class='uiterm'> OK</strong>.</li><li>Under <strong class='uiterm'><strong class='sbody-strong'>WDS server</strong></strong>, double-click<strong class='uiterm'> Boot images</strong>.</li><li>Right-click the boot image that you want, and then click <strong class='uiterm'>Enable</strong>.<br></li></ol></li></ol><span class='text-base'>Notes</span><ul class='sbody-free_list'><li>Any errors that are generated when you follow these steps have standard Win32 error codes. For more information about Win32 error codes, search the Microsoft Knowledge Base. To do this, visit the following Microsoft Web site:<div class='indent'><a id='kb-link-1' href='/gp/gsssearchhelp' target='_self'>http://support.microsoft.com/gp/gsssearchhelp</a></div></li><li>Back up the boot image before you mount it in step 3h.</li></ul></div><div class='kb-securedata-section section'>Author: scottmca<br>Writer: v-srisan<br>Tech reviewer: v-jomcc<br>Editor:  v-rhowar</div>