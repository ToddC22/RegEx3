<header><h1>Restricting information available to anonymous logon users</h1></header><div class='kb-summary-section section'> Windows NT has a feature where anonymous logon users can list domain user names and enumerate share names. Customers who want enhanced security have requested the ability to optionally restrict this functionality. Windows NT 4.0 Service Pack 3 and a hotfix for Windows NT 3.51 provide a mechanism for administrators to restrict the ability for anonymous logon users (also known as NULL session connections) to list account names and enumerate share names. Listing account names from Domain Controllers is required by the Windows NT ACL editor, for example, to obtain the list of users and groups to select who a user wants to grant access rights. Listing account names is also used by Windows NT Explorer to select from list of users and groups to grant access to a share. </div><div> Windows NT networks based on a single Windows NT domain will always be able to authenticate connections to list domain account information. Windows NT networks that use multiple domains may require anonymous user logon to list account information. A brief example shows how anonymous connections are used. Consider two Windows NT domains, an account domain and a resource domain. The resource domain has a one-way trust relationship with the account domain. That is, the resource domain &quot;trusts&quot; the account domain, but the account domain does not trust the resource domain. Users from the account domain can authenticate and access resources in the resource domain based on the one-way trust. Suppose an administrator in the resource domain wants to grant access to a file to a user from the account domain. They will want to obtain the list of users and groups from the account domain to select a user/group to grant access rights. Since the account domain does not trust the resource domain, the administrator request to obtain the list of users and groups from the resource domain cannot be authenticated. The connection is made using a NULL session to obtain the list of account domain users. <br><br> There are similar situations where obtaining account names using an anonymous connection allows the user interface tools, including Windows NT Explorer, User Manager, and ACL editor, to administer and manage access control information across multiple Windows NT domains. Another example is using User Manager in the resource domain to add users from the trusted account domain to a local group. One way to add the account domain user to a local group in the resource domain is to manually enter a known domain\username to add access without getting the complete list of names from the account domain. Another approach is to logon to the system in the resource domain using an account in the trusted account domain. <br><br> Windows NT environments that want to restrict anonymous connections from listing account names can control this operation after installing Windows NT 4.0 Service Pack 3 or the Windows NT 3.51 hotfix. <br><br> After installation of Windows NT 4.0 Service Pack 3 or the Windows NT 3.51 hotfix, administrators who want to require only authenticated users to list account names, and exclude anonymous connections from doing so, need to make the following change to the registry: <br><br>  WARNING: Using Registry Editor incorrectly can cause serious, system-wide problems that may require you to reinstall Windows NT to correct them. Microsoft cannot guarantee that any problems resulting from the use of Registry Editor can be solved. Use this tool at your own risk. <br><ol class='sbody-num_list'><li>Run Registry Editor (Regedt32.exe). </li><li>Go to the following key in the registry:<br><br><div class='indent'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\LSA<br></div></li><li>On the Edit menu, click Add Value and use the following entry:<br><br><div class='indent'>Value Name: RestrictAnonymous<br>Data Type:  REG_DWORD<br>Value:      1<br></div></li><li>Exit the Registry Editor and restart the computer for the change to take effect.</li></ol><br><br><span class='text-base'>Note</span> Remote access to the registry may still be possible after you follow the steps in this article if the <span class='text-base'>RestrictNullSessAccess</span> registry value has been created and is set to 0. This value allows remote access to the registry by using a null session. The value overrides other explicit restrictive settings.</div><div class='kb-securedata-section section'><br> NOTE:<br><br> If the change is made in the<br><br><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\L</strong><br><br>registry key and there are Macintosh clients connecting to the network, these clients may loose the ability to change their account password. </div><div class='kb-securedata-section section'><br> Microsoft support engineers should connect to the WINPROG rollup database. </div><div class='kb-securedata-section section'> This is a hotfix, and distribution requires manager approval. To receive the hotfix, customers must be encountering the bug as described above. You must track the customers you send this to and supply them with the next Service Pack when it becomes available. <br><br> The fix is available as Advapi32.dll, Lsasrv.dll, Netui1.dll, Netui2.dll, Samsrv.dll, Srv.sys, Srvsvc.dll, Winlogon.exe, and Wkssvc.dll on<br><a id='kb-link-4' href='http://hotfix' target='_self'>http://hotfix</a>.<br></div><div class='kb-moreinformation-section section'><br><br> The purpose of the registry value is to configure local system policy for whether authentication is required to perform common enumeration functions. Requiring authentication to obtain the account name list is an optional feature. When the RestrictAnonymous value is set to 1, anonymous connections from the Graphical User Interface tools for security management will receive an access denied error when attempting to get the list of account names. When the RestrictAnonymous value is set to 0, or the value is not defined, anonymous connections will be able to list account names and enumerate share names. It should be noted that even with the value of RestrictAnonymous set to 1, although the user interface tools with the system will not list account names, there are Win32 programming interfaces to support individual name lookup that do not restrict anonymous connections. <br><br> Windows NT networks using a multiple domain model can restrict anonymous connections without loss of functionality. The initial steps in planning to disable anonymous connections is for administrators in resource domains to add members of trusted account domains to specific local groups as needed before changing the value for the LSA RestrictAnonymous registry entry. Users logged on using accounts from trusted account domains will continue to use authenticated connections to obtain list of account names to manage security access control. <h3 class='sbody-h3'>Restricting Anonymous List of Share Names</h3> The Server service that provides remote file access to share resources will also use the LSA registry value, RestrictAnonymous, to control whether anonymous connections can obtain a list of share names. Therefore, administrators can set the value of a single registry configuration entry to define how the system responds to enumeration requests by anonymous logons. <h3 class='sbody-h3'>Restricting Anonymous Remote Registry Access</h3> Installation of Windows NT 4.0 Service Pack 3 or the Windows NT 3.51 hotfix removes the ability for anonymous users to connect to the registry remotely. Anonymous users cannot connect to the registry and cannot read or write any registry data. As a reminder, Windows NT 4.0 restricts remote access to the registry by domain users using the access control list on the registry key: <div class='indent'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurePipeServers\winreg<br></div> The ACL on this key identifies the authenticated users allowed to remotely connect to the registry. Windows NT 4.0 Server, by default, only allows Administrators remote registry access. The winreg\AllowedPaths subkey identifies specific portions of the registry that authenticated users who are not explicitly granted access by the winreg ACL can use for printer access and other system operations. The winreg key may be defined on Windows NT 4.0 Workstations to restrict remote registry access to those systems. <br> <span>For additional information on the winreg key, click the article number below to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-1' href='/EN-US/help/153183'>153183 </a> How to Restrict Access to NT Registry from a Remote Computer<br></div></span><h3 class='sbody-h3'>Authenticated Users Built-in Group</h3> A new built-in group is created when installing Windows NT 4.0 Service Pack 3 or the Windows NT 3.51 hotfix known as &quot;Authenticated Users.&quot; The Authenticated Users group is similar to the &quot;Everyone&quot; group, except for one important difference: anonymous logon users (or NULL session connections) are never members of the Authenticated Users group. The built-in Security Identifier for Authenticated Users is S-1-5-11. Authenticated network connections from any account in the server&#39;s Windows NT domain, or any domain trusted by the server&#39;s domain, is identified as an Authenticated User. The Authenticated Users group is available for granting access rights to resources in the security ACL editor. Windows NT 4.0 Service Pack 3 and the Windows NT 3.51 hotfix do not modify any access control lists to change access rights granted to Everyone to use Authenticated Users. <h3 class='sbody-h3'>Windows NT 3.51 Hotfix</h3> The Windows NT 3.51 hotfix has been posted to the following Internet location: <br><div class='indent'><a id='kb-link-2' href='ftp://ftp.microsoft.com/bussys/winnt/winnt-public/fixes/usa/nt351/' target='_self'>ftp://ftp.microsoft.com/bussys/winnt/winnt-public/fixes/usa/NT351/ hotfixes-postSP5/sec-fix</a></div><br><br></div><div class='kb-securedata-section section'>4.00 3.51 sp3 sid</div><div class='kb-textlegacy-section section'>NTBug:79157 Author: petebr (1996-02-01T00:00:00) Edit Reviewer: kylema (1997-04-25T12:24:00) Tech Reviewer: petebr (1997-04-25T12:24:00) </div>