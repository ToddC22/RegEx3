<header><h1>INFO: Understanding Device Names and Symbolic Links</h1></header><div class='kb-summary-section section'>Devices like hard disks, serial ports, and parallel ports have an internal Windows NT device name and may optionally have an MS-DOS device name. These names are located in the Windows NT Object Manager&#39;s namespace. While Windows NT itself and kernel-mode drivers use NT device names, Win32 programs must use the MS-DOS device names. The MS-DOS device name is a symbolic link to the underlying NT device name. This article describes device names, symbolic links, and how Win32 programs can create and remove symbolic links.<br></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Internal NT Device Names</h3>When a kernel-mode device driver is loaded, its initialization routine registers a device name with Windows NT&#39;s Object Manager. This name is referred to as the Windows NT device name.  The kernel-mode components of Windows NT and kernel-mode drivers reference devices by their Windows NT device names. These names have a format, such as \Device\CDRom0 and \Device\Serial0 and also exist in the \device directory of the Object Manager&#39;s namespace.<br><br>Win32 programs cannot use internal Windows NT device names to access devices because the Win32 subsystem and Win32 API require the more familiar drive letters and MS-DOS device names, such as A:, C:, COM1:, and LPT1:. Although Win32 programs may not use Windows NT device names, they can however, define and remove MS-DOS device names to access devices. They can also retrieve the internal Windows NT device name associated with an MS-DOS device name. The example code in the &quot;Symbolic Links&quot; section of this article describes how to do this.<br><br>To gain a better understanding of how the Object Manager tracks names to devices and other system objects, you can view the Object Manager&#39;s namespace with the WinObj.exe tool in the Platform SDK.<br><br><h3 class='sbody-h3'>MS-DOS Device Names</h3>Win32 programs use devices like drives, serial ports, and parallel ports through their MS-DOS device names. For disk drives, these are drive letters like A: and C:.  For serial and parallel ports these are names like COM1:, COM2:, and LPT1:. Like Windows NT device names, these names reside in the Object Manager&#39;s namespace, but in the \?? directory, which is visible to user-mode Win32 programs.<br><br>What makes MS-DOS device names different from Windows NT device names is that they are not used by the Windows NT kernel or kernel-mode drivers. Their purpose is to refer to Windows NT device names so that Win32 programs can use the familiar drive letters and device names; for example, COM1:, to access the Windows NT devices. Therefore, MS-DOS device names are called &quot;symbolic links&quot; to Windows NT device names. That is, an MS-DOS device name exists in the Object Manager&#39;s \?? directory and points to a Windows NT device name in the Object Manager&#39;s \device directory.<br><br>Each MS-DOS device name can point to at most one internal Windows NT device. However, multiple MS-DOS device names can point to a single device. For example, while C: can only point to a single partition, it is possible to have two or more drive letters, like D:, E:, and Z:, point to the same partition.<br><br><h3 class='sbody-h3'>Symbolic Links</h3>Symbolic links created by the system persist across computer restarts because they are stored in the registry. Programs may also create symbolic links with the DefineDosDevice() API.  These links are valid only until the computer is restarted or turned off unless the registry keys containing information about the links are updated.<br><br>There can be multiple symbolic links to a Windows NT device name. However, only the MS-DOS device name that the system initially assigned to the internal Windows NT device remains across reboots. Therefore, it is possible to create additional symbolic links that assign multiple drive letters to a single CD-ROM drive, but the additional drive letters only remain until the machine is turned off or restarted.<br><br>Win32 programs can retrieve the Windows NT device name that is associated with a specific MS-DOS device name by calling QueryDosDevice() with the MS-DOS device name. Following is example code that shows how to do this:<br><br><div class='sbody-code'><pre><code>char szNtDeviceName[MAX_PATH];<br><br>if (QueryDosDevice (&quot;C:&quot;, szNtDeviceName, MAX_PATH))<br>{<br>   printf (&quot;C: is linked to %s\n&quot;, szNtDeviceName);<br>}<br></code></pre></div>Win32 programs can create and delete symbolic links by calling DefineDosDevice(). To create a symbolic link, call DefineDosDevice with the DDD_RAW_TARGET_PATH flag.  To remove a symbolic link, call it with the DDD_REMOVE_DEFINITION and DDD_RAW_TARGET_PATH flags. The following sample program demonstrates both of these operations:<br><br><div class='sbody-code'><pre><code>/*<br>   DDD<br><br>      This sample shows how to associate an MS-DOS device name with a <br>      Windows NT device name. The association is a symbolic link between<br>      device names stored in the Object Manager&#39;s namespace. Applications<br>      use the MS-DOS device name, but Windows NT and kernel-mode drivers<br>      use the Windows NT device name.  <br><br>   Usage:<br>      ddd &lt;MS-DOS Device Name&gt; &lt;NT Device Name&gt;<br>      ddd -r &lt;MS-DOS Device Name&gt;<br><br>   NOTE: If the MS-DOS device name is a driver letter, the trailing <br>   backlash is not accepted by DefineDosDevice or QueryDosDevice.<br><br>   NOTE: The MS-DOS device name is defined only until the computer is <br>   restarted.<br><br>   To make the drive letter associations permanent on Window NT 4.0, you<br>   have to update HKEY_LOCAL_MACHINE\SYSTEM\DISK\Information. However, <br>   the contents of the value are undocumented. <br><br>   On Windows 2000, you have to use the Volume Mount Point APIs.<br>*/ <br><br>#define WIN32_LEAN_AND_MEAN /* Reduce number of system headers parsed */ <br>                            /* during build. */ <br><br>#include &lt;windows.h&gt;<br>#include &lt;stdio.h&gt;<br><br>void main (int argc, char **argv)<br>{<br>   char * pszDosDeviceName,<br>        * pszNtDeviceName;<br><br>   bool  fRemoveDeviceName = false;<br>   bool  fResult;<br><br>   /*<br>      Command-line parsing.<br>        1) Make sure correct number of arguments are supplied.<br>        2) See if you should add or remove the MS-DOS Device Name.<br>   */ <br>   if (argc != 3)<br>   {<br>      printf(&quot;\nusage: %s &lt;DOS device name&gt; &lt;NT device name&gt;    to add\n&quot;,<br>             argv[0]);<br>      printf(&quot;usage: %s [-r] &lt;DOS device name&gt;                to remove\n&quot;,<br>             argv[0]);<br>      printf(&quot;\n\texample: %s d: \\device\\cdrom0\n&quot;, argv[0]);<br>      return;<br>   }<br><br>   fRemoveDeviceName = !lstrcmpi (argv[1], &quot;-r&quot;);<br><br><br>   /* Now, add/remove the DOS device name. */ <br>   if (fRemoveDeviceName)<br>   {<br>      /*<br>         Remove the MS-DOS device name. First, get the name of the Windows<br>         NT device from the symbolic link, then delete the symbolic link.<br>         <br>      */ <br>      pszDosDeviceName = argv[2];<br><br>      pszNtDeviceName = (char *)LocalAlloc (LPTR, MAX_PATH);<br><br>      fResult = QueryDosDevice (pszDosDeviceName, pszNtDeviceName,<br>                                MAX_PATH);<br>      if (fResult)<br>      {<br>         fResult = DefineDosDevice (DDD_RAW_TARGET_PATH|<br>                                    DDD_REMOVE_DEFINITION|<br>                                    DDD_EXACT_MATCH_ON_REMOVE,<br>                                    pszDosDeviceName, pszNtDeviceName);<br>      }<br>      if (!fResult)<br>         printf(&quot;error %lu: could not remove %s\n&quot;,<br>                GetLastError(), pszDosDeviceName);<br><br>      LocalFree (pszNtDeviceName);<br>   }<br>   else<br>   {<br>      /* Add the DOS device name */ <br><br>      pszDosDeviceName = argv[1];<br>      pszNtDeviceName  = argv[2];<br><br>      fResult = DefineDosDevice (DDD_RAW_TARGET_PATH, pszDosDeviceName,<br>                                 pszNtDeviceName);<br>      if (!fResult)<br>         printf(&quot;error %lu: could not link %s to %s\n&quot;,<br>                GetLastError(), pszDosDeviceName, pszNtDeviceName);<br>   }<br><br>}<br></code></pre></div></div><div class='kb-securedata-section section'>DOS DEVICE</div><div class='kb-textlegacy-section section'>DOC INFO: kbsweptKernelBaseWin2000 JAN-11-2000 Author: danru (1999-06-14T16:46:00) Edit Reviewer: A-SHERF (1999-06-24T12:07:00) Tech Reviewer: dchou (1999-06-22T15:27:00)<br></div>