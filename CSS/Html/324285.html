<header><h1>HOW TO: Set SMTP Security Options in Windows Server 2003</h1></header><div class='kb-notice-section section'><div id='bookmark-toc'></div>For a Microsoft Windows 2000 version of this article,<br> see<br> <a id='kb-link-1' href='/EN-US/help/303776' target='_self'>303776</a>. <br><h3 class='sbody-h3'>IN THIS TASK</h3><ul class='sbody-free_list'><li><a id='kb-link-2' href="" class='sbody-bookref' scroll-to="" location='bookmark-1'>SUMMARY</a></li><li><ul class='sbody-free_list'><li><a id='kb-link-3' href="" class='sbody-bookref' scroll-to="" location='bookmark-2'>Setting Operator<br> Permissions</a></li><li><ul class='sbody-free_list'><li><a id='kb-link-4' href="" class='sbody-bookref' scroll-to="" location='bookmark-3'>To Assign Operator<br>  Permissions</a></li><li><a id='kb-link-5' href="" class='sbody-bookref' scroll-to="" location='bookmark-4'>To Remove Operator<br>  Permissions</a></li></ul></li><li><a id='kb-link-6' href="" class='sbody-bookref' scroll-to="" location='bookmark-5'>Authentication for<br> Incoming Connections</a></li><li><ul class='sbody-free_list'><li><a id='kb-link-7' href="" class='sbody-bookref' scroll-to="" location='bookmark-6'>To Disable<br>  Authentication for Incoming Messages</a></li><li><a id='kb-link-8' href="" class='sbody-bookref' scroll-to="" location='bookmark-7'>To Set Clear Text<br>  Authentication for Incoming Messages</a></li><li><a id='kb-link-9' href="" class='sbody-bookref' scroll-to="" location='bookmark-8'>To Use Integrated<br>  Windows Authentication to Authenticate Incoming Messages</a></li></ul></li><li><a id='kb-link-10' href="" class='sbody-bookref' scroll-to="" location='bookmark-9'>Configuring<br> Authentication for Outbound Messages</a></li><li><ul class='sbody-free_list'><li><a id='kb-link-11' href="" class='sbody-bookref' scroll-to="" location='bookmark-10'>To Disable<br>  Authentication for Outbound Messages</a></li><li><a id='kb-link-12' href="" class='sbody-bookref' scroll-to="" location='bookmark-11'>To Set Basic<br>  Authentication for Outbound Messages</a></li><li><a id='kb-link-13' href="" class='sbody-bookref' scroll-to="" location='bookmark-12'>To Set Integrated<br>  Windows Authentication for Outbound Messages</a></li></ul></li><li><a id='kb-link-14' href="" class='sbody-bookref' scroll-to="" location='bookmark-13'>Transport Layer<br> Security (TLS) Encryption</a></li><li><ul class='sbody-free_list'><li><a id='kb-link-15' href="" class='sbody-bookref' scroll-to="" location='bookmark-14'>To Create and<br>  Manage Key Certificates</a></li><li><a id='kb-link-16' href="" class='sbody-bookref' scroll-to="" location='bookmark-15'>To Set TLS<br>  Encryption Levels for the Server</a></li></ul></li><li><a id='kb-link-17' href="" class='sbody-bookref' scroll-to="" location='bookmark-16'>Setting IP Access<br> Restrictions to the Server</a></li><li><ul class='sbody-free_list'><li><a id='kb-link-18' href="" class='sbody-bookref' scroll-to="" location='bookmark-17'>To Set IP Address<br>  Access Restrictions</a></li></ul></li><li><a id='kb-link-19' href="" class='sbody-bookref' scroll-to="" location='bookmark-18'>Removing Relay<br> Restrictions from a Virtual Server</a></li><li><ul class='sbody-free_list'><li><a id='kb-link-20' href="" class='sbody-bookref' scroll-to="" location='bookmark-19'>To Remove Relay<br>  Restrictions from a Virtual Server</a></li></ul></li></ul></li></ul><div id='bookmark-1'></div></div><div class='kb-summary-section section'> This step-by-step article describes how to set Simple Mail<br>  Transfer Protocol (SMTP) virtual server security options. You can select the<br>  security levels for the SMTP virtual server and use the security options to<br>  obtain the level of protection that you require. The settings that you<br>  configure on the security tabs apply to all domains on the virtual server.<br> <br><br><a name="bottom" href="#toc">back to the top</a><h3 class='sbody-h3'><div id='bookmark-2'></div>Setting Operator Permissions</h3> You can designate which user accounts have operator permissions<br>  for the SMTP virtual server. After you set up Windows user accounts, you can<br>  grant or rescind permissions by adding users to, or removing users from, the <span class='text-base'>Operators</span> list. <br><br><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-3'></div>To Assign Operator Permissions</h4> To assign operator permissions, add the user account that you<br>  want to the <span class='text-base'>Operators</span> list: <br> <ol class='sbody-num_list'><li>Start Internet Information Services Manager or open the<br>Microsoft Internet Information Services (IIS) snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Security</span> tab, and then click <span class='text-base'>Add</span>. </li><li>Click the Windows user account that you want to add, click <span class='text-base'>Add</span>, and then click <span class='text-base'>OK</span>. <br><br> The account that you added is displayed in the <span class='text-base'>Operators</span> list. </li><li>Click <span class='text-base'>OK</span>.</li><li>Quit IIS Manager or close the IIS snap-in.</li></ol><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-4'></div>To Remove Operator Permissions</h4> To remove operator permissions, remove the user account from the <span class='text-base'>Operators</span> list: <br> <ol class='sbody-num_list'><li>Start IIS Manager or open the IIS snap-in.</li><li>Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Security</span> tab.</li><li>In the <span class='text-base'>Operators</span> list, click the Windows user account that you want to remove,<br>click <span class='text-base'>Remove</span>, and then click <span class='text-base'>OK</span>. </li><li>Quit IIS Manager or close the IIS snap-in.</li></ol><a name="bottom" href="#toc">back to the top</a><h3 class='sbody-h3'><div id='bookmark-5'></div>Authentication for Incoming Connections</h3> There are three authentication methods that are available. You<br>  can select and use one, two, or all three of the following methods: <br> <ul class='sbody-free_list'><li><span class='text-base'>Anonymous access</span>: If you use this option, an account name or password is not<br>required. You can use this option to disable authentication for the SMTP<br>virtual server.</li><li><span class='text-base'>Basic authentication</span>: If you use this option, an account name and a password are sent<br>as clear text. You must specify a Windows domain that is appended to the<br>account name for authentication.</li><li><span class='text-base'>Integrated Windows Authentication</span>: If you use this option, the Windows account name and password<br>are authenticated.</li></ul><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-6'></div>To Disable Authentication for Incoming Messages</h4><ol class='sbody-num_list'><li>Start IIS Manager or open the IIS snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Access</span> tab, and then under <strong class='uiterm'>Access control</strong>, click <span class='text-base'>Authentication</span>. </li><li>Click to select the <strong class='uiterm'>Anonymous access</strong> check<br>box (if it is not already selected), and then click to clear the <strong class='uiterm'>Basic<br>authentication</strong> and <span class='text-base'>Integrated Windows Authentication</span> check boxes (if they are selected).</li><li>Click <span class='text-base'>OK</span> two times.</li><li>Quit IIS Manager or close the IIS snap-in.</li></ol><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-7'></div> To Set Clear Text Authentication for Incoming Messages</h4><ol class='sbody-num_list'><li>Start IIS Manager or open the IIS snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Access</span> tab, and then under <strong class='uiterm'>Access control</strong>, click <span class='text-base'>Authentication</span>. </li><li>Click to select the <span class='text-base'>Basic authentication</span> check box.</li><li>Click <span class='text-base'>Yes</span> on the message that appears in the <span class='text-base'>Basic Authentication</span> dialog box to confirm that you want continue. </li><li>In the <strong class='uiterm'>Default domain</strong> box, type a Windows<br>domain name. <br><br><span class='text-base'>NOTE</span>: This default domain differs from the SMTP virtual server default<br>domain. </li><li>Click <span class='text-base'>OK</span> two times.</li><li>Quit IIS Manager or close the IIS snap-in.</li></ol><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-8'></div>To Use Integrated Windows Authentication to Authenticate Incoming Messages</h4><ol class='sbody-num_list'><li>Start IIS Manager or open the IIS snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Access</span> tab, and then under <strong class='uiterm'>Access control</strong>, click <span class='text-base'>Authentication</span>. </li><li>Click to select the <span class='text-base'>Integrated Windows Authentication</span> check box.</li><li>Click <span class='text-base'>OK</span> two times.</li><li>Quit IIS Manager or close the IIS snap-in.</li></ol><a name="bottom" href="#toc">back to the top</a><h3 class='sbody-h3'><div id='bookmark-9'></div>Configuring Authentication for Outbound Messages</h3> You can configure the SMTP virtual server to provide the<br>  authentication credentials that the receiving server needs. The three methods<br>  of authentication are: <br> <ul class='sbody-free_list'><li><span class='text-base'>Anonymous access</span>: If you use this option, an account name or password is not<br>required. </li><li><span class='text-base'>Basic authentication</span>: If you use this option, the account name and password of the<br>server that you are connecting to are sent as clear text. </li><li><span class='text-base'>Integrated Windows Authentication</span>: If you use this option, a Windows account name and password are<br>required.</li></ul> You can override the authentication option that you set for a<br>  specific domain. By doing so, you can configure the SMTP virtual server<br>  authentication level to handle most of the transmissions, and also permit<br>  exceptions for individual addresses. For example: <br> <ul class='sbody-free_list'><li>If messages are frequently sent to multiple addresses,<br>disable authentication for the SMTP virtual server. If attempts to deliver<br>messages to an address are unsuccessful because of authentication requirements,<br>add a remote domain for the address, and then enable authentication for the<br>domain at the same level that the server requires.</li><li>If messages are frequently sent to one address that<br>requires authentication, determine the level of authentication that is required<br>to connect, and then enable authentication for the SMTP virtual server by using<br>the same level. If you want to send messages to other addresses, set up remote<br>domains, and then set different authentication options. If you use this option,<br>it is likely that the account name used is the one that identifies the computer<br>set up as the smart host.</li></ul><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-10'></div>To Disable Authentication for Outbound Messages</h4><ol class='sbody-num_list'><li>Start IIS Manager or open the IIS snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Delivery</span> tab, and then click <span class='text-base'>Outbound Security</span>. </li><li>Click <strong class='uiterm'>Anonymous access</strong> (if it is not<br>already selected).</li><li>Click <span class='text-base'>OK</span> two times.</li><li>Quit IIS Manager or close the IIS snap-in.</li></ol><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-11'></div>To Set Basic Authentication for Outbound Messages</h4><ol class='sbody-num_list'><li>Start IIS Manager or open the IIS snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Delivery</span> tab, and then click <span class='text-base'>Outbound Security</span>. </li><li>Click <strong class='uiterm'>Basic authentication</strong>. </li><li>In the <strong class='uiterm'>User name</strong> and <span class='text-base'>Password</span> boxes, type the account name and password that grants you access<br>to the computer that you are connecting to.</li><li>Click <span class='text-base'>OK</span> two times.</li><li>Quit IIS Manager or close the IIS snap-in.</li></ol><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-12'></div>To Set Integrated Windows Authentication for Outbound Messages</h4> Integrated Windows Authentication requires a Windows account name<br>  and password. To create these elements, follow these steps: <br> <ol class='sbody-num_list'><li>Start IIS Manager or open the IIS snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Delivery</span> tab, and then click <span class='text-base'>Outbound Security</span>. </li><li>Click <span class='text-base'>Integrated Windows Authentication</span>. </li><li>In the <span class='text-base'>Account</span> and <span class='text-base'>Password</span> boxes, type the Windows account name and password that grants you<br>access to the computer that you are connecting to.</li><li>Click <span class='text-base'>OK</span> two times.</li><li>Quit IIS Manager or close the IIS snap-in.</li></ol><a name="bottom" href="#toc">back to the top</a><h3 class='sbody-h3'><div id='bookmark-13'></div>Transport Layer Security Encryption</h3> Transport Layer Security (TLS) is a generic security protocol<br>  that is similar to Secure Sockets Layer (SSL). You can require that all clients<br>  use TLS encryption to connect to the default SMTP virtual server. This option<br>  secures the connection, but it is not used for authentication.<br><br><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-14'></div>To Create and Manage Key Certificates</h4> To use TLS encryption for the virtual server, you must create key<br>  pairs and configure key certificates. Clients can then use TLS to encrypt the<br>  session (and all messages that are sent) with SMTP Service. <br> <ol class='sbody-num_list'><li>Start IIS Manager or open the IIS snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Access</span> tab, and then under <strong class='uiterm'>Secure communication</strong>, click <span class='text-base'>Certificate</span>. <br><br> The Welcome to the Web Server Certificate Wizard<br>starts. Click <span class='text-base'>Next</span>, and then follow the instructions in the wizard to set up new key<br>certificates and manage installed key certificates for the SMTP virtual<br>server.<br><br> Key pairs are made up of a number of bits that indicate the<br>key&#39;s security level. You can strengthen security by increasing the encryption<br>level from 40 bits (the default) to 128 bits. The greater the number of bits,<br>the more difficult the item is to decrypt. </li></ol><span class='text-base'>IMPORTANT</span>: Users who try to secure access must use the same encryption<br>  level that you set. Otherwise, messages are returned with a non-delivery report<br>  (NDR).<br><br><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-15'></div>To Set TLS Encryption Levels for the Server</h4><ol class='sbody-num_list'><li>Start IIS Manager or open the Internet IIS<br>snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Access</span> tab, and then under <strong class='uiterm'>Access control</strong>, click <span class='text-base'>Authentication</span>. </li><li>Click <strong class='uiterm'>Basic authentication</strong>.</li><li>Click to select the <strong class='uiterm'>Requires TLS<br>encryption</strong> check box.</li><li>Click <span class='text-base'>OK</span> two times.</li><li>Quit IIS Manager or close the IIS snap-in.</li></ol><span class='text-base'>NOTE</span>: Two additional TLS options are available. To use TLS for all<br>  outgoing connections, click <span class='text-base'>Outbound Security</span> on the <span class='text-base'>Delivery</span> tab, and then click to select the <strong class='uiterm'>TLS encryption</strong>  check box. Also, if a server to which you frequently connect requires the use<br>  of TLS for all incoming connections, you can create a remote domain, and then<br>  configure TLS encryption for the remote domain.<br><br><a name="bottom" href="#toc">back to the top</a><h3 class='sbody-h3'><div id='bookmark-16'></div>Setting IP Access Restrictions to the Server</h3> You can grant or deny SMTP virtual server access to specific IP<br>  addresses. By default, the SMTP virtual server is accessible to all IP<br>  addresses.<br><br><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-17'></div>To Set IP Address Access Restrictions</h4> You can set restrictions by specifying a single IP address, a<br>  group of addresses using a subnet mask, or a domain name. <br> <ol class='sbody-num_list'><li>Start IIS Manager or open the IIS snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Access</span> tab, and then under <strong class='uiterm'>Connection control</strong>, click <span class='text-base'>Connection</span>. </li><li>Click either <strong class='uiterm'>Only the list below</strong> or<br><strong class='uiterm'>All except the list below</strong>.</li><li>To add a computer, group of computers, or a domain to the <span class='text-base'>Computers</span> list, click <span class='text-base'>Add</span>, specify the computer, group of computers, or domain that you<br>want to add, and then click <span class='text-base'>OK</span>. </li><li>To remove a computer, group of computers, or domain from<br>the <span class='text-base'>Computers</span> list, click the item that you want to remove in the list, click <span class='text-base'>Remove</span>, and then click <span class='text-base'>OK</span>.</li><li>Click <span class='text-base'>OK</span>, and then quit IIS Manager or close the IIS snap-in.</li></ol><a name="bottom" href="#toc">back to the top</a><h3 class='sbody-h3'><div id='bookmark-18'></div>Removing Relay Restrictions from a Virtual Server</h3> By default, SMTP Service blocks computers from relaying<br>  undesirable mail through the virtual server. All computers are blocked by<br>  default except those that meet the authentication requirements that are<br>  configured in the <span class='text-base'>Authentication</span> dialog box (click the <span class='text-base'>Access</span> tab, and then click <span class='text-base'>Authentication</span>).<br><br><span class='text-base'>NOTE</span>: If your virtual server is on the Internet, Microsoft recommends<br>  that you do not permit relaying. This prevents the propagation of unsolicited<br>  e-mail.<br><br><a name="bottom" href="#toc">back to the top</a><h4 class='sbody-h4'><div id='bookmark-19'></div>To Remove Relay Restrictions from a Virtual Server</h4><ol class='sbody-num_list'><li>Start IIS Manager or open the IIS snap-in.</li><li> Expand <span class='text-base'><var class='sbody-var'>Server_name</var></span>, where <var class='sbody-var'>Server_name</var> is the name of the<br>server.</li><li>Right-click the SMTP virtual server that you want (for<br>example, <strong class='uiterm'>Default SMTP Virtual Server</strong>), and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Access</span> tab, and then under <strong class='uiterm'>Relay restrictions</strong>, click <span class='text-base'>Relay</span>. </li><li>Click either <strong class='uiterm'>Only the list below</strong> or<br><strong class='uiterm'>All except the list below</strong>. </li><li>Click <span class='text-base'>Add</span>, and then add exceptions to the global access option that you<br>selected in step 5. <br><br> For example, you can specify the following<br>options in the <span class='text-base'>Relay Restrictions</span> dialog box: <br><ul class='sbody-free_list'><li>If you click <strong class='uiterm'>Only the list below</strong>, only<br> computers that are displayed on the <span class='text-base'>Computers</span> list can relay messages through the SMTP virtual<br> server.</li><li>If you click <strong class='uiterm'>All except the list<br> below</strong>, all computers can relay messages through the SMTP virtual<br> server, except those that are displayed on the <span class='text-base'>Computers</span> list. This option is set by default, as is the <strong class='uiterm'>Allow any<br> computers which successfully authenticate to relay, regardless of the list<br> above</strong> option.</li><li>If you click to select the <strong class='uiterm'>Allow all computers<br> which successfully authenticate to relay, regardless of the list above</strong> check box, computers that meet authentication requirements that are set in the <span class='text-base'>Authentication</span> dialog box can relay messages to the SMTP virtual server. This<br> option is set by default.</li></ul></li><li>Click <span class='text-base'>OK</span>, and then quit IIS Manager or close the IIS snap-in.</li></ol><a name="bottom" href="#toc">back to the top</a><div id='bookmark-20'></div></div><div class='kb-securedata-section section'>kbsecurity</div>