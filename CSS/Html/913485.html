<header><h1>Cached credentials security in Windows Server 2003, in Windows XP, and in Windows 2000</h1></header><div class='kb-notice-section section'><div internal-content-body=""><div class="internal-content"><div class="bold internal-content-body-title spacer-12-bottom">Microsoft Internal Support Information</div><div class="row"><div class="col-xs-24 internal-content-body-content"><p>BUG #: <a href='http://bugcheck/bugs/ContentMaintenance/50186.asp' title='Link only available for Microsoft corporate network users' target='_blank'>50186 (Content Maintenance)</a></p></div></div></div></div></div><div class='kb-summary-section section'>This article discusses cached credentials security in Microsoft Windows Server 2003, in Microsoft Windows XP, and in Microsoft Windows 2000. This article mostly discusses domain credentials. However, this article also discusses generic credentials for clarification.</div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Understanding password caching</h3>Windows-based computers use two forms of password caching: domain credentials and generic credentials.<h4 class='sbody-h4'>Domain credentials</h4>Domain credentials are used by operating system components and are authenticated by the Local Security Authority (LSA). Typically, domain credentials are established for a user when a registered security package authenticates the user&#39;s logon data. This registered security package may be the Kerberos protocol or NTLM.<h4 class='sbody-h4'>Generic credentials</h4>Generic credentials are defined and authenticated by programs that manage authorization and security directly instead of delegating these tasks to the operating system. For example, a program might require that a user enter a user name and a password that the program provides. Or, a program might require that a user produce a certificate to access a Web site.<br><br>Programs use credentials management functions to prompt users for credentials that are defined by the program. These credentials may take the form of a user name, a password, a certificate, or a smart card. The credentials that the user enters are returned to the program for authentication.<br><br>Credentials management lets you customize cache management. Credentials management also provides long-term storage for generic credentials. Generic credentials can be read and written by user processes.<h3 class='sbody-h3'>Credential Manager</h3>Windows XP Professional and Windows Server 2003 include a Stored User Names and Passwords feature that also provides credential management functionality. Depending on the type of authentication, this feature can save user credentials so they can be reused later.<br><br>Credential Manager stores user credentials securely. These credentials include passwords and X.509 certificates. Credential Manager lets both roaming and nonroaming users provide credentials only one time. For example, the first time that a user runs a program on a company&#39;s network, authentication is required. Therefore, the user is prompted to supply  credentials. After the user provides these credentials, they continue to be associated with the program.<br><br><h3 class='sbody-h3'>Functionality that cached domain credentials provide</h3>Cached domain credentials provide the following functionality:<br><br><ul class='sbody-free_list'><li><span class='text-base'>Single Sign-On</span><br>Single Sign-On (SSO) uses the credentials that are collected during an interactive domain logon to let the user authenticate to a network one time. Thereafter, the user has access to all the authorized network resources without providing credentials again. These network resources may range from hardware devices to programs, files, and other types of data. All these resources may be spread throughout an enterprise on servers of various types. The resources may be in different domains or may be on different operating systems.</li><li><span class='text-base'>Access to machine resources when a domain controller is unavailable</span><br>After a successful domain logon, a form of the logon information is cached. Later, a user can log on to the computer by using the domain account, even if the domain controller that authenticated the user is unavailable. Because the user has already been authenticated, Windows uses the cached credentials to log the user on locally. For example, suppose a mobile user uses a domain account to log on to a laptop that is joined to a domain. Then, the user takes the laptop to a location where the domain is unavailable. In this scenario, Windows uses the cached credentials from the last logon to log the user on locally and to allocate access to local computer resources.</li></ul><h3 class='sbody-h3'>Security of cached domain credentials</h3>The term cached credentials does not accurately describe how Windows caches logon information for domain logons. In Windows 2000 and in later versions of Windows, the username and password are not cached. Instead, the system stores an encrypted verifier of the password. This verifier  is a salted MD4 hash that is computed two times. The double computation effectively makes the verifier a hash of the hash of the user password. This behavior is unlike the behavior of Microsoft Windows NT 4.0 and earlier versions of Windows NT.<br><br>If an attacker tries to conduct a cryptanalytic attack on the verifier, this encryption has two consequences:<ul class='sbody-free_list'><li>A precompiled table must be created for each salt.</li><li>The verifier cannot be used to log on anywhere else.</li></ul><h4 class='sbody-h4'>Configuration options for cached domain credentials</h4><ul class='sbody-free_list'><li><span class='text-base'>Number of cached domain credentials stored on the client</span><br>By default, the operating system caches the verifier for each unique user&#39;s ten most recent valid logons. This value can be set to any value between 0 and 50. <span>For more information, click the following article number to view the article in the Microsoft Knowledge Base:<br><br><div class='indent'><a id='kb-link-1' href='/en-us/help/172931'>172931 </a> Cached domain logon information<br><br></div></span></li><li><span class='text-base'>Notification of logon using cached domain credentials</span><br>When you try to log on to a domain from a Windows-based client computer, and a domain controller is unavailable, you do not receive an error message. Therefore, you may not notice that you logged in with cached domain credentials. <br><span>For more information about how to display a message when you use cached credentials to log on, click the following article number to view the article in the Microsoft Knowledge Base:<br><br><div class='indent'><a id='kb-link-2' href='/en-us/help/242536'>242536 </a> User is not alerted when logging on with domain cached credentials<br><br></div></span></li></ul><h3 class='sbody-h3'>Security considerations for cached domain credentials</h3><h4 class='sbody-h4'>Deleting the credential cache</h4>Regardless of what encryption algorithm is used to encrypt the password verifier, a password verifier can be overwritten so that an attacker can authenticate as the user to whom the verifier belongs. Therefore, the administrator&#39;s password may be overwritten. This procedure requires physical access to the computer. Utilities exist that can help overwrite the cached verifier. By using one of these utilities, an attacker can authenticate by using the overwritten value.<br><br>Overwriting the administrator&#39;s password does not help the attacker access data that is encrypted by using that password. Also, overwriting the password does not help the attacker access any Encrypting File System (EFS) data that belongs to other users on that computer. Overwriting the password does not help an attacker replace the verifier, because the base keying material is incorrect. Therefore, data that is encrypted  by using  Encrypting File System or by using the Data Protection API (DPAPI) will not decrypt. <span>For more information, click the following article number to view the article in the Microsoft Knowledge Base:<br><br><div class='indent'><a id='kb-link-3' href='/en-us/help/818200'>818200 </a> An attacker with physical access to your computer may be able to access your files and other data<br><br></div></span></div><div class='kb-securedata-section section'>Content Maintenance 50186</div><div class='kb-securedata-section section'>Author: robrtegg<br>Writer: Darryl Gittins V-DGit<br>Tech reviewer: robrtegg ;TIM THOMPSON<br>Editor: v-jocoop</div>