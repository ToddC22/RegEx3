<header><h1>How to enable COM+ and COM diagnostic tracing</h1></header><div class='kb-notice-section section'>BUG #: <a href='http://bugcheck/bugs/ContentMaintenance/63523.asp' title='Link only available for Microsoft corporate network users' target='_blank'>63523 (Content Maintenance)</a></div><div class='kb-notice-section section'><span class='text-base'>Warning</span> You should not enable tracing functionality on production systems unless a Microsoft support representative indicates that the tracing information is required to diagnose an issue. The performance of the computer may be affected. As soon as the reason for the issue is found and resolved, you should disable tracing functionality. By default, tracing functionality is disabled. Therefore, there is no performance effect on a regular installation.</div><div class='kb-summary-section section'>Event Tracing for Windows (ETW) provides a mechanism to trace and log events that are raised by user-mode applications and kernel-mode drivers. In Windows Server 2003 Service Pack 2 (SP2), in Windows Vista, or in newer Windows operating systems, you can use ETW to trace events for some COM+ components and for some base COM components. COM tracing can help you troubleshoot issues that are related to permission, activation, or registration.<br><br>The tracing mechanism produces a binary file. The binary file must be formatted by Microsoft so that it can be analyzed.<br><br>You can trace the following COM+ and COM providers:<br> <ul class='sbody-free_list'><li>COMSVCS</li><li> COMADMIN</li><li>DCOMSCM (RPCSS)</li><li> OLE32</li></ul>This article describes how to enable and collect diagnostic trace output for COM+ and COM components in Windows Server 2003 SP2, Windows Vista, and newer Windows operating systems.</div><div class="kb-moreinformation-section section">
<h3 class="sbody-h3">Start tracing for the COMSVCS, COMADMIN, and DCOMSCM providers</h3>
To start the tracing for COMSVCS, COMADMIN, and DCOMSCM providers, run one of the following commands as appropriate at the command prompt:

<div class="indent">logman -start comsvcs -p {B46FA1AD-B22D-4362-B072-9F5BA07B046D} 0xf 0x5 -ets<br>
<br>
logman -start comadmin -p {A0C4702B-51F7-4ea9-9C74-E39952C694B8} 0xf 0x5 -ets<br>
<br>
logman -start dcomscm -p {9474a749-a98d-4f52-9f45-5b20247e4f01} 0x7 0x5 -ets</div>

<h3 class="sbody-h3">Start tracing for the OLE32 provider</h3>
<span><span class="text-base">Important</span> This section, method, or task contains steps that tell you how to modify the registry. However, serious problems might occur if you modify the registry incorrectly. Therefore, make sure that you follow these steps carefully. For added protection, back up the registry before you modify it. Then, you can restore the registry if a problem occurs. For more information about how to back up and restore the registry, click the following article number to view the article in the Microsoft Knowledge Base: </span>

<div class="indent"><span><a href="/en-us/help/322756" id="kb-link-1">322756 </a> How to back up and restore the registry in Windows</span></div>
By default, OLE32 tracing is not enabled. Therefore, you must enable OLE32 tracing before you can start tracing. You can do this by adding the required registry entries as described in this section. You can enable OLE32 tracing on all processes that use OLE32 or on specific processes. OLE32.dll is loaded in many processes, and enabling tracing for all processes may cause decreased performance. Therefore, we do not recommend enabling tracing for all processes.

<ul class="sbody-free_list">
	<li>At the command prompt, run the following command to enable OLE32 tracing on all the processes that use OLE32:<br>
	<code>reg add HKEY_LOCAL_MACHINE\Software\Microsoft\OLE\Tracing /v ExecutablesToTrace /t REG_MULTI_SZ /d * /f</code></li>
	<li>At the command prompt, run the following command to enable OLE32 tracing on specific processes that use OLE32:<br>
	<code>reg add HKEY_LOCAL_MACHINE\Software\Microsoft\OLE\Tracing /v ExecutablesToTrace /t REG_MULTI_SZ /d &quot;c:\test\app1.exe\0c:\test\app2.exe&quot; /f</code></li>
</ul>
<span class="text-base">Note</span> You can type multiple executables in the registry value. You must type the full path of each executable. Notice the use of double quotation marks and the null terminator (\0). After enabling OLE32 tracing, you must restart the process for the change to take effect.<br>
<br>
After you enable OLE32 tracing, start the tracing by running the following command at the command prompt:
<div class="indent">logman -start ole32 -p {bda92ae8-9f11-4d49-ba1d-a4c2abca692e} 0xf 0x5 -ets</div>

<h3 class="sbody-h3">Stop tracing for all providers</h3>
<span class="text-base">Important</span> You must stop the tracing so that the buffer is written to disk. To do this, run one of the following commands as appropriate at the command prompt:

<div class="indent">logman -stop comsvcs -ets<br>
<br>
logman -stop comadmin -ets<br>
<br>
logman -stop dcomscm -ets<br>
<br>
logman -stop ole32 -ets</div>

<h3 class="sbody-h3">Log file location</h3>
The <span class="text-base">start</span> command will create a log file that has an .etl extension, such as Dcomscm.etl, Ole32.etl, and so on, in the current directory. You can use the <span class="text-base">-o</span> option to change the output path when you run the <span class="text-base">start</span> command.

<h3 class="sbody-h3">Next Steps</h3>

<ol class="sbody-num_list">
	<li>The binary file must be formatted by Microsoft so that it can be analyzed. Please forward the .etl files to your support contact. <span>For more information about how to contact Microsoft Customer Service and Support, click the following article number to view the article in the Microsoft Knowledge Base:</span><br>
	&nbsp;
	<div class="indent"><span><a href="/en-us/help/295539" id="kb-link-2">295539 </a> How and when to contact Microsoft Customer Service and Support</span><br>
	&nbsp;</div>
	</li>
	<li>Delete the registry key after the trace session is completed. To do this, at the command prompt, run the following command:<br>
	<code>reg delete HKEY_LOCAL_MACHINE\Software\Microsoft\OLE\Tracing /v ExecutablesToTrace /f&nbsp;</code></li>
</ol>
</div>
<div class='kb-references-section section'>For more information about COM and COM+ tracing, visit the following MSDN Web site: <div class='indent'><a id='kb-link-3' href='http://blogs.msdn.com/distributedservices/archive/2009/06/19/tracing-in-com-and-complus.aspx' target='_self'>http://blogs.msdn.com/distributedservices/archive/2009/06/19/tracing-in-com-and-complus.aspx</a></div></div><div class='kb-securedata-section section'>complus</div><div class='kb-securedata-section section'>Author: Johngil<br>Writer: Johngil; v-thomr<br>Tech Reviewer: faikb; abhudaya<br> Editor: v-anwale; v-crweb</div>