<header><h1>How to enable SMTP protocol logging for Internet Information Services in Windows Server 2003 and in Windows 2000</h1></header><div><span></span></div><div class='kb-securedata-section section'>DO NOT DELETE OR ARCHIVE THIS ARTICLE<br>This article is referenced by TechNet.<br>Contact the Content Business Manager for this product if you have any questions.<br></div><div class='kb-summary-section section'>This step-by-step guide describes how to enable protocol logging for Microsoft Internet Information Services (IIS) in Microsoft Windows Server 2003 and in Microsoft Windows 2000. Protocol logs track the commands that the Simple Mail Transfer Protocol (SMTP) virtual server receives from SMTP clients over the network. You can choose which logging format that the SMTP server uses for recording information.</div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Enabling logging in ASCII text format</h3>When you identify the SMTP virtual server, you designate the TCP port that the SMTP server uses to receive incoming messages. When you set up a log file, remember that the log formats and the default file names are the same as those used by other services in IIS. If you choose the default names, all transactions for all services are recorded in the same file. <br><br>To enable logging that uses ASCII text format, follow these steps:<br><br><ol class='sbody-num_list'><li>In Internet Services Manager, click the SMTP virtual server, and then click <strong class='uiterm'>Properties</strong> on the <strong class='uiterm'>Action</strong> menu. </li><li>On the <strong class='uiterm'>General</strong> tab, click <strong class='uiterm'>Enable logging</strong>.</li><li>In the <strong class='uiterm'>Active log format</strong> box, click a log format.</li><li>Click <strong class='uiterm'>Properties</strong>, and then specify the log file size and location on the <strong class='uiterm'>General Properties</strong> tab. </li><li>If you selected the <strong class='uiterm'>W3C Extended Logging</strong> format, click the <strong class='uiterm'>Extended Properties</strong> tab, and then select the items that you want to track.</li></ol><span class='text-base'>Note</span> If you configure the file to be in a different location from the default, make sure that the file is stored on a local drive, not on a network drive. Also, because logging is shared with IIS, some of the names are not specific to SMTP.<h3 class='sbody-h3'>Enabling logging in ODBC format</h3><br>To enable logging in Open Database Connectivity (ODBC) format, follow these steps:<br><br><ol class='sbody-num_list'><li>Set up an ODBC-compliant database. To do this in Microsoft SQL Server, follow these steps:<ol class='sbody-alpha_list'><li>Click <strong class='uiterm'>Start</strong>, point to <strong class='uiterm'>Programs</strong>, point to <strong class='uiterm'>Microsoft SQL Server</strong>, and then click <strong class='uiterm'>Enterprise Manager</strong>.</li><li>Right-click the server you want to connect to, point to <strong class='uiterm'>New</strong>, and then click <strong class='uiterm'>Database</strong>.</li><li>Type a name for the new database in the <strong class='uiterm'>Name</strong> box, and then click <strong class='uiterm'>OK</strong>.</li></ol></li><li>Create the table for ODBC logging. To do this in Microsoft SQL Server, follow these steps:<br><br><ol class='sbody-alpha_list'><li>Click <strong class='uiterm'>Start</strong>, point to <strong class='uiterm'>Programs</strong>, point to <strong class='uiterm'>Microsoft SQL Server</strong>, and then click <strong class='uiterm'>Query Analyzer</strong>.<br></li><li>Locate and open the Logtemp.sql file. The default location for this file is the &quot;\system drive\system32\inetsrv\&quot; folder. <br><br><br><br><span class='text-base'>Note</span> The Logtemp.sql file should look similar to the following:<br><div class='sbody-code'><pre><code>create table inetlog (<br>ClientHost varchar(255), username varchar(255),<br>LogTime datetime, service varchar( 255), machine varchar( 255),<br>serverip varchar( 50), processingtime int, bytesrecvd int,<br>bytessent int, servicestatus int, win32status int,<br>operation varchar( 255), target varchar(255), parameters varchar(255) ) <br></code></pre></div></li><li>Paste the contents of  the Logtemp.sql file into the Query Analyzer, and then click <strong class='uiterm'>Execute</strong> on the <strong class='uiterm'>Query</strong> menu to create the new table for ODBC logging.<br></li></ol></li><li>Create a system Data Source Name (DSN). To do this, follow these steps:<ol class='sbody-alpha_list'><li>Click <strong class='uiterm'>Start</strong>, point to <strong class='uiterm'>Control Panel</strong>, point to <strong class='uiterm'>Administrative Tools</strong>, and then click <strong class='uiterm'>Data Sources (ODBC)</strong>.<br><br></li><li>On the <strong class='uiterm'>System DSN</strong> tab, click <strong class='uiterm'>Add</strong>.<br><br></li><li>Click <strong class='uiterm'>SQL Server</strong>, and then click <strong class='uiterm'>Finish</strong>.<br><br></li><li>Type a name for this DSN in the <strong class='uiterm'>Name</strong> box and type a description for this DSN in the <strong class='uiterm'>Description</strong> box.</li><li>In the <strong class='uiterm'>Server</strong> box, click to select the computer that is  running SQL Server where the database resides, and then click <strong class='uiterm'>Next</strong>.</li><li>Click <strong class='uiterm'>With SQL Server authentication using a network login ID and password entered by the user</strong>, and then click <strong class='uiterm'>Next</strong>.</li><li>Click to select <strong class='uiterm'>Change the Default Database to</strong>, click the SQL Server database that you created to function as the repository for the System Monitor data, and then click <strong class='uiterm'>Next</strong>.</li><li>Click <strong class='uiterm'>Finish</strong>.</li><li>Click <strong class='uiterm'>Test Data Source</strong>. When you receive a <strong class='uiterm'>Tests completed successfully</strong> <br>   message, click <strong class='uiterm'>OK</strong> two times.<br></li></ol></li><li>Enable logging in ODBC format. To do this, follow these steps:<ol class='sbody-alpha_list'><li>Open Internet Services Manager. To do this, click <strong class='uiterm'>Start</strong>, click <strong class='uiterm'>Run</strong>, type <span class='sbody-userinput'>\<strong class='sbody-strong'>system drive</strong>\system32\inetsrv\iis.msc</span>, and then click <strong class='uiterm'>OK</strong>.</li><li>In Internet Services Manager, click the SMTP virtual server, and then click <strong class='uiterm'>Properties</strong> on the <strong class='uiterm'>Action</strong> menu.</li><li>On the <strong class='uiterm'>General</strong> tab, click to select the <strong class='uiterm'>Enable Logging </strong>check box. </li><li>In the <strong class='uiterm'>Active log format</strong> box, click <strong class='uiterm'>ODBC Logging</strong>, and then click <strong class='uiterm'>Properties</strong>.</li><li>In the <strong class='uiterm'>ODBC Data Source Name (DSN) box</strong>, type the ODBC DSN name that you set up in step 3.</li><li>Type <span class='sbody-userinput'>inetlog </span> in the <strong class='uiterm'>Table</strong> box. <br><br><span class='text-base'>Note </span>This name is specified in the Logtemp.sql file. This file is located in the %windir%\System32\Inetsrv folder.</li><li>Type a valid username in the <strong class='uiterm'>User name</strong> box. </li><li>Type the password to the database server in the <strong class='uiterm'>Password</strong> box, and then click <strong class='uiterm'>OK</strong> two times.</li></ol></li></ol></div><div class='kb-securedata-section section'>Author: pattim (2001-07-11T10:28:00)<br><br>Tech Reviewer: LHARDY (2001-08-13T11:31:00)<br>Edit Reviewer: davidg (2001-08-14T03:24:00)<br><br></div>