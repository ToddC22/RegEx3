<header><h1>Workflow: Net: DFS-N: Troubleshoot DFS Namespace connection related issues</h1></header><span asset="4476087" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4476087]</span><ul><li><strong>Content Idea (CI): </strong><a managed-link="" href="https://aka.ms/CIEdit?id=71508" target="" data-content-type="" data-content-id="" bookmark-id="">71508</a></li></ul><div><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">Scenario</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;" lang="en-US"><span style="color:#252525;">DFS (Distributed File System) is a
Windows technology designed to provide&nbsp;</span><a href="https://msdn.microsoft.com/en-us/library/cc771058%28v=ws.11%29.aspx">data
replication</a><span style="color:#252525;">&nbsp;and distributed namespace
access&nbsp;to file shares across an enterprise.</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">DFS Namespace (DFSN) provides the namespace
functionality and DFS Replication (DFSR) the replication functionality. Each
operate independently. Only DFSN is supported by the networking team and
discussed here.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;" lang="en-US"><span style="color:black;">For background reading on DFS Namepace go </span><a href="https://msdn.microsoft.com/en-us/library/cc730736%28v=ws.11%29.aspx">here</a><span style="color:black;">.</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">[Scoping]</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">Please collect the following environmental information
from the customer:</p><ol type="1" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;font-weight:normal;">
 <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">What is the
     issue (customer verbatim as clearly as possible)? What are the symptoms (</span><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;font-style:italic;">Slow
     Access; Access to wrong server; Missing data (folders / files); Red cross
     on mapped drives; Mapped drives going offline</span><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">)?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Is it a Domain based namespace or a standalone?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">What is the UNC path to the DFS namespace? Examples:</span></li>
 <ol type="a" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
  <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><a href="file://namespace/share"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">\\namespace\share</span></a></li>
  <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><a href="file://contoso/Memes"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">\\contoso\Memes</span></a></li>
 </ol>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Are the file servers Windows-based or third-party
     (NetApp, EMC, Samba, etc.)? </span></li>
 <ol type="a" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
  <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">OS or software
      version?</span></li>
  <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">If third-party, what is the highest version
      of SMB supported (1, 2, or 3)?</span></li>
 </ol>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Are the DFS folder targets using short names (CorpFS01)
     or FQDNs (CorpFS01.Contoso.com)?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Are the shares accessible directly by the client
     (bypassing the DFS namespace)?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Is ABE (</span><a href="https://techcommunity.microsoft.com/t5/Ask-the-Directory-Services-Team/Access-Based-Enumeration-ABE-Concepts-part-1-of-2/ba-p/400435"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Access Based Enumeration</span></a><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">) enabled on
     either the DFSN server(s) or the file server?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Is </span><a href="https://d.docs.live.net/13a8a8a0a601d8eb/DFSN/DFSN-TS-Workflow_new_v2.docx#DFS_Referrals_and_IPv6"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Ipv6</span></a><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;"> is enabled on
     the client side (for more information click here)? If not is it disabled
     (not unchecked on the network adapter) in the </span><a href="https://support.microsoft.com/en-us/help/929852/guidance-for-configuring-ipv6-in-windows-for-advanced-users"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">supported way</span></a><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Is the Customer using Offline Files? Does the offline
     files eventlog show that the path in question goes offline?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Are the shares accessible with $NOCSC$
     parameter? (ie. </span><a><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">\\Server$NOCSC$\&lt;somefolder</span></a><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">&gt;) If yes
     it would mean they have problem with Offline Files. For more information
     check this Workflow.</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Does Customer have multiple </span><span style="font-weight:bold;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">ACTIVE writable</span><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;"> folder target for one folder in conjunction
     with other replication technologies (</span><span style="font-style:italic;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Offline Files;
     Roaming Profiles; DFSR</span><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">)? (If yes that’s an </span><a href="https://blogs.technet.microsoft.com/askds/2010/09/01/microsofts-support-statement-around-replicated-user-profile-data/"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">unsupported configuration</span></a><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;"> so first
     Customer should go into a supported state and check if the problem still
     exists.)</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Does Customer have a </span><a href="https://d.docs.live.net/13a8a8a0a601d8eb/DFSN/DFSN-TS-Workflow_new_v2.docx#Backup_and_Restore_of_DFS_Namepace"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">backup</span></a><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;"> of the DFS
     Namespace?</span></li></ol><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">Then ask the customer these impact questions:</p><ul style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:6pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">How many users are impacted?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:6pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">How many servers are impacted?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:6pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">When did this issue start happening?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">Are the file servers local to the clients,
     or across a WAN connection?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">Do end users experience slow connection when
     they try to access the file server directly?</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">Do end users experience slow connections to
     the DFS path or no connectivity?</span></li>
 <ul style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
  <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">Questions for slow connections:</span></li>
  <ul style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
   <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">Are all users experiencing slow
       connections to DFS?</span></li>
   <ul style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
    <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">If no, is there a specific subnet, site,
        group, version of Windows, or file server target that is slow?</span></li>
   </ul>
   <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">What is the expected performance?</span></li>
   <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">What is the unexpected, or slow,
       performance?</span></li>
  </ul>
  <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">Questions for no connectivity:</span></li>
  <ul style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
   <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">Is the computer on the corporate network
       or over a VPN connection?</span></li>
  </ul>
 </ul></ul><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:#222222;" lang="en-US">Sometimes the issues might look like DFSN but in the
background it really might be related to ABE, CSC (Offline Files), permissions
or file server problems at the end.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:#222222;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:white;">Namespace
types</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">Choose a </span><span style="font-weight:bold;background:white;">stand-alone namespace</span><span style="background:white;"> if any of the following conditions apply to your
environment:</span></p><ul style="margin-left:.375in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;background:white;">Your organization does not use Active Directory Domain Services
     (AD&nbsp;DS).</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;background:white;">You want to increase the availability of the namespace by using a
     failover cluster.</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;background:white;">You need to create a single namespace with more than 5,000 DFS
     folders in a domain that does not meet the requirements for a domain-based
     namespace (Windows Server&nbsp;2008 mode) as described later in this
     topic.</span></li></ul><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">Choose a </span><span style="font-weight:bold;background:white;">domain-based namespace</span><span style="background:white;"> if any of the following conditions apply to your
environment:</span></p><ul style="margin-left:.375in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;background:white;">You want to ensure the availability of the namespace by using
     multiple namespace servers.</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;background:white;">You want to hide the name of the namespace server from users. This
     makes it easier to replace the namespace server or migrate the namespace
     to another server.</span></li></ul><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:white;">Choosing
a domain-based namespace mode</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">If you choose a
domain-based namespace, you must choose whether to use the
Windows&nbsp;2000&nbsp;Server mode or the Windows Server&nbsp;2008 mode. The
Windows Server&nbsp;2008 mode includes support for access-based enumeration and
increased scalability. The domain-based namespace introduced in
Windows&nbsp;2000&nbsp;Server is now referred to as &quot;domain-based
namespace (Windows&nbsp;2000&nbsp;Server mode).&quot;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">To use the Windows
Server&nbsp;2008 mode, the domain and namespace must meet the following minimum
requirements:</span></p><ul style="margin-left:.375in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;margin-bottom:8pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;background:white;">The forest uses the Windows
     Server 2003 or higher forest functional level.</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;margin-bottom:8pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;background:white;">The domain uses the Windows
     Server&nbsp;2008 or higher domain functional level.</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;margin-bottom:8pt;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;background:white;">All namespace servers are
     running Windows Server&nbsp;2012&nbsp;R2, Windows Server&nbsp;2012,
     Windows Server&nbsp;2008&nbsp;R2, or Windows Server&nbsp;2008.</span></li></ul><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">If your environment
supports it, choose the Windows Server&nbsp;2008 mode when you create new
domain-based namespaces. This mode provides additional features and
scalability, and also eliminates the possible need to migrate a namespace from
the Windows&nbsp;2000&nbsp;Server mode.</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:#222222;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">Based on what type of namespace is used the
configuration could be stored in different places.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><div><table style="border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width:1pt;margin-left:.3333in;" title="">
 <tbody><tr>
  <td style="border-style:solid;border-color:#A3A3A3;border-width:1pt;vertical-align:top;width:1.7493in;padding:4pt 4pt 4pt 4pt;">
  <p style="margin:0in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;text-align:center;" lang="en-US"><span style="font-weight:bold;">Standalone
  Namespace</span></p>
  </td>
  <td style="border-style:solid;border-color:#A3A3A3;border-width:1pt;vertical-align:top;width:1.8888in;padding:4pt 4pt 4pt 4pt;">
  <p style="margin:0in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;text-align:center;" lang="en-US"><span style="font-weight:bold;">Domain Based
  Namespace</span></p>
  </td>
 </tr>
 <tr>
  <td style="border-style:solid;border-color:#A3A3A3;border-width:1pt;vertical-align:top;width:1.7298in;padding:4pt 4pt 4pt 4pt;">
  <p style="margin:0in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;text-align:center;" lang="en-US">Registry only</p>
  </td>
  <td style="border-style:solid;border-color:#A3A3A3;border-width:1pt;vertical-align:top;width:1.9083in;padding:4pt 4pt 4pt 4pt;">
  <p style="margin:0in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;text-align:center;" lang="en-US">Active Directory and Registry</p>
  </td>
 </tr></tbody></table></div><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">The DFS configuration
Data queried by DFSUtil is stored within the following location within Active
Directory:</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:white;">CN=Dfs-Configuration,CN=System,DC=&lt;domain
DN&gt;</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">In Windows Server 2003,
each Domain DFS Root/Namespace is stored within an &quot;fTDfs&quot; object
which contains an attribute &quot;pKT&quot;&nbsp; containing the configuration
data (namespace settings, namespace servers, folder targets, etc).&nbsp; For
instance, the &quot;DATA&quot; namespace listed in the dfsutil.exe output above
is located with an fTDfs object at this location:&nbsp;
CN=DATA,CN=Dfs-Configuration,CN=System,DC=&lt;domain DN&gt;.&nbsp; No parts of
this object should ever be modified directly.&nbsp;</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:white;">CN=Dfs-Configuration,CN=System,DC=&lt;domain
DN&gt;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:white;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|_fTDfs</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">In Windows Server 2008,
Domain DFS Roots/Namespaces may be configured in &quot;Windows Server 2008
mode&quot;.&nbsp; In this mode, configuration data is stored under an
&quot;msDFS-NamespaceAnchor&quot; class object.&nbsp; An object of class
&quot;msDFS-Namespacev2&quot; represents each root, and each root contains an
&quot;msDFS-Linkv2&quot; object representing each hosted link.</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:white;">CN=Dfs-Configuration,CN=System,DC=&lt;domain
DN&gt;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:white;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|_msDFS-NamespaceAnchor</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:white;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|_msDFS-Namespacev2</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:white;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|_msDFS-Linkv2</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">Each DFS Namespace/Root
server utilizes registry data to identify the root(s) it hosts.&nbsp; Without
this information, the DFS service would not obtain the configuration data from
Active Directory and would fail to host the root(s).&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">Each DFS Namespace/Root
server utilizes registry data to identify the root(s) it hosts.&nbsp; Without
this information, the DFS service would not obtain the configuration data from
Active Directory and would fail to host the root(s).&nbsp;</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">For 2003/2008
domain-based DFS roots, this keys store the root associations:</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style="font-weight:bold;background:white;">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Dfs\Roots\Domain</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">For &quot;Windows Server
2008 mode&quot; roots, the following key stores the root associations:</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style="font-weight:bold;background:white;">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Dfs\Roots\DomainV2</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">Within this key exists a
subkey for each root hosted by the server and specifies the root share via two
values &quot;LogicalShare&quot; and &quot;RootShare&quot;.&nbsp; The key for
the &quot;DATA&quot; root would be as follows:</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style="font-weight:bold;background:white;">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Dfs\Roots\Domain\DATA</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">For standalone DFS
roots, configuration data isn't stored within Active Directory.&nbsp;
Configuration data is stored within the following location:</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style="font-weight:bold;background:white;">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Dfs\Roots\Standalone</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">Beneath the
&quot;Standalone&quot; key exists subkeys for the specific standalone root(s)
hosted by the server, and within each, subkeys containing configuration data
for the hosted folders/links.</span></p><p style="margin:0in;margin-left:.375in;">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="background:white;">The file server shares
specified by the &quot;LogicalShare&quot; and &quot;RootShare&quot; registry
values must exist and be accessible for proper operation of a DFS root.&nbsp;
Access will be denied to a root if the share is missing or is configured with
inappropriate permissions.&nbsp; It is recommended to never directly edit these
registry values.</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">DFS Clients choose their DFS server based on what
Active Directory site they reside in. For more information please check the
following link:</p><p style="margin:0in;margin-left:.375in;"><a href="https://techcommunity.microsoft.com/t5/Ask-the-Directory-Services-Team/Active-Directory-Site-Topology-Not-Just-for-DCs/ba-p/399741"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">https://techcommunity.microsoft.com/t5/Ask-the-Directory-Services-Team/Active-Directory-Site-Topology-Not-Just-for-DCs/ba-p/399741</span></a></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">IPv6 also could play a role in which DFS server will be
used by the client. For more information please check the following link:</p><p style="margin:0in;margin-left:.375in;"><a href="https://blogs.technet.microsoft.com/askds/2009/10/28/dfs-referrals-and-ipv6-outta-site/"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">https://blogs.technet.microsoft.com/askds/2009/10/28/dfs-referrals-and-ipv6-outta-site/</span></a></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">[Distributed File
System: Namespace Scalability and Sizing Questions]</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">To better understand the limitations <span style="font-style:italic;">(folders in one folder; number of folder targets;
links in one root</span>) of the DFS Namespaces please check the following
link:</p><p style="margin:0in;margin-left:.375in;"><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/hh341472%28v%3dws.10%29"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/hh341472%28v%3dws.10%29</span></a></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">[Backup and Restore of
DFS Namespace]</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">The recovery process of a DFS Namespace depends on how
the namespace configuration data was lost, the type of Namespace (domain or
standalone), and what types of backups exist of the data.<span style="">&nbsp; </span>The data may have been inappropriately
modified through the DFS management tools, deleted directly within Active
Directory or the registry, or corrupted.<span style="">&nbsp;
</span>Backups types of the configuration data include System-state backups of
a domain controller, backups of DFS Roots/Namespace servers, exported data via
the dfsutil.exe utility, and DFS service registry keys.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">For more information please check the following link:</p><p style="margin:0in;margin-left:.375in;"><a href="https://support.microsoft.com/en-us/help/969382/recovery-process-of-a-dfs-namespace-in-windows-2003-and-2008-server"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">https://support.microsoft.com/en-us/help/969382/recovery-process-of-a-dfs-namespace-in-windows-2003-and-2008-server</span></a></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">[Data collection]</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;text-decoration:underline;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">Generally speaking it’s always a good idea to collect
data in a working and in the not working scenario as well so you can compare
and check the differences between the two scenario.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;text-decoration:underline;">Simplified
data collection (with TSS tool):</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">Relevant DFS data collection is twofold, issue could be
related to DFS client or DFS server, <span style="font-weight:bold;">best if you
collect simultaneously data on both ends</span> at same time of 'failure', but
depending on actual issue, you can start with single data set on DFS client or
DFS server.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">On <span style="font-weight:bold;">DFS client</span>,
run in elevated CMD window</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp; <span style="font-weight:bold;">TSS.cmd rOn CliOn
DFScli video</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;" lang="en-US"><span style="color:black;">stop data collection immediately after
first error is seen/observed, by </span><span style="color:#222222;background:white;">activating </span><span style="color:black;">the TSS CMD window and '</span><span style="font-weight:bold;color:black;">Hit any key</span><span style="color:black;">',
this will stop data collection.</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:#222222;" lang="en-US">On <span style="font-weight:bold;">DFS server</span>,
run in elevated CMD window (Note: if a domain based DFS namespace is in place,
please logon as <span style="font-weight:bold;">Domain Admin</span>, which has
necessary permission to collect domain-based information)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:#222222;" lang="en-US">&nbsp; <span style="font-weight:bold;">TSS.cmd rOn
SrvOn General DFSsrv&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:#222222;" lang="en-US">stop data collection immediately after failure
situation,<span style="background:white;"> by activating the TSS CMD window and
'</span><span style="font-weight:bold;">Hit any key</span><span style="background:white;">', this will stop data collection.</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:#222222;" lang="en-US"><span style="background:white;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">[Basic understanding how
a traffic should look like]</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">Whenever a client tries to connect to a specific domain
based DFS namespace first time it tries to contact a DC to gather the basic
information about the namespaces.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">514<span style="">&nbsp;&nbsp;&nbsp; </span>8:19:21 AM
4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>7.5226501<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(1244)<span style="">&nbsp;&nbsp;&nbsp;
</span>CL01-W10<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>DC01<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>DFSC<span style="">&nbsp;&nbsp;&nbsp;
</span>DFSC:Get DFS Referral Request, FileName: &lt;empty&gt;,
MaxReferralLevel: 3</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>Frame: Number =
514, Captured Frame Length = 283, MediaType = NetEvent</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ NetEvent: </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ MicrosoftWindowsNDISPacketCapture: Packet Fragment
(182 (0xB6) bytes)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Ethernet: Etype = Internet IP
(IPv4),DestinationAddress:[00-15-5D-2F-2C-01],SourceAddress:[00-15-5D-2F-2C-12]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Ipv4: Src = 10.10.0.129, Dest = 10.10.0.1, Next
Protocol = TCP, Packet ID = 29446, Total IP Length = 168</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Tcp:<span style="">&nbsp; </span>[Bad
CheckSum]Flags=...AP..., SrcPort=49697, DstPort=Microsoft-DS(445),
PayloadLen=128, Seq=1238750887 - 1238751015, Ack=3491382269, Win=1021 (scale
factor 0x8) = 261376</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ SMBOverTCP: Length = 124</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ SMB2: C<span style="">&nbsp;&nbsp; </span>IOCTL
(0xb), FID=0xFFFFFFFFFFFFFFFF </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">- Dfsc: Get DFS Referral Request, FileName:
&lt;empty&gt;, MaxReferralLevel: 3</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>MaxReferralLevel: 3 (0x3)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>RequestFileName: &lt;empty&gt;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">515<span style="">&nbsp;&nbsp;&nbsp; </span>8:19:21 AM
4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>7.5233550<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(684)<span style="">&nbsp;&nbsp;&nbsp;
</span>DC01<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>CL01-W10<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>DFSC<span style="">&nbsp;&nbsp;&nbsp;
</span>DFSC:Get DFS Referral Response, NumberOfReferrals: 2 VersionNumber: 3</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>Frame: Number =
515, Captured Frame Length = 363, MediaType = NetEvent</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ NetEvent: </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ MicrosoftWindowsNDISPacketCapture: Packet Fragment
(262 (0x106) bytes)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Ethernet: Etype = Internet IP
(IPv4),DestinationAddress:[00-15-5D-2F-2C-12],SourceAddress:[00-15-5D-2F-2C-01]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Ipv4: Src = 10.10.0.1, Dest = 10.10.0.129, Next
Protocol = TCP, Packet ID = 7702, Total IP Length = 248</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Tcp: Flags=...AP..., SrcPort=Microsoft-DS(445),
DstPort=49697, PayloadLen=208, Seq=3491382269 - 3491382477, Ack=1238751015,
Win=8211 (scale factor 0x8) = 2102016</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ SMBOverTCP: Length = 204</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ SMB2: R<span style="">&nbsp;&nbsp; </span>IOCTL
(0xb)<span style="">&nbsp; </span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">- Dfsc: Get DFS Referral Response, NumberOfReferrals: 2
VersionNumber: 3</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp; </span>PathConsumed:
0 bytes</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>NumberOfReferrals: 2 (0x2)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>+
ReferralHeaderFlags: 0 (0x0)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>-
ReferralEntries: Version:3</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp; </span>+ ReferralV3:
Index:1 TTL:600 Seconds</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp; </span>+ ReferralV3:
Index:2 TTL:600 Seconds</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>SpecialName:
Index:1 \corp.contoso.com</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>SpecialName:
Index:2 \CORP</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin-left:.375in;margin-top:0pt;margin-bottom:8pt;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">You usually not seeing these requests
as these are happening during the boot / login phase.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;" lang="en-US"><span style="color:black;">As a next step when the client is
connecting to a specific domain-based namespace the client tries to find out
which namespace servers are responsible for that specific namespace (in my
e.g.:<span style="">&nbsp; </span>I tried to access </span><a href="file://corp.contoso.com/Profiles/">\\corp.contoso.com\Profiles\</a><span style="color:black;"> namespace).</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">1151<span style="">&nbsp;&nbsp;&nbsp; </span>8:30:28
AM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.4514655<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(1136)<span style="">&nbsp;&nbsp;&nbsp;
</span>CL01-W10<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>10.10.0.1<span style="">&nbsp;&nbsp;&nbsp; </span>DFSC<span style="">&nbsp;&nbsp;&nbsp;
</span>DFSC:Get DFS Referral Request, FileName: \corp.contoso.com\Profiles,
MaxReferralLevel: 4</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>Frame: Number =
1151, Captured Frame Length = 335, MediaType = NetEvent</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ NetEvent: </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ MicrosoftWindowsNDISPacketCapture: Packet Fragment
(234 (0xEA) bytes)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Ethernet: Etype = Internet IP
(IPv4),DestinationAddress:[00-15-5D-2F-2C-01],SourceAddress:[00-15-5D-2F-2C-12]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Ipv4: Src = 10.10.0.129, Dest = 10.10.0.1, Next
Protocol = TCP, Packet ID = 21012, Total IP Length = 220</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Tcp:<span style="">&nbsp; </span>[Bad
CheckSum]Flags=...AP..., SrcPort=49668, DstPort=Microsoft-DS(445),
PayloadLen=180, Seq=2793587625 - 2793587805, Ack=3108062372, Win=1022 (scale
factor 0x8) = 261632</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ SMBOverTCP: Length = 176</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ SMB2: C<span style="">&nbsp;&nbsp; </span>IOCTL
(0xb), FID=0xFFFFFFFFFFFFFFFF </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">- Dfsc: Get DFS Referral Request, FileName:
\corp.contoso.com\<span style="font-weight:bold;background:yellow;">Profiles</span>, MaxReferralLevel: 4</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>MaxReferralLevel: 4 (0x4)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>RequestFileName: \corp.contoso.com\<span style="font-weight:bold;background:yellow;">Profiles</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">1152<span style="">&nbsp;&nbsp;&nbsp; </span>8:30:28
AM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.4588531<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(0)<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.1<span style="">&nbsp;&nbsp;&nbsp; </span>CL01-W10<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>DFSC<span style="">&nbsp;&nbsp;&nbsp;
</span>DFSC:Get DFS Referral Response, NumberOfReferrals: 2 VersionNumber: 4</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>Frame: Number =
1152, Captured Frame Length = 585, MediaType = NetEvent</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ NetEvent: </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ MicrosoftWindowsNDISPacketCapture: Packet Fragment
(484 (0x1E4) bytes)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Ethernet: Etype = Internet IP
(IPv4),DestinationAddress:[00-15-5D-2F-2C-12],SourceAddress:[00-15-5D-2F-2C-01]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Ipv4: Src = 10.10.0.1, Dest = 10.10.0.129, Next
Protocol = TCP, Packet ID = 8463, Total IP Length = 470</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ Tcp: Flags=...AP..., SrcPort=Microsoft-DS(445),
DstPort=49668, PayloadLen=430, Seq=3108062372 - 3108062802, Ack=2793587805,
Win=8211 (scale factor 0x8) = 2102016</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ SMBOverTCP: Length = 426</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">+ SMB2: R<span style="">&nbsp;&nbsp; </span>IOCTL
(0xb)<span style="">&nbsp; </span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US">- Dfsc: Get DFS Referral Response, NumberOfReferrals: 2
VersionNumber: 4</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp; </span>PathConsumed:
52 bytes</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>NumberOfReferrals: 2 (0x2)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>+
ReferralHeaderFlags: 3 (0x3)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>-
ReferralEntries: Version:4</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp; </span>+ ReferralV4:
Index:1 TTL:300 Seconds</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp; </span>+ ReferralV4:
Index:2 TTL:300 Seconds</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>DfsPath:
\corp.contoso.com\Profiles</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;
</span>DfsAlternatePath: \corp.contoso.com\Profiles</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>TargetPath:
Index:1 \<span style="font-weight:bold;background:aqua;">DC01.CORP.CONTOSO.COM</span>\<span style="font-weight:bold;background:yellow;">Profiles</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:9.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>TargetPath:
Index:2 \<span style="font-weight:bold;background:aqua;">APP01.corp.contoso.com</span>\<span style="font-weight:bold;background:yellow;">Profiles</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">In this case you can see that two servers (<span style="font-weight:bold;background:aqua;">DC01; APP01</span>)
are responsible for my <span style="font-weight:bold;background:yellow;">Profiles</span> namespace.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin-left:.375in;margin-top:0pt;margin-bottom:8pt;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;" lang="en-US"><span style="color:black;">As a next step the client is contacting
with one of the namespace servers to find out the actual (real) path for the
folder you client tries to access. This path is called the </span><span style="font-weight:bold;color:black;">Folder Target</span><span style="color:black;">. In my example I tried to open User1 folder under my
namespace </span><a href="file://corp.contoso.com/Profiles/">\\corp.contoso.com\Profiles\</a><span style="color:black;">. You can see in my configuration the folder I opened is
pointing to a share on </span><span style="font-weight:bold;color:black;">APP01</span><span style="color:black;"> server.</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><div style="margin:0px 0in 0px 0.375in;font-family:&quot;Segoe UI&quot;;font-size:10pt;color:black;" lang="en-US"><span asset="4512701" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4512701]</span><br></div><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><br></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">So, the client is sending out a referral request for
the namespace server to that specific (User1) folder.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">=====</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">100160<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:46
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>31.8715350<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(4480)<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp;
</span>DFSC<span style="">&nbsp;&nbsp;&nbsp; </span>DFSC:Get DFS Referral
Request, FileName: \APP01.corp.contoso.com\Profiles\User1, MaxReferralLevel: 4</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>Frame: Number =
100160, Captured Frame Length = 359, MediaType = NetEvent</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ NetEvent: </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ MicrosoftWindowsNDISPacketCapture: Packet Fragment
(258 (0x102) bytes)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ Ethernet: Etype = Internet IP
(IPv4),DestinationAddress:[00-15-5D-2F-2C-08],SourceAddress:[00-15-5D-2F-2C-12]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ Ipv4: Src = 10.10.0.129, Dest = 10.10.0.50, Next
Protocol = TCP, Packet ID = 4282, Total IP Length = 244</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ Tcp:<span style="">&nbsp; </span>[Bad
CheckSum]Flags=...AP..., SrcPort=55740, DstPort=Microsoft-DS(445),
PayloadLen=204, Seq=4170761863 - 4170762067, Ack=1372595750, Win=1025</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ SMBOverTCP: Length = 200</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ SMB2: C<span style="">&nbsp;&nbsp; </span>IOCTL
(0xb), FID=0xFFFFFFFFFFFFFFFF </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">- Dfsc: Get DFS Referral Request, FileName:
\APP01.corp.contoso.com\Profiles\User1, MaxReferralLevel: 4</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>MaxReferralLevel: 4 (0x4)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>RequestFileName: <span style="font-weight:bold;">\APP01.corp.contoso.com\Profiles\User1</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;" lang="en-US"><span style="color:black;">And gets a reply which is pointing to the
actual (real) path (</span><a href="file://APP01/User1$">\\APP01\User1$</a><span style="color:black;">)</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">=====</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">100167<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:46
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>31.8726749<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(652)<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp; </span>DFSC<span style="">&nbsp;&nbsp;&nbsp; </span>DFSC:Get DFS Referral Response,
NumberOfReferrals: 1 VersionNumber: 4</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>Frame: Number =
100167, Captured Frame Length = 497, MediaType = NetEvent</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ NetEvent: </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ MicrosoftWindowsNDISPacketCapture: Packet Fragment
(396 (0x18C) bytes)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ Ethernet: Etype = Internet IP
(IPv4),DestinationAddress:[00-15-5D-2F-2C-12],SourceAddress:[00-15-5D-2F-2C-08]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ Ipv4: Src = 10.10.0.50, Dest = 10.10.0.129, Next
Protocol = TCP, Packet ID = 21613, Total IP Length = 382</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ Tcp: Flags=...AP..., SrcPort=Microsoft-DS(445),
DstPort=55740, PayloadLen=342, Seq=1372595750 - 1372596092, Ack=4170762067,
Win=8209</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ SMBOverTCP: Length = 338</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">+ SMB2: R<span style="">&nbsp;&nbsp; </span>IOCTL
(0xb)<span style="">&nbsp; </span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">- Dfsc: Get DFS Referral Response, NumberOfReferrals: 1
VersionNumber: 4</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp; </span>PathConsumed:
76 bytes</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;
</span>NumberOfReferrals: 1 (0x1)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>+
ReferralHeaderFlags: 2 (0x2)</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp; </span>-
ReferralEntries: Version:4</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp; </span>+ ReferralV4:
Index:1 TTL:1800 Seconds</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>DfsPath:
Index:1 \APP01.corp.contoso.com\Profiles\User1</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;
</span>DfsAlternatePath: Index:1 \APP01.corp.contoso.com\Profiles\User1</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>TargetPath:
Index:1 <span style="font-weight:bold;background:yellow;">\APP01\User1$</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">Then a standard SMB communication is starting in the
background with the Folder target server.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">=====</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">81272<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6377427<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(4)<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp; </span>TCP<span style="">&nbsp;&nbsp;&nbsp; </span>TCP: [Bad CheckSum]Flags=......S.,
SrcPort=55732, DstPort=Microsoft-DS(445), PayloadLen=0, Seq=3755414043, Ack=0,
Win=64240 ( Negotiating scale factor 0x8 ) = 64240</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">81377<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6381488<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(900)<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp; </span>TCP<span style="">&nbsp;&nbsp;&nbsp; </span>TCP:Flags=...A..S.,
SrcPort=Microsoft-DS(445), DstPort=55732, PayloadLen=0, Seq=13563864,
Ack=3755414044, Win=8192 ( Negotiated scale factor 0x8 ) = 8192</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">81404<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6382646<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(900)<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp; </span>TCP<span style="">&nbsp;&nbsp;&nbsp; </span>TCP: [Bad CheckSum]Flags=...A....,
SrcPort=55732, DstPort=Microsoft-DS(445), PayloadLen=0, Seq=3755414044,
Ack=13563865, Win=8212</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">81510<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6387642<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(4)<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp; </span>SMB<span style="">&nbsp;&nbsp;&nbsp; </span>SMB:C; Negotiate, Dialect = PC NETWORK
PROGRAM 1.0, LANMAN1.0, Windows for Workgroups 3.1a, LM1.2X002, LANMAN2.1, NT
LM 0.12, SMB 2.002, SMB 2.???</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">81744<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6394611<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(4)<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2:R<span style="">&nbsp;&nbsp;
</span>NEGOTIATE (0x0), GUID={E5C28D21-6B24-F283-4444-0236250A9B91} </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">81770<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6396156<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(4)<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp;
</span>SMB2<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2:C<span style="">&nbsp;&nbsp; </span>NEGOTIATE (0x0),
GUID={122C2F5D-1500-6EBB-11E9-6B1162A362B5} </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">81771<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6413918<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(0)<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2:R<span style="">&nbsp;&nbsp;
</span>NEGOTIATE (0x0), GUID={E5C28D21-6B24-F283-4444-0236250A9B91} </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">82643<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6537753<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(4)<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp;
</span>SMB2<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2:C<span style="">&nbsp;&nbsp; </span>SESSION SETUP (0x1) </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">82661<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6549430<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(2440)<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2:R<span style="">&nbsp;&nbsp;
</span>SESSION SETUP (0x1), SessionFlags=0x0 </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">82765<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6555918<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(4)<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp;
</span>SMB2<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2:C<span style="">&nbsp;&nbsp; </span>TREE CONNECT (0x3), Path=\\app01\IPC$ </p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">82766<span style="">&nbsp;&nbsp;&nbsp; </span>2:30:40
PM 4/30/2019<span style="">&nbsp;&nbsp;&nbsp; </span>25.6564229<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>(4480)<span style="">&nbsp;&nbsp;&nbsp;
</span>APP01.corp.contoso.com<span style="">&nbsp;&nbsp;&nbsp;
</span>10.10.0.129<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2<span style="">&nbsp;&nbsp;&nbsp; </span>SMB2:R<span style="">&nbsp;&nbsp;
</span>TREE CONNECT (0x3), TID=0x1</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin-left:.375in;margin-top:0pt;margin-bottom:8pt;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">Of course, all this information above
are cached on the client side. You can check this information with the <span style="font-weight:bold;">dfsuitl </span>tool.</p><p style="margin-left:.375in;margin-top:0pt;margin-bottom:8pt;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">dfsutil
cache domain | dfsutil /SPCinfo </span>– This command list all the domain
related cache information on the client.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">[*][dc01.corp.contoso.com]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">[*][CORP]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">[*][corp.contoso.com]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">[-][CORP]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">[+][corp.contoso.com]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>[+dc01.corp.contoso.com] AccessStatus: 0</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">dfsutil cache referral |
dfsutil /pktinfo</span> – This command list all the referral related
information which has been provided to the client.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:yellow;">This information shows you the actual (real) folder path
for a specific namespace folder (corp.contoso.com\Profiles\User1)</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">Entry: \DC01.CORP.CONTOSO.COM\profiles\User1</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">ShortEntry: \DC01.CORP.CONTOSO.COM\profiles\User1</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">Expires in 1669 seconds</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">UseCount: 0 Type:0x1 ( DFS )</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;
</span>0:[\APP01\User1$] AccessStatus: 0 ( <span style="font-weight:bold;">ACTIVE
TARGETSET</span> )</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="font-weight:bold;background:yellow;">This information shows you which servers are hosting a
specific namespace (\corp.contoso.com\profiles).</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">Entry: \corp.contoso.com\profiles</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">ShortEntry: \corp.contoso.com\profiles</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">Expires in 168 seconds</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">UseCount: 2 Type:0x81 ( REFERRAL_SVC DFS )</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;
</span>0:[\DC01.CORP.CONTOSO.COM\Profiles] AccessStatus: 0 ( <span style="font-weight:bold;">ACTIVE TARGETSET</span> )</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;
</span>1:[\APP01.corp.contoso.com\Profiles]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin-left:.375in;margin-top:0pt;margin-bottom:8pt;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">Whenever you have multiple target you can see one
selected and <span style="font-weight:bold;">ACTIVE TARGETSET</span> and one
selected as <span style="font-weight:bold;">TARGETSET</span>.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">ACTIVE TARGETSET</span>
means that target is actively used by the client.</p><p style="margin:0in;margin-left:.375in;" lang="en-US"><span style="font-weight:bold;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;">TARGETSET</span><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;"> means </span><span>that the server in a different
cost group. </span></p><p style="margin:0in;margin-left:.375in;" lang="en-US">Cost group could be created based on:</p><p style="margin:0in;margin-left:.375in;" lang="en-US">=====</p><ul style="margin-left:.375in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;" lang="en-US"><span>AD Sites</span></li>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;" lang="en-US"><span>DFS Referral ordering
     settings (First among / Last among)</span></li></ul><p style="margin:0in;margin-left:.375in;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">dfsutil cache provider </span>(less
used) – This command shows you which provider / surrogate provider is used
while you trying to access a specific UNC path. Usually clients are using <span style="font-weight:bold;">LanmanRedirector (SMB) </span>as provider and <span style="font-weight:bold;">DfsClient</span> as surrogate provider if the path is
a DFS Path. (<span style="font-style:italic;">if the Surrogate Provider set to </span><span style="font-weight:bold;font-style:italic;">(null)</span><span style="font-style:italic;"> that means we don’t need </span><span style="font-weight:bold;font-style:italic;">DfsClient</span><span style="font-style:italic;"> service to
access that path – direct share</span>).</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">\DC01.CORP.CONTOSO.COM\Profiles [TTL 4m50s]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>UNC
Provider: \Device\<span style="font-weight:bold;">LanmanRedirector</span>
[Priority: 1]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Surrogate
Provider: \Device\<span style="font-weight:bold;">DfsClient</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">\APP01\User1$ [TTL 4m51s]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>UNC
Provider: \Device\<span style="font-weight:bold;">LanmanRedirector</span>
[Priority: 1]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Surrogate
Provider: \Device\<span style="font-weight:bold;">DfsClient </span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US">\app01\Share01 [TTL 14m57s]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>UNC
Provider: \Device\<span style="font-weight:bold;">LanmanRedirector</span>
[Priority: 1]</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:8.0pt;color:black;" lang="en-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Surrogate
Provider: <span style="font-weight:bold;">(null) </span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">Troubleshooting</span></p><ol type="1" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;font-weight:normal;">
 <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Look at the SMB
     traffic to see if the issue is with getting the referral list from the
     namespace server or connecting to the referred file server.</span></li>
 <ol type="a" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
  <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Filter the
      trace by the SMB traffic for the DFS namespace IP address. Example
      filter: tcp.port==445</span></li>
  <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Look for the DFS referral.</span></li>
  <ol type="i" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
   <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">The protocol
       is named DFSC by packet capture parsers. Look for the DFSC traffic in
       the filtered results or append the filter with &quot;DFSC&quot;
       in&nbsp;netmon&nbsp;or MA: tcp.port==445 and DFSC</span></li>
   <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">The client should send a DFS Referral
       Request to the DFS namespace server.</span></li>
   <ol type="i" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
    <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">If no DFS
        referral is being sent, and there is no indication of a firewall/AV
        block, then reboot the DFS client to clear any DFS referral caching.
        Then start the data collection steps over again.</span></li>
   </ol>
   <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:12pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">The server should send a DFS Referral
       Response to the DFS client.&nbsp;</span></li>
   <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">The referral step has completed
       successfully if a referral list has been returned.&nbsp;</span><span style="font-weight:bold;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Skip&nbsp;to
       step&nbsp;4 if the referral process completed successfully.</span></li>
  </ol>
  <ol type="i" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
   <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Verify
       whether the DFS Referral Request arrived at the DFS namespace server.</span></li>
   <ol type="i" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
    <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Standard&nbsp;</span><a href="https://www.csssupportwiki.com/index.php/Networking_-_TCP/IP"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">TCP/IP</span></a><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">&nbsp;and firewall
        troubleshooting&nbsp;applies&nbsp;if the referral does not arrive. The
        most likely cause is the traffic being dropped or blocked somewhere.</span></li>
    <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">If the referral request arrives but no
        response is sent:</span></li>
    <ol type="i" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
     <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Make sure
         the Windows Firewall or another network security application is not
         blocking the request.</span></li>
     <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Engage the Active Directory team to
         assist with troubleshooting the DFS namespace server.</span></li>
    </ol>
   </ol>
  </ol>
 </ol>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Look for the DFS client to resolve DNS (assuming it is
     not cached) and make a connection to a file server.</span></li>
 <ol type="a" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
  <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">It is possible
      that Windows will not attempt to contact a referral if there are other
      networking issues, such as a DNS resolution failure.</span></li>
  <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">You can flush the DNS cache after starting
      the trace, but before reproducing the issue, to ensure that Windows will
      perform DNS resolution. This allows you to verify that DNS resolution is
      working correctly.</span></li>
  <ol type="i" style="margin-left:.75in;unicode-bidi:embed;margin-top:0in;margin-bottom:0in;">
   <li value="1" style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Windows 8+
       (PowerShell):&nbsp;</span><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;font-weight:bold;">Clear-DnsClientCache</span></li>
   <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Everything else:&nbsp;</span><span style="font-weight:bold;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">ipconfig&nbsp;/flushdns</span></li>
  </ol>
 </ol>
 <li style="margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:6pt;margin-bottom:0pt;color:black;" lang="en-US"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">Normal&nbsp;</span><a href="https://www.csssupportwiki.com/index.php/Networking_-_SMB"><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">SMB troubleshooting</span></a><span style="font-family:&quot;Segoe UI&quot;;font-size:10.0pt;">&nbsp;applies
     to fixing the file server connection.</span></li></ol><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">&nbsp;</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">&nbsp;</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">Looking for Known
Solutions</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">Common solutions for
this topic</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US"><span style="font-weight:bold;">Mismatched versions of
SMB of File Servers</span></p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">The Windows SMB client will remember the negotiated
version of SMB for each server connection. The next time a connection is made
to the same file server Windows will only send dialects for the previously
negotiated version of SMB. This information is kept in cache until the SMB
client is rebooted. This is done to speed up the SMB connection process.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">SMB remembers the negotiated version of SMB based on
the DFS namespace's UNC path (<a href="file://namespace/share">\\namespace\share</a>)
and&nbsp;<span style="font-weight:bold;">not</span>&nbsp;the UNC of the target
link (<a href="file://fileserver/share">\\fileserver\share</a>) - the referral
UNC used to connect to the actual file server. When the initial DFS connection
negotiated SMB2+, but a future connection used a file server that only supports
SMB1, the connection will fail because the SMB client will only send SMB2 dialects
to an SMB1-only file server.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">The only solution is removing the SMB1-only file
servers from the referral (target link) list in the DFS namespace. SMB1 is
deprecated in Windows and support in future versions of Windows is not
guaranteed; furthermore, DFS namespaces require homogenous SMB version support
across all file servers in the namespace.</p><p style="margin:0in;margin-left:.375in;font-family:&quot;Segoe UI&quot;;font-size:10.0pt;color:black;" lang="en-US">While this is no longer common with Windows-based file
servers, now that Server 2003 is out of support, it can still happen with
Samba-based file servers, or a Samba/Windows mix. Especially when older, legacy
devices are in use or the customer has disabled SMB2 on a device.</p></div><div><div></div><p style="margin:0cm 0cm 8pt;font-size:11pt;font-family:Calibri, sans-serif;"><span lang="HU" style="font-size:10.5pt;font-family:&quot;Segoe UI&quot;,sans-serif;color:black;">Contributing
engineer:&nbsp;Tamas Karaszek &lt;Tamas.Karaszek@microsoft.com&gt;<br><span style="font-size:10.5pt;">Feedback/ suggestions:&nbsp;</span><a href="mailto:networkflowdevs@microsoft.com;takarasz@microsoft.com?subject=DFSN-Workflow%20feedback" style="font-size:10.5pt;">EMAIL</a><br><span style="font-size:10.5pt;">For more Windows Networking
Workflows, go to:&nbsp;</span><a href="https://aka.ms/networkflows" style="font-size:10.5pt;">https://aka.ms/networkflows</a><br></span></p></div>