<header><h1>&quot;Out of Memory&quot; error message appears when you have a large number of programs running</h1></header><div class='kb-symptoms-section section'>When you run a large number of Windows-based programs, &quot;Out Of Memory&quot; error messages appear when you attempt to start new programs or try to use programs that are already running, even though you still have plenty of physical and pagefile memory available.<br></div><div class='kb-cause-section section'>This behavior can occur if the desktop heap in the WIN32 subsystem is depleted.<br><br><br><span class='text-base'>Note</span> This problem occurs more often under Windows NT 3.5 as the default size of the desktop heap is 512K. Under Windows NT 3.1 the default value is 3072K. The default was reduced to increase performance.<br></div><div class='kb-resolution-section section'><span><span class='text-base'>Important</span> This section, method, or task contains steps that tell you how to modify the registry. However, serious problems might occur if you modify the registry incorrectly. Therefore, make sure that you follow these steps carefully. For added protection, back up the registry before you modify it. Then, you can restore the registry if a problem occurs. For more information about how to back up and restore the registry, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-1' href='/en-us/help/322756'>322756 </a> How to back up and restore the registry in Windows</div></span>To correct this problem, increase the size of the desktop heap:<br><ol class='sbody-num_list'><li>Run Registry Editor (Regedt32.exe).<br></li><li>From the <strong class='sbody-strong'>HKEY_LOCAL_MACHINE</strong> subtree, go to the following key:<br><br><strong class='sbody-strong'>\System\CurrentControlSet\Control\Session Manager\SubSystems</strong></li><li>Select the <span class='text-base'>Windows</span> value.<br></li><li>From the <span class='text-base'>Edit</span> menu, choose <span class='text-base'>String</span>.<br></li><li>Increase the SharedSection parameter.<br><br><br>For Windows NT:<br>SharedSection specifies the system and desktop heaps using the following format:<br><div class='indent'>      SharedSection=<strong class='sbody-strong'>xxxx</strong>,<strong class='sbody-strong'>yyyy</strong></div>Add &quot;,256&quot; or &quot;,512&quot; after the <strong class='sbody-strong'>yyyy</strong> number. <br><br>For Windows 2000, Windows XP, and Windows Server 2003:<br>SharedSection  uses the following format to specify the system and desktop heaps:<br><div class='indent'>      SharedSection=<strong class='sbody-strong'>xxxx</strong>,<strong class='sbody-strong'>yyyy</strong>,<strong class='sbody-strong'>zzzz<br></strong></div>For 32-bit operating systems, increase the <strong class='sbody-strong'>yyyy</strong>&#160;value to &quot;12288&quot;;<br>Increase the <strong class='sbody-strong'>zzzz</strong> value to &quot;1024&quot;.<br>For 64-bit operating systems, increase the <strong class='sbody-strong'>yyyy</strong>&#160;value to &quot;20480&quot;;<br>Increase the <strong class='sbody-strong'>zzzz</strong> value to &quot;1024&quot;.</li></ol></div><div class='kb-moreinformation-section section'>Windows NT uses a special memory heap for all Windows-based programs running on the desktop. The desktop heap is used for all objects (windows, menus, pens, icons, etc.). When a large number of Windows-based programs are running, this heap may run out of memory. When there is not enough memory to satisfy an allocation request, the system normally returns an error and notifies the user that they are running low on memory. Some programs do not handle the failure gracefully, and in some cases there may not be enough memory to create the error message dialog box. As a result, the requested operation fails without any indication.<br><br><br>The SharedSection key is a long string when viewed using Registry Editor. The default value for this key is as follows.<pre class='sbody-pre'><br>   %SystemRoot%\system32\csrss.exe<br>   ObjectDirectory=\Windows<br>   SharedSection=1024,3072,512<br>   Windows=On<br>   SubSystemType=Windows<br>   ServerDll=basesrv,1<br>   ServerDll=winsrv:GdiServerDllInitialization,4<br>   ServerDll=winsrv:UserServerDllInitialization,3<br>   ServerDll=winsrv:ConServerDllInitialization,2<br>   ProfileControl=Off<br>   MaxRequestThreads=16<br> </pre><br><br>The first SharedSection value (1024) defines the heap size common to all desktops. This includes the global handle table (Window handles are unique machine wide) and shared system settings (such as SystemMetrics). It is unlikely you would ever need to change this value.<br><br>The second SharedSection value (3072) controls the size of the desktop heap that is associated with an interactive window station (used for Windows objects). This static value is used to prevent ill- behaved applications from consuming too many resources. Because the desktop heap is mapped into each process&#39; address space, this value should not be set to an arbitrarily high value (as it would decrease performance), but should only be increased sufficiently to allow all the desired applications to run.<br><br>The third SharedSection value (512) controls the size of the desktop heap for each desktop that is associated with a &quot;non-interactive&quot; window station. If this value is not present, the size of the desktop heap for non-interactive window stations will be same as the size specified for interactive window stations (the second SharedSection value). <br></div><div class='kb-securedata-section section'>prodnt low failure fixed size page file</div><div class='kb-textlegacy-section section'>DOC INFO: Note that this article is referred to by the exchange article &quot;XFOR: Err Msg: Initialization of Dynamic Link Library Failed,&quot; Q158308. If you modify or delete this article, please make corresponding changes in that article. Author: jerryman (1995-03-07T00:00:00) Edit Reviewer: peterlo (1999-01-12T05:54:00) Tech Reviewer: peterlo (1995-03-08T00:00:00)<br></div>