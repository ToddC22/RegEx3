<header><h1>The Windows Time service may generate event ID 7023 after you upgrade to Windows Server 2003 Service Pack 1</h1></header><div class='kb-notice-section section'>BUG #: <a href='http://bugcheck/bugs/ContentMaintenance/32824.asp' title='Link only available for Microsoft corporate network users' target='_blank'>32824 (Content Maintenance)</a>BUG #: <a href='http://bugcheck/bugs/ASDDT_Debug_Investigations/2575.asp' title='Link only available for Microsoft corporate network users' target='_blank'>2575 (ASDDT_Debug_Investigations)</a>BUG #: <a href='http://bugcheck/bugs/ContentMaintenance/69299.asp' title='Link only available for Microsoft corporate network users' target='_blank'>69299 (Content Maintenance)</a></div><div class='kb-symptoms-section section'>After you upgrade a Microsoft Windows Server 2003-based domain controller to Windows Server 2003 Service Pack 1 (SP1), the Windows Time service may not start. In this scenario, the following events  may be logged  in the Windows System log.<h4 class='sbody-h4'>Message 1</h4><h4 class='sbody-h4'>Message 2</h4> Additionally, when you try to start the Windows Time service manually, you may receive one of the following error messages:<div class='sbody-error'>Error 1083: The executable program that this service is configured to run in does not implement the service.</div><div class='sbody-error'>Error 1079: The account specified for this service is different from the account specified for other services running in the same process. </div></div><div class='kb-cause-section section'>This issue may occur if the Local Service account has not been granted  &quot;Change the system time&quot; permissions. Windows Server 2003 SP1 changes the startup configuration of the Windows Time service from Network Service account  to Local Service account. Therefore, the startup account that the Windows Time service uses must have &quot;Change the system time&quot; permissions. <br><br>By default, the Local Service account is not a member of the Administrators group and does not have &quot;Change the system time&quot; permissions. Therefore, the Windows Time service does not start, and event 7023 is logged in the  System log.</div><div class='kb-resolution-section section'>To resolve the issue, use one or more of the following methods: <h3 class='sbody-h3'>Method 1: Grant &quot;Change the system time&quot; permissions to the LocalService account</h3>To grant &quot;Change the system time&quot; permissions to the LocalService account, follow these steps on the domain controller that is experiencing this issue: <ol class='sbody-num_list'><li>Click <strong class='uiterm'>Start</strong>, point to <strong class='uiterm'>Administrative Tools</strong>, and then click <strong class='uiterm'>Domain Controller Security Policy</strong>.</li><li>Double-click <strong class='uiterm'>Local Policies</strong>, and then click <strong class='uiterm'>User Rights Assignment</strong>.</li><li>In the details pane, double-click <strong class='uiterm'>Change the system time</strong>.</li><li>Click <strong class='uiterm'>Add User or Group</strong>, type <span class='sbody-userinput'>LocalService</span>, and then click <strong class='uiterm'>OK</strong>.</li><li>Restart the server. The  Service account and the affected Svchost process are currently being used and will not see the new user   until you restart the server.</li><li> Log on to the server.</li><li>Click <strong class='uiterm'>Start</strong>, point to <strong class='uiterm'>Administrative Tools</strong>, and then click <strong class='uiterm'>Services</strong>. Check whether the  Windows Time  service is started.</li></ol><h3 class='sbody-h3'>Method 2: Change the logon account of the Windows Time service</h3><span><span class='text-base'>Important</span> This section, method, or task contains steps that tell you how to modify the registry. However, serious problems might occur if you modify the registry incorrectly. Therefore, make sure that you follow these steps carefully. For added protection, back up the registry before you modify it. Then, you can restore the registry if a problem occurs. For more information about how to back up and restore the registry, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-1' href='/en-us/help/322756'>322756 </a> How to back up and restore the registry in Windows</div></span>To change the logon account of the Windows Time service, you must modify the registry to separate the Windows Time service from the main Svchost process. To do this, follow these steps:<ol class='sbody-num_list'><li>Search and locate the  Svchost.exe file.</li><li>Make a copy of the Svchost.exe file and call it “Svchost_w32time.exe”.</li><li>Click<strong class='uiterm'> Start</strong>, click<strong class='uiterm'> Run</strong>,   type <span class='sbody-userinput'>regedit</span>, and then click <strong class='uiterm'>OK</strong> to start Registry Editor. </li><li>Locate and then right-click the following registry subkey: <div class='indent'><strong class='uiterm'><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\W32Time</strong></strong></div></li><li>Modify the ImageName key so that the value is <span class='sbody-userinput'>%systemroot%\System32\svchost_w32time.exe -k LocalService</span>. (The default value is %SystemRoot%\System32\svchost.exe -k netsvcs.)</li><li>Exit Registry Editor.</li><li>Click <strong class='uiterm'>Start</strong>, point to <strong class='uiterm'>Administrative Tools</strong>, and then click <strong class='uiterm'>Services</strong>.</li><li>Right-click <strong class='uiterm'>Windows Time</strong>, and then click <strong class='uiterm'>Properties.</strong></li><li>On the <strong class='uiterm'>Log On</strong>  tab, click <strong class='uiterm'>This account</strong>.</li><li>Type the name of a user account that has  &quot;Change the system time&quot;  permissions, or click <strong class='uiterm'>Browse</strong> to select an account.</li><li>Type the password of the new account in the <strong class='uiterm'> Password</strong>  and <strong class='uiterm'>Confirm password</strong>  boxes, and then click <strong class='uiterm'>OK</strong>.</li><li>Right-click <strong class='uiterm'>Windows Time</strong>, and then click <strong class='uiterm'>Start</strong>.</li></ol>If these methods do not resolve  the issue, incorrect permissions that are applied to the Net Logon service or the Windows Time service from Group Policy may cause the issue.   You can use the Resultant Set of Policy tool to verify the permissions, as follows:<ol class='sbody-num_list'><li>Click <strong class='uiterm'>Start</strong>, click <strong class='uiterm'>Run</strong>, type <span class='sbody-userinput'>Rsop.msc</span> in the <strong class='uiterm'>Open</strong> box, and then click <strong class='uiterm'>OK</strong>.</li><li>Expand the <strong class='uiterm'>Computer Configuration\Windows Settings\Security Settings\System Services</strong> folder.</li><li>In the details pane, in the <strong class='uiterm'>Source GPO</strong> column, locate the Group Policy  that is applied to the Net Logon service.</li><li>Use the Active Directory Users and Computers MMC snap-in or the Group Policy MMC snap-in to edit the Group Policy that you noted in step 3.</li><li>Expand the <strong class='uiterm'>Computer Configuration\Windows Settings\Security Settings\System Services</strong> folder.</li><li>In the<strong class='uiterm'> Service Name</strong> list, locate and double-click <strong class='uiterm'>Net Logon</strong>. </li><li>If the policy setting is defined in the template, the <strong class='uiterm'>Edit Security</strong> button is available.  Click <strong class='uiterm'>Edit Security</strong>. <br><br>View the list of accounts to make sure that the list is correct.    Make sure that the LocalService account is added to the list of accounts and has Full Control permission.</li><li>Repeat step 3 through 7 for the  Windows Time service.</li></ol></div><div class='kb-securedata-section section'><span class='text-base'>Author: a-benp, mjstrack</span><br><span class='text-base'>Writer: v-jeffw</span><br><span class='text-base'>Rewrite: v-vimalk</span><br><span class='text-base'>Tech Reviewer:         mjstrack, sober</span><br><span class='text-base'>Editor: v-rhowar</span></div>