<header><h1>SharePoint 2010: Workflow fails to run after pause</h1></header><div class='kb-symptoms-section section'>SharePoint 2010 Workflow fails to run after pause&#160;and workflow status shows &quot;In progress&quot;.&#160;If you click on it to go to the Workflow Status page, workflow history area shows &quot;workflow failed to run.&quot; in latest item&#39;s Description.<br><br>Consider the following scenario:<br><br>A SharePoint 2010 farm has a Web Front End Server with the “Microsoft SharePoint Foundation Web Application” service running and a separate Application Server with the “Microsoft SharePoint Foundation Workflow Timer Service” running (The server does not have the&#160;Web Application service running).&#160;&#160;<br><br>A workflow has been queued for resumption and the Application server with the Workflow Timer Service tries to resume the workflow but fails. <br><br>In this scenario the application server fails to resume the Workflow timer service and the workflow gets stuck&#160;in &quot;In progress&quot; status. The Workflow History list shows &quot;workflow failed to run.&quot;&#160;message.<br><br>Additionally, the&#160;ULS log entries on the SharePoint server may include the following:<br><br>OWSTIMER.EXE (0x0E5C) 0x2184 SharePoint Foundation Workflow Infrastructure 72fu Unexpected Load Workflow Class: System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---&gt; System.NullReferenceException: Object reference not set to an instance of an object. at Microsoft.SharePoint.Workflow.SPWinOeHostServices.EnsurePluggableServices(SPSite site, SPWorkflowExternalDataExchangeServiceCollection services, ExternalDataExchangeService existingServices) at Microsoft.SharePoint.Workflow.SPWinOeHostServices..ctor(SPSite site, SPWeb web, SPWorkflowManager manager, SPWorkflowEngine engine) <br><br>OWSTIMER.EXE (0x0E5C) 0x2184 SharePoint Foundation Workflow Infrastructure 98d8 Unexpected System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---&gt; System.NullReferenceException: Object reference not set to an instance of an object. at Microsoft.SharePoint.Workflow.SPWinOeHostServices.EnsurePluggableServices(SPSite site, SPWorkflowExternalDataExchangeServiceCollection services, ExternalDataExchangeService existingServices) at Microsoft.SharePoint.Workflow.SPWinOeHostServices..ctor(SPSite site, SPWeb web, SPWorkflowManager manager, SPWorkflowEngine engine) <br><br>OWSTIMER.EXE (0x0D64) 0x0E98 SharePoint Foundation Workflow Infrastructure frg9 Medium Workflow could not be run because SPWebApplication.UpdateWorkflowConfigurationSettings was not previously called, and the Web Application service has been disabled on this server. Call UpdateWorkflowConfigurationSettings or turn on the Web Application service for this server.</div><div class='kb-cause-section section'>The Workflow Timer Service tries to read the workflow batchsize settings from the web.config or configuration database for a web application. By default, the batchsize setting is in the web.config file if the server is running the Web Application service.&#160;<br><br>If the Web Application service is not running on the same server and the script in Method 1 (under the &#39;Resolution&#39; section) has not been run, the batchsize setting is neither in the web.config file&#160;nor in the configuration database, then the operation fails.<br><br></div><div class="kb-resolution-section section"><span class="text-base">Method 1</span>:<br>
<br>
Locate&nbsp;one Web Front End server which has Web Application service running, run the following PowerShell command to copy workflow-related configuration from the web.config to the configuration database so it will be available from every server in the Farm.&nbsp;<br>
<br>
&bull; $webapp = Get-SPWebApplication -identity http://&lt;web app name&gt;<br>
&bull; $webapp.UpdateWorkflowConfigurationSettings()<br>
<br>
<span class="text-base">Method 2</span>:<br>
<br>
Start the Web Application Service on all servers that have the Workflow Timer Service running.<br>
<br>
<span class="text-base">Method 3</span>:<br>
<br>
Disable the Workflow Timer Service on servers that are not running the Web Application service.<br>
<br>
&nbsp;</div>
<div class='kb-moreinformation-section section'>A SharePoint workflow is put in a “dehydrated” state when a pause occurs or gets postponed due to the WorkflowPostponeThreshold.&#160; SharePoint 2010 uses a queuing system to control workflow-related stress on farm resources and the content database. By using this system, when the number of workflows executing against a database reaches an administrator-configured threshold, successive workflow operations are added to the queue to be run by the Workflow Timer service. By default, this service receives a batch of workflow work items every minute.<br><br>Several farm administrator settings, directly and indirectly related to the queuing mechanism, affect the performance and scaling for workflow. The following sections describe what these settings do and how to adjust them to meet performance requirements.<br><br><ul class='sbody-free_list'><li>Workflow Postpone Threshold (Set-SPFarmConfig –WorkflowPostponeThreshold &lt;integer&gt;)</li></ul><br>The maximum number of workflows that can execute against a single content database before additional requests and operations are queued. Queued workflows show a status of Starting. This is a farm-wide setting that has a default value of 15. This represents the number of workflow operations that are being processed at a time, not the maximum number of workflows that can be in progress. As workflow operations are completed, successive operations will be able to run.<br><br><ul class='sbody-free_list'><li>Workflow Event Delivery Batch Size (Set-SPWorkflow –BatchSize &lt;integer&gt;)</li></ul><br>The Workflow Timer service is an exception to the postpone threshold limit and will retrieve batches of items from the queue and execute them one at a time. These batches can be larger than the postpone threshold. The number of work items that the service receives per run is set by using the BatchSize property. The BatchSize property can be set one time per Web Application service instance. The default value is 100. <br>When running on application servers that are not configured to be front-end servers, the Workflow Timer service requires workflow configuration settings in Web.config to be set in the configuration database. This must be done through a script that calls UpdateWorkflowConfigurationSettings() on the SPWebApplication object, which will copy the Web.config settings from a front-end server.<br><br>See&#160;the following link for more information<br><br><a id='kb-link-1' href='http://technet.microsoft.com/en-us/library/gg508755.aspx' target='_self'>Estimate performance and capacity planning for workflow in SharePoint Server 2010</a><br></div><div class='kb-securedata-section section'>Author ID (email alias):&#160;jinwan<br>Writer ID (email alias): jinwan, joroar<br>Tech Review ID (email alias): ctrshrpt, spskbpre<br>Confirm Article has been Tech Reviewed: Yes<br>Confirm Article released for Publishing: Yes&#160;</div>