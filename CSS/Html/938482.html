<header><h1>ADDS: Lsass.exe may stop responding on an XP | W2K3 -based computer in an Active Directory domain environment</h1></header><div class='kb-notice-section section'>BUG #: <a href='http://bugcheck/bugs/ContentMaintenance/77645.asp' title='Link only available for Microsoft corporate network users' target='_blank'>77645 (Content Maintenance)</a>BUG #: <a href='http://bugcheck/bugs/WindowsSE/202712.asp' title='Link only available for Microsoft corporate network users' target='_blank'>202712 (Windows SE)</a></div><div class='kb-symptoms-section section'>In an Active Directory domain environment, the Lsass.exe process may  stop responding on a Microsoft Windows Server 2003-based computer or on a Microsoft Windows XP-based computer.<br><br>In this situation, you receive the following error message:<div class='sbody-error'>System Shutdown - The system is shutting down. Please save all work in progress and log off. Any unsaved changes will be lost.<br><br>This shutdown was initiated by NT AUTHORITY\SYSTEM. Shutdown will begin in <strong class='sbody-strong'>&lt;number&gt;</strong> seconds.<br><br>Shutdown message: The system process &#39;C:\WINDOWS\system32\lsass.exe&#39; terminated unexpectedly with status code <strong class='sbody-strong'>&lt;error code&gt;</strong>. The system will now shut down and restart. <br></div>Additionally, the following event is logged in the Application  log:This problem may occur if the following conditions are true:<ul class='sbody-free_list'><li>Some Internet Protocol Security (Ipsec) policies are configured to help secure network communication.</li><li>Security settings are customized for all Group Policy objects (GPOs) that are applied to domain computers. Specifically, the Everyone group and the Authenticated Users group do not have permission to access any GPO. All other groups, such as the Domain Users group and the Domain Computers group, have permission to access the GPOs.</li><li>On Windows Server 2003-based computers, Windows Server 2003 Service Pack 2 is installed.</li><li>On Windows XP-based computers, a hotfix is installed. This hotfix  has a file version that is either later than or equal to  the file version that is described in the following Microsoft Knowledge Base article:<span><div class='indent'><a id='kb-link-1' href='/en-us/help/895406'>895406 </a> All policies on a Windows XP-based computer are refreshed when you enable an IPsec policy<br><br></div></span></li></ul></div><div class='kb-cause-section section'>This problem occurs because the Ipsec module (IPSecsvc.dll) generates an error when the Everyone group and the Authenticated Users group do not have  the Read permission and the Apply Policy permission to access any GPO.</div><div class='kb-workaround-section section'>To work around this problem, make sure that the Authenticated Users group has the Read permission and the Apply Policy permission to  access at least one GPO that is applied to domain computers. To do this,  grant the Authenticated Users group the Read permission and the Apply Policy permission to the default domain policy.</div><div class='kb-status-section section'><span>Microsoft has confirmed that this is a problem in the Microsoft products that are listed in the &quot;Applies to&quot; section.</span></div><div class='kb-moreinformation-section section'>The following is an example of stack output that is generated on a Windows Server 2003-based computer:<div class='sbody-code'><pre><code>0:024&gt; .ecxr<br>eax=00000000 ebx=00000000 ecx=00000002 edx=00042640 esi=00000001 edi=00000000<br>eip=4a113f47 esp=013cfec8 ebp=013cfee4 iopl=0         nv up ei pl nz na po nc<br>cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202<br><br>ChildEBP RetAddr  Args to Child              <br>013cfee4 4a114cac 013cff04 00000102 00000267 ipsecsvc!PolicyVersionsHash+0x9a <br>013cfefc 4a102cc5 00000000 00000267 00000000 ipsecsvc!OnPolicyPoll+0x33 <br>013cff3c 4a100422 00000000 00000018 4a0f0000 ipsecsvc!ServiceWait+0x2bb <br>013cff54 4aba6199 00000001 0010dc84 00000000 ipsecsvc!SPDServiceMain+0x1dd <br>013cff8c 4aba6633 00000002 00000001 0010dc84 lsasrv!LsapStartService+0xc0 <br>013cffa4 77f45e91 00000001 0010dc84 00000000 lsasrv!SrvLoadIPSecSvcs+0x14 <br>013cffb8 7c824829 0010dc78 00000000 00000000 advapi32!ScSvcctrlThreadA+0x21 <br>013cffec 00000000 77f45e70 0010dc78 00000000 kernel32!BaseThreadStart+0x34<br></code></pre></div></div><div class='kb-securedata-section section'><span class='text-base'>Author: stevenxu</span><br><span class='text-base'>Writer: v-zhaoq</span><br><span class='text-base'>Tech Reviewer: herbertm;stevenxu</span><br><span class='text-base'>Editor: v-rhowar</span></div>