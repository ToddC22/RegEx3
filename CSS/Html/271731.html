<header><h1>PPTP clients cannot connect to a PPTP server that has multiple IP addresses</h1></header><div class='kb-notice-section section'><br>- Microsoft Windows XP Home Edition Service Pack 2 (SP2) (Version: (SP2))<br>- Microsoft Windows XP Media Center Edition Service Pack 2 (SP2) (Version: (SP2)) <br><br>- Microsoft Windows XP Professional Service Pack 2 (SP2) (Version: (SP2)) <br><br>- Microsoft Windows XP Tablet PC Edition Service Pack 2 (SP2) (Version: (SP2)) </div><div class='kb-notice-section section'><div internal-content-body=""><div class="internal-content"><div class="bold internal-content-body-title spacer-12-bottom">Microsoft Internal Support Information</div><div class="row"><div class="col-xs-24 internal-content-body-content"><p>BUG #: <a href='http://bugcheck/bugs/ContentMaintenance/11446.asp' title='Link only available for Microsoft corporate network users' target='_blank'>11446 (Content Maintenance)</a></p></div></div></div></div><br><br></div><div class='kb-notice-section section'>This article is a consolidation of SOX010418700086 and archived Microsoft Knowledge Base article 169843. This article will be referenced in an upcoming &quot;RRAS FastTrack Troubleshooter&quot; Knowledge Base article. The &quot;RRAS FastTrack Troubleshooter&quot; article is not currently available. However, we will add a cross-reference to the &quot;RRAS FastTrack Troubleshooter&quot; article when the article becomes available. </div><div class='kb-symptoms-section section'>When you connect to a  Point-to-Point Tunneling Protocol (PPTP) server from a PPTP client computer, the connection may not succeed, and you may receive one of the following error messages, depending on  the version of Microsoft Windows that you are running:<br><ul class='sbody-free_list'><li>In Microsoft Windows 95, Microsoft Windows 98, or Microsoft Windows Millennium Edition (Me):<div class='sbody-error'>Error 650: The Remote Access server is not responding</div></li><li>In Microsoft Windows NT 4.0, Microsoft Windows 2000, Microsoft Windows XP, or Microsoft Windows Server 2003:<div class='sbody-error'>Error 721:  Remote PPP peer is not responding</div></li><li>In Microsoft Windows NT 4.0 or Microsoft Windows 2000:<div class='sbody-error'>Error 629: The port was disconnected by the remote machine.</div></li><li>In Microsoft Windows Server 2000 that has  a virtual private network (VPN)  installed:<div class='sbody-error'>Error 678: There was no answer</div></li></ul></div><div class='kb-cause-section section'>This issue may occur if the PPTP server replies by using an Internet Protocol (IP) address that is different from the address that the PPTP client computer sent the request to. This issue may occur if either one of  the following conditions is true:<ul class='sbody-free_list'><li>The server has multiple IP addresses on the public network interface.</li><li>The server is multihomed, and the configuration of  the default gateway is on the incorrect interface.</li></ul>The PPTP client detects the change in the IP address between the request and the reply. Therefore, the client does not permit the connection to be completed when the other IP address in the reply from the PPTP server is used.</div><div class='kb-resolution-section section'>To resolve this issue, make sure that the PPTP clients establish the connection to the first IP address that is bound to the PPTP server&#39;s public network interface. Also make sure that  you  configure the default gateway on the server to the interface that receives the connection attempt.  Typically, the public network interface receives the connection attempt in this scenario. <br><br>If your PPTP server runs  later version of Windows 2000 Service Pack 4 (SP4) or Windows Server 2003, and multiple IP addresses are bound to the public network interface, the server replies by  using the same IP address that the client computer sent the request for connection to. <span>For more information about change in IP address, click the following article number to view the article in the Microsoft Knowledge Base:<br><br><div class='indent'><a id='kb-link-1' href='/en-us/help/810839'>810839 </a> VPN client cannot establish a connection after you install a service pack<br><br></div></span> If your PPTP server is running Windows 2000 SP4, and a PPTP client tries to connect to the second IP address that is bound to the public network interface, the PPTP server replies by using the first IP address that is bound to the public network interface.<br><br>This issue may occur, depending on the configuration of  your PPTP server that uses  Windows NT Load Balancing Service (WLBS) or Network Load Balancing. The PPTP server that uses Windows 2000 SP4-or-later may work as expected, regardless of the configuration. <span>For more information, click the following article number to view the article in the Microsoft Knowledge Base:<br><br><div class='indent'><a id='kb-link-2' href='/en-us/help/810839'>810839 </a> VPN client cannot establish a connection after you install a service pack<br><br></div></span> This issue may also occur if you publish the PPTP server behind a firewall or a router. If you configure the firewall or the router incorrectly, the source IP address for PPTP reply packets may differ from the address that is  received. To resolve this issue, configure the firewall or the router so that the source of the PPTP reply packets  is the same IP address that the PPTP clients use. PPTP communication is made up  of TCP port 1723 and of the Generic Routing Encapsulation (GRE) protocol (IP protocol 47).</div><div class='kb-status-section section'><span>Microsoft has confirmed that this is a problem in the Microsoft products that are listed in the &quot;Applies to&quot; section.</span></div><div> Windows 95, Windows 98, Windows Me, and  Windows NT 4.0  do not permit a PPTP connection to be completed if the PPTP server replies by using a different IP address.<br><br> Windows 2000 and  Windows XP-based PPTP client computers permit connections if either Internet Connection Sharing  or Internet Connection Firewall (ICF) is in use on the client. When you install Windows 2000 SP4 or  Windows XP SP1 on your PPTP client, the client cannot connect to the PPTP server that replies by using a different IP address. <br><br>If you want your PPTP client that is running either Windows XP SP1 or Windows 2000 SP4-or-later to permit a connection to a PPTP server that replies with a different IP address, you must turn off PPTP address validation. To do so, follow these steps. </div><div class='kb-moreinformation-section section'>Editor&#39;s Note: After Windows XP SP2 releases, replace the previous two paragraphs with the following:<br>Windows 2000 and  Windows XP-based PPTP client computers permit connections if either Internet Connection Sharing  or Internet Connection Firewall (ICF)/Windows Firewall (WF) is in use on the client. When you install Windows 2000 SP4 or  Windows XP SP1-or-later on your PPTP client, the client cannot connect to the PPTP server that replies by using a different IP address. <br><br>If you want your PPTP client that is running either Windows XP SP1-or-later or Windows 2000 SP4-or-later to permit a connection to a PPTP server that replies with a different IP address, you must turn off PPTP address validation. To do so, follow these steps. </div><div class='kb-moreinformation-section section'><span><span class='text-base'>Important</span> This section, method, or task contains steps that tell you how to modify the registry. However, serious problems might occur if you modify the registry incorrectly. Therefore, make sure that you follow these steps carefully. For added protection, back up the registry before you modify it. Then, you can restore the registry if a problem occurs. For more information about how to back up and restore the registry, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-3' href='/en-us/help/322756'>322756 </a> How to back up and restore the registry in Windows</div></span><ol class='sbody-num_list'><li>Click <strong class='uiterm'>Start</strong>, and  then click<strong class='uiterm'> Run</strong>.</li><li>In the <strong class='uiterm'>Open</strong> box, type <strong class='uiterm'>regedit</strong>, and then click <strong class='uiterm'>OK</strong>.</li><li>Locate the following subkey, where &lt;000x&gt; is the network adapter for the WAN Miniport (PPTP) driver: <div class='indent'><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\\{4D36E972-E325-11CE-BFC1-08002bE10318}\&lt;000x&gt; </strong></div></li><li>On the <strong class='uiterm'>Edit</strong> menu, point to <strong class='uiterm'>New</strong>, and then click <strong class='uiterm'>DWORD Value</strong>.</li><li>Type <span class='sbody-userinput'>ValidateAddress</span>, and then press ENTER. <br><br><span class='text-base'>Note</span> By default, the Data value  is <strong class='uiterm'>0 (Off)</strong>. </li><li>Quit Registry Editor.</li><li>Restart your computer.</li></ol></div><div class='kb-moreinformation-section section'>This PPTP client behavior change was made in Windows XP SP1 and in Windows 2000 SP4 during product development  in 2002.  Layer Two Tunneling Protocol (L2TP) connections with Internet Protocol security (IPSec) in Windows XP SP1 and in Windows 2000 SP4 prevent this PPTP client behavior. </div><div class='kb-securedata-section section'>pptp cluster NLBS downlevel down level NLB</div>