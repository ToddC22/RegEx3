<header><h1>SharePoint 2010: Receiving error: “Security token service is not available”</h1></header><div class='kb-symptoms-section section'>You see one or more of the following symptoms:<br><ul class='sbody-free_list'><li>The following error appears in the SharePoint server’s event log every hour:&#160;<br>“An error occurred while receiving the HTTP response to http://localhost:32843/SecurityTokenServiceApplication/securitytoken.svc. This could be due to the service endpoint binding not using the HTTP protocol. This could also be due to an HTTP request context being aborted by the server (possibly due to the service shutting down). See server logs for more details.” </li><li>Users are unable to log in to SharePoint sites protected by claims authentication. </li><li>Various SharePoint services such as user profiles, search etc. do not work as expected. </li></ul></div><div class='kb-cause-section section'>This problem indicates that the secure token service application is not functioning correctly. Following could be the possible causes of this problem:<br><br><ol class='sbody-num_list'><li>A required WCF hotfix has not been installed on the SharePoint server</li><li>Authentication for the SecureTokenServiceApplication is not configured properly in IIS. </li><li>The web.config file of the SecureTokenServiceApplication contains invalid data</li><li>The SecureTokenServiceApplication is not provisioned properly. </li></ol><br><br></div><div class='kb-resolution-section section'>Depending on the cause of the problem, here are the possible resolutions:<br><br><ol class='sbody-num_list'><li>Missing WCF Hotfix: If the server is running Windows Server 2008 SP2, please ensure that the hotfix mentioned at http://support.microsoft.com/kb/971831 is installed. If the server is running Windows Server 2008 R2, the hotfix mentioned at http://support.microsoft.com/kb/976462 must be installed. </li><li>Incorrect Authentication Settings: Please ensure that the authentication settings for the SecureTokenServiceApplication are correctly configured by completing the following steps:<br>a) Open IIS Manager&#160;<br>b)&#160;Expand “Sites”&#160;<br>c)&#160;Expand “SharePoint Web Services”&#160;<br>d)&#160;Select “SecurityTokenServiceApplication”&#160;<br>e) From the “Features” pane, double click on “Authentication” under “IIS”&#160;<br>f) Right click “Forms Authentication” and select “Disable”&#160;<br>g)&#160;The authentication settings page should only have Windows and Anonymous access enable for the security token service to issue tokens properly (and for claims authentication to work properly)&#160;</li><li>Incorrect data in the configuration file: Please review the web.config file of the secure token service application and compare it to a web.config file from a &quot;working&quot; secure token service application. </li><li>SecureTokenServiceApplication not provisioned: Use the following power shell commands to provision the secure token service application<br>$sts = Get-SPServiceApplication | ?{$_ -match &quot;Security&quot;}<br>$sts.Status<br>$sts.Provision()​</li></ol><br><br><br><br></div><div class='kb-securedata-section section'>      <br>    Steps to reproduce:&#160;<br>Product Bug Number: <br>Author ID (email alias):&#160;tehnoonr&#160; <br>Tech Review ID (email alias): spskbpre, ctrshrpt<br>Confirm Article has been Tech Reviewed: Yes<br>Confirm Article released for Publishing: Yes </div>