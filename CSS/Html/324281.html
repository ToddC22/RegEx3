<header><h1>How To Prevent Mail Relay in the IIS SMTP Virtual Server in Windows Server 2003</h1></header><div><span></span></div><div class='kb-securedata-section section'>DO NOT DELETE OR ARCHIVE THIS ARTICLE<br>This article is referenced by TechNet.<br>Contact the Content Business Manager for this product if you have any questions.</div><div class='kb-notice-section section'><span>For a Microsoft Windows 2000 version of this article, see<br> <a id='kb-link-1' href='/EN-US/help/310356'>310356 </a>. <br></span><a class='bookmark' id='toc'></a><h3 class='sbody-h3'>IN THIS TASK</h3><ul class='sbody-free_list'><li><a managed-link="" href='#1' target="" bookmark-id='1'>SUMMARY</a></li><li><ul class='sbody-free_list'><li><a managed-link="" href='#2' target="" bookmark-id='2'>How to Prevent the IIS SMTP Virtual Server from Relaying E-mail Messages</a></li><li><a managed-link="" href='#3' target="" bookmark-id='3'>Troubleshooting</a></li></ul></li><li><a managed-link="" href='#4' target="" bookmark-id='4'>REFERENCES</a></li></ul><a class='bookmark' id='1'></a></div><div class='kb-summary-section section'> This step-by-step article describes how to prevent mail relays for an Internet Information Services (IIS) Simple Mail Transport Protocol (SMTP) virtual server. <br><br> IIS in Windows Server 2003 includes a full-featured SMTP virtual server that you can use to receive and relay e-mail messages to other SMTP servers on your network or to servers on the Internet. The relay function is useful for internal network clients that may have to forward mail to other SMTP servers and for IIS programs that need access to an SMTP server to forward mail.<br><br> When the SMTP virtual server relays e-mail messages, it may forward mail that is addressed to any e-mail domain. With this feature, the SMTP virtual server can forward mail to any internal or external network SMTP server for which is can resolve an MX record. However, if the SMTP virtual server is accessible to Internet users, mail relay is not good because unscrupulous users can forward mail to your SMTP virtual server and as a result, distribute unsolicited commercial e-mail to large numbers of computers. This can have a very adverse impact on available bandwidth for your internal connection, and cause your mail server to be placed on &quot;black hole&quot; lists of open mail relays.<br><br> For a user or computer to relay e-mail messages through an SMTP virtual server, the following two conditions must be met: <br> <ul class='sbody-free_list'><li>The user or computer must be able to access the SMTP virtual server.</li><li>The SMTP virtual server must be configured to relay e-mail messages to other domains.</li></ul><h3 class='sbody-h3'><a class='bookmark' id='2'></a>How to Prevent the IIS  SMTP Virtual Server from Relaying E-mail Messages</h3><ol class='sbody-num_list'><li>Start Internet Information Services Manager or open the Internet Information Services (IIS) snap-in.</li><li>Expand <span class='text-base'><strong class='sbody-strong'>Server_name</strong></span>, where <strong class='sbody-strong'>Server_name</strong> is the name of the server, right-click <strong class='uiterm'>Default SMTP Virtual Server</strong>, and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Access</span> tab, and then under <strong class='uiterm'>Access control</strong>, click <span class='text-base'>Authentication</span>.</li><li>Click to select either or both the <strong class='uiterm'>Basic authentication</strong> and the <strong class='uiterm'>Integrated Windows authentication</strong> check boxes, click to clear the <strong class='uiterm'>Anonymous access</strong> check box (if it is selected), and then click <span class='text-base'>OK</span>. <br><br> By doing so, authentication is required before access is granted to the SMTP virtual server. In this case, if the user or computer does not successfully authenticate, the user or computer cannot send mail to the server. <br><br><span class='text-base'>NOTE</span>: If you click to select the <strong class='uiterm'>Anonymous access</strong>check box and do not click to select the <strong class='uiterm'>Basic authentication</strong>and the <strong class='uiterm'>Integrated Windows authentication</strong> check boxes, all users and computers are able to access the SMTP virtual server. <br><br> This disables authentication. </li><li>Under <strong class='uiterm'>Relay restrictions</strong>, click <span class='text-base'>Relay</span>.</li><li>Note the options that are available in the <span class='text-base'>Relay Restrictions</span> dialog box. By default, the <strong class='uiterm'>Only the list below</strong>option is selected and this list is empty. Additionally, the <strong class='uiterm'>Allow all computers which successfully authenticate to relay, regardless of the list above</strong> option is selected. With this feature, users and computers that can authenticate with the server can relay through the server. All computers are blocked except those that meet the authentication requirements that you configured earlier in the <span class='text-base'>Authentication</span> dialog box of the <span class='text-base'>Access</span> tab. <br><br> Note that if you allow only anonymous access, the server does not authenticate users or computers.</li><li>Click <span class='text-base'>Add</span>, and then do one of the following to add a single computer, group of computers, or a domain: <br><ul class='sbody-free_list'><li>Click <span class='text-base'>Single computer</span>.<br> Type the IP address of the computer that you want in the <span class='text-base'>IP Address</span> box, and then click <span class='text-base'>OK</span>.</li><li>Click <strong class='uiterm'>Group of computers</strong>.<br> Type the subnet address and the Subnet mask of the group into the corresponding boxes, and then click <span class='text-base'>OK</span>.</li><li>Click <span class='text-base'>Domain</span>.<br> Type the domain name that you want in the <span class='text-base'>Name</span> box, and then click <span class='text-base'>OK</span>.</li><li>If you do not want to add a computer, group or computers, or a domain, click <span class='text-base'>Cancel</span>.</li></ul></li><li>Click <span class='text-base'>OK</span>, and then click <span class='text-base'>OK</span>.</li></ol><h3 class='sbody-h3'><a class='bookmark' id='3'></a>Troubleshooting</h3> By default, Microsoft SMTP Service blocks computers from relaying e-mail that you do not want through the SMTP virtual server. The information in this article helps you to evaluate whether the configuration of your SMTP virtual server has changed in a way that allows it relay messages that are sent by unintended hosts.<br><br><a class='bookmark' id='4'></a></div><div><span> For additional information about how to configure a remote SMTP mail relay server, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-2' href='/EN-US/help/324272'>324272 </a> HOW TO: Configure a Remote Domain for an Internet Information Services (IIS) SMTP Mail Relay Server in Windows Server 2003<br></div></span></div><div class='kb-securedata-section section'> Clone Placeholder <br> The following link to a Windows 2000 article is a placeholder only and should be replaced with the appropriate link to the Windows Server 2003 clone after the clone is created. <br><span>For additional information about how to create additional SMTP Virtual Servers, click the article number below to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-7' href='/EN-US/help/303707'>303707 </a> How To Create Additional SMTP Virtual Servers<br></div></span><span>For additional information about how to create or delete a Microsoft SMTP Service domain, click the article number below to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-8' href='/EN-US/help/303708'>303708 </a> How To Create or Delete a Microsoft SMTP Service Domain<br></div></span><span>For additional information about how to configure Microsoft SMTP Service local domains, click the article number below to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-9' href='/EN-US/help/303537'>303537 </a> How To Configure Microsoft SMTP Service Local Domains<br></div></span><span>For additional information about how to enable SMTP protocol logging for IIS, click the article number below to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-10' href='/EN-US/help/303738'>303738 </a> How To Enable SMTP Protocol Logging for Internet Information Services<br></div></span></div><div class='kb-securedata-section section'>kbiis600 kbappsvc </div><div class='kb-textlegacy-section section'>Author: mikekim (2002-06-07T12:44:00) Edit Reviewer: V-DIANAG (2002-07-05T15:06:00) Tech Reviewer: rickbar (2002-07-03T04:15:00)<br> </div>