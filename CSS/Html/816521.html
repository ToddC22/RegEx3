<header><h1>HOW TO: Use IPSec Policy to Secure Terminal Services Communications in Windows Server 2003</h1></header><div class='kb-notice-section section'> For a Microsoft Windows 2000 version of this article, see the following Knowledge Base article:<span><div class='indent'><a id='kb-link-1' href='/EN-US/help/315055'>315055 </a> HOW TO: Use IPSec Policy to Secure Terminal Services Communications in Windows 2000<br></div></span></div><div><span></span></div><div class='kb-securedata-section section'> DO NOT DELETE OR ARCHIVE THIS ARTICLE<br> This article is referenced by TechNet.<br> Contact the Content Business Manager for this product if you have any questions. </div><div class='kb-notice-section section'><a class='bookmark' id='1'></a><h3 class='sbody-h3'>IN THIS TASK</h3><ul class='sbody-free_list'><li><a managed-link="" href='#2' target="" bookmark-id='2'>SUMMARY</a><ul class='sbody-free_list'><li><a managed-link="" href='#3' target="" bookmark-id='3'>How to Create the IPSec Filter List for Terminal Services Communications</a></li><li><a managed-link="" href='#4' target="" bookmark-id='4'>How to Create and Enable IPSec Policy to Secure Terminal Services Communications</a></li><li><a managed-link="" href='#5' target="" bookmark-id='5'>How to Make Sure That Clients Respond to the Terminal Server's Requests for Security</a></li></ul></li></ul><a class='bookmark' id='2'></a></div><div class='kb-summary-section section'>You can use Windows Server 2003 Terminal Services to access programs in a multiple-user Terminal server environment. Communications between the Terminal Services client computer and the server that has Terminal Services enabled may contain sensitive information. Therefore, you may want to optimize security between the Terminal Services client and the Terminal server. This step-by-step article describes how to secure Terminal Services communications by configuring the Terminal server to require varying degrees of encryption by using the RC4 algorithm.<br><br>Many organizations use standardized Internet Protocol security (IPSec) for network security. You can configure IPSec policies on Terminal servers to make sure that IPSec protects all the Terminal Services communications. <br><br>This article assumes that you are configuring computers that are a part of a domain structure. If the computer is not part of a domain structure, you may also have to configure encryption and authentication services. <br><br><span> For additional information about troubleshooting IPSec, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-2' href='/EN-US/help/257225'>257225 </a> Basic IPSec Troubleshooting in Windows 2000 <br></div></span><br><br> To enable IPSec protection for Terminal Services: <br> <ol class='sbody-num_list'><li>Create an IPSec filter list to match the Terminal Services packets.</li><li>Create an IPSec policy to enforce IPSec protection, and then enable the policy. </li><li>Enable the Client (respond-only) policy on the Terminal Services clients.</li></ol><a managed-link="" href='#1' target="" bookmark-id='1'>back to the top</a><h3 class='sbody-h3'><a class='bookmark' id='3'></a>How to Create the IPSec Filter List for Terminal Services Communications</h3><ol class='sbody-num_list'><li>Click <strong class='uiterm'>Start</strong>, click <strong class='uiterm'>Run</strong>, type <span class='sbody-userinput'>gpedit.msc</span>, and then click <strong class='uiterm'>OK</strong>.<br></li><li>Expand <strong class='uiterm'>Computer Configuration</strong>, expand <strong class='uiterm'>Windows Settings</strong>, expand <strong class='uiterm'>Security Settings</strong>, right-click <strong class='uiterm'>IP Security Policies</strong>, and then click <strong class='uiterm'>Manage IP filter lists and filter actions</strong>.</li><li>Click the <strong class='uiterm'>Manage IP Filter Lists</strong> tab, and then click <strong class='uiterm'>Add</strong>.</li><li>Type <span class='sbody-userinput'>terminal services</span> in the<br><strong class='uiterm'>Name</strong> box, and then type <span class='sbody-userinput'>for terminal services connections</span> in the <strong class='uiterm'>Description</strong> box.</li><li>Click to clear the <strong class='uiterm'>Use Add Wizard</strong> check box, and then click <strong class='uiterm'>Add</strong>.</li><li>Click the <strong class='uiterm'>Addressing</strong> tab, click <strong class='uiterm'>My IP Address </strong> in the <strong class='uiterm'>Source address</strong> box, and then click<br><strong class='uiterm'>Any IP Address</strong> in the <strong class='uiterm'>Destination address</strong>box.<br><br>After you complete this step, the filter is applied to outbound packets.</li><li>Verify that the <strong class='uiterm'>Mirrored</strong> check box is selected.<br><br>If this check box is selected, a packet filter is created to match the inbound packets. You must protect all the IPSec-secured communications in both directions. You cannot have IPSec security in only one direction.</li><li>Click the <strong class='uiterm'>Protocol</strong> tab, click<br><strong class='uiterm'>TCP</strong> in the <strong class='uiterm'>Select a protocol</strong> box, and then click <strong class='uiterm'>From this port</strong> .</li><li>Type <span class='sbody-userinput'>3389</span> in the <strong class='uiterm'>From this port</strong> box, click <strong class='uiterm'>To any port</strong>, and then click<br><strong class='uiterm'>OK</strong>. </li><li>Click <strong class='uiterm'>Close</strong>, and then click<br><strong class='uiterm'>Close</strong>.</li></ol><a managed-link="" href='#1' target="" bookmark-id='1'>back to the top</a><h3 class='sbody-h3'><a class='bookmark' id='4'></a>How to Create and Enable IPSec Policy to Secure Terminal Services Communications</h3><ol class='sbody-num_list'><li>Click <strong class='uiterm'>Start</strong>, click <strong class='uiterm'>Run</strong>, type <span class='sbody-userinput'>gpedit.msc</span>, and then click <strong class='uiterm'>OK</strong>.<br></li><li>Right-click <strong class='uiterm'>IP Security Policies</strong> in the left pane, and then click <strong class='uiterm'>Create IP Security Policy</strong>.<br></li><li>After the IP Security Policy Wizard starts, click<br><strong class='uiterm'>Next</strong>. </li><li>On the <strong class='uiterm'>IP Security Policy Name</strong> page, type<br><span class='sbody-userinput'>secure terminal services connection</span> in the<br><strong class='uiterm'>Name</strong> box, and then click <strong class='uiterm'>Next</strong>. </li><li>Click to clear the <strong class='uiterm'>Activate the default response rule</strong> check box, and then click <strong class='uiterm'>Next</strong>. </li><li>On the <strong class='uiterm'>Completing the IP Security Policy Wizard</strong> page, verify that the <strong class='uiterm'>Edit properties</strong> check box is selected, and then click <strong class='uiterm'>Finish</strong>. </li><li>Click the <strong class='uiterm'>Rules</strong> tab, click to clear the<br><strong class='uiterm'>Use Add Wizard </strong>check box, and then click <strong class='uiterm'>Add</strong>.<br></li><li>Click the <strong class='uiterm'>IP Filter List</strong> tab, and then click <strong class='uiterm'>Terminal Services IP Filter List</strong>. </li><li>Click the <strong class='uiterm'>Filter Action</strong> tab, and then click <strong class='uiterm'>Require Security</strong>. </li><li>Click <strong class='uiterm'>Apply</strong>, and then click<br><strong class='uiterm'>OK</strong> .</li><li>Verify that the <strong class='uiterm'>Terminal Services Filter List</strong> check box is selected, and then click <strong class='uiterm'>Close</strong>.<br></li><li>Right-click the new policy, and then click<br><strong class='uiterm'>Assign</strong>. </li></ol><a managed-link="" href='#1' target="" bookmark-id='1'>back to the top</a><h3 class='sbody-h3'><a class='bookmark' id='5'></a>How to Make Sure That Clients Respond to the Terminal Server&#39;s Requests for Security<br></h3><ol class='sbody-num_list'><li>Click <strong class='uiterm'>Start</strong>, click <strong class='uiterm'>Run</strong>, type <span class='sbody-userinput'>gpedit.msc</span>, and then click <strong class='uiterm'>OK</strong>.<br></li><li>Expand <strong class='uiterm'>Security Settings</strong> in the left pane, right-click the <strong class='uiterm'>Client (respond only)</strong> policy, and then click<br><strong class='uiterm'>Assign</strong>. </li></ol><a managed-link="" href='#1' target="" bookmark-id='1'>back to the top</a></div><div class='kb-securedata-section section'>Bug 5453 - Content Maintenance<br>315055 clone<br>Author: Davidgaz<br>Writer: v-dehaas <br>Tech Reviewer: v-barryb<br> Editor: v-dbrsu</div>