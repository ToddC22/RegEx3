<header><h1>Intune: Troubleshooting BitLocker enforcement</h1></header><span asset="4476087" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4476087]</span><ul><li><strong>Content Idea (CI): </strong><a managed-link="" href="https://aka.ms/CIEdit?id=101303" target="" data-content-type="" data-content-id="" bookmark-id="">101303</a></li></ul><p><strong>Support Topic: </strong><ul><li>Azure\Microsoft Intune\Set Device Compliance\Create Windows policy</li></ul></p><div>When troubleshooting BitLocker policy enforcement issues, start by reading the following KB:<div><br></div><div><a href="https://internal.support.services.microsoft.com/en-us/help/4502023" aria-label="CTRL+Click or CTRL+Enter to follow link https://internal.support.services.microsoft.com/en-us/help/4502023">4502023</a> -&nbsp;Intune: Requirements for automatic Bitlocker encryption during AAD join (<a href="https://internal.support.services.microsoft.com/en-us/help/4502023"><a href="https://internal.support.services.microsoft.com/en-us/help/4502023" aria-label="CTRL+Click or CTRL+Enter to follow link https://internal.support.services.microsoft.com/en-us/help/4502023">https://internal.support.services.microsoft.com/en-us/help/4502023</a></a>)</div><div><br></div><div>Continue below for additional information and troubleshooting tips.</div></div><div><p style="margin:0in;margin-bottom:.0001pt;"><span style="color:#333333;">BitLocker
enforcement on the end device can be of three types:</span></p><p style="margin:0in;margin-bottom:.0001pt;"><ol><li><span style="text-indent:-0.25in;color:rgb(51, 51, 51);">Automatic (during
AADJ for Windows v 1703+) <i>[I sent this in my previous email]</i></span></li><li><span style="text-indent:-0.25in;color:rgb(51, 51, 51);">Silent (Endpoint
protection policy for Windows v 1803+)</span></li><li><span style="text-indent:-0.25in;color:rgb(51, 51, 51);">Interactive
(Endpoint policy for pre Windows v 1803)</span></li></ol><p><p style="margin:0in;margin-bottom:.0001pt;"><ul><li><span style="color:rgb(51, 51, 51);text-indent:-24px;">If your device supports modern Standby (Instant Go) and is HSTI compliant, AADJ will trigger automatic device encryption for Windows version 1703 and above. This does not requires the admin to enforce/deploy an endpoint protection policy.</span></li><li><span style="color:rgb(51, 51, 51);text-indent:-24px;">If your device is HSTI compliant but does not supports modern Standby (Instant Go), you would require an endpoint protection policy to enforce silent Bitlocker encryption. Below settings allow for the same.</span></li></ul><p><p style="margin-left:27.0pt;text-indent:-.25in;vertical-align:middle;"><span asset="4509186" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509186]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><b>The OMA-URI reference for the
above settings</b></p><p style="margin:0in;margin-bottom:.0001pt;">&nbsp;</p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9pt;font-family:&quot;Segoe UI&quot;, sans-serif;font-style:italic;">OMA-URI:
./Device/Vendor/MSFT/BitLocker/RequireDeviceEncryption</span></p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9pt;font-family:&quot;Segoe UI&quot;, sans-serif;font-style:italic;">Value Type: Integer</span></p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9pt;font-family:&quot;Segoe UI&quot;, sans-serif;font-style:italic;">Value: 1&nbsp; (1 = Require, 0 = Not
Configured)</span></p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9pt;font-family:&quot;Segoe UI&quot;, sans-serif;font-style:italic;">&nbsp;</span></p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9pt;font-family:&quot;Segoe UI&quot;, sans-serif;font-style:italic;">OMA-URI:
./Device/Vendor/MSFT/BitLocker/AllowWarningForOtherDiskEncryption</span></p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9pt;font-family:&quot;Segoe UI&quot;, sans-serif;font-style:italic;">Value Type: Integer</span></p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9.0pt;font-family:&quot;Segoe UI&quot;,sans-serif;"><span style="font-style:italic;">Value: 0 (0 = Blocked, 1 = Allowed)</span></span></p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9.0pt;font-family:&quot;Segoe UI&quot;,sans-serif;"><span style="font-style:italic;"><br></span></span></p><p style="margin-left:27.0pt;text-indent:-.25in;vertical-align:middle;"><p style="margin:0in;margin-bottom:.0001pt;"><b>Note:</b> If the setting &quot;<i>Waiting
for other disk encryption</i>&quot; is set to <i>Not configured</i>, then user
receives the toast notification and enabling the encryption would require user
interaction to go through the Bitlocker activation guide.</p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509187" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509187]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><ul><li>If your device does not supports modern Standby but is HSTI compliant, for pre Windows v 1803, an endpoint protection policy with the above settings will deliver the policy to the device but user will need to manually enable Bitlocker encryption by clicking on the toast notification as received and going through the Bitlocker activation guide.</li><li>For Autopilot devices, from 1803 and above, automatic device encryption is supported for standard users vide the settings made available in UI with 1901 Intune release as below. System requirement still remains same as above (HSTI compliant and support for modern Standby)</li></ul><p><div><span asset="4509188" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509188]</span></div><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p style="margin:0in;margin-bottom:.0001pt;"><b>The OMA-URI reference for the
above settings</b></p><p style="margin:0in;margin-bottom:.0001pt;">&nbsp;</p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9pt;font-family:&quot;Segoe UI&quot;, sans-serif;font-style:italic;">OMA-URI:
./Device/Vendor/MSFT/BitLocker/AllowStandardUserEncryption</span></p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9pt;font-family:&quot;Segoe UI&quot;, sans-serif;font-style:italic;">Value Type: Integer</span></p><p style="margin:0in;margin-bottom:.0001pt;"><span style="font-size:9.0pt;font-family:&quot;Segoe UI&quot;,sans-serif;"><span style="font-style:italic;">Value: 1&nbsp; </span></span></p><p style="margin:0in;margin-bottom:.0001pt;">&nbsp;</p><p style="margin:0in;margin-bottom:.0001pt;"><p style="margin:0in;margin-bottom:.0001pt;"><b>Note:</b> This node works in
tandem with the <b>RequireDeviceEncryption</b> and<b>
AllowWarningForOtherDiskEncryption </b>node. As such when you have
RequireDeviceEncryption set to 1, AllowStandardUserEncryption set to 1 and
AllowWarningForOtherDiskEncryption set to 0, this allows silent Bitlocker
encryption for Autopilot devices with standard user profiles.</p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p><b><span style="background:#CCFFCC;">With update to the
Bitlocker Policy CSP, starting with Windows version 1809 and above, the
endpoint protection policy can enable silent Bitlocker encryption on the end
device even if the device is non-HSTI compliant.</span></b></p><p>================================================================</p><p><b><span style="background:aqua;">Errors,
cause and resolution:</span></b></p><p style="margin:0in;margin-bottom:.0001pt;"><p>On the portal, you should see the Bitlocker encryption
failing as shown here:</p><p><span asset="4509189" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509189]</span></p><p>Reasons for failure can be many. The best place to start
looking for error reason is the event viewer <b><span style="background:#CCFFFF;">Applications
and Services log &gt; Windows &gt; Bitlocker API</span></b></p><p><p><b><span style="background:yellow;">#1
&gt; TPM not available</span></b></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509190" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509190]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p><b>Cause:</b> Device may not have a TPM chip or it might be
disabled from BIOS</p><p><b>Resolution: </b>TPM needs to be enabled in BIOS and you
can check the TPM status running <b>tpm.msc </b>from Run. TPM needs to be in
ready state (TPM version 2.0)</p><p style="margin:0in;margin-bottom:.0001pt;"><p><b><span style="background:yellow;">#2
&gt; Bootable media detected</span></b></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509191" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509191]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p><b>Cause:</b> During Bitlocker and TPM provisioning, the
platform takes into account any additional removable media connected to the
system as the normal platform verification parameters.</p><p>As such if Bitlocker provisioning continues with removable
media being attached to the device, on absence of those media drives, it would
prompt for the Bitlocker Recovery as the platform verification will detect
changes in parameters. </p><p>Windows 10 takes care of this situation and does not starts
the Bitlocker provisioning if it detects that additional removable media is
connected.</p><p><b>Resolution:</b> Remove the bootable media and restart.
Check the encryption status post restart.</p><p><b><span style="background:yellow;"># 3
&gt; WinRE not configured</span></b></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509192" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509192]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p><b>Cause: </b>Windows Recovery Environment<b> (WinRE)</b> is
the minimal OS based on Windows Preinstallation Environment<b> (WinPE)</b>
which includes a number of tools to recover, reset and diagnose Windows. <b></b></p><p>If the main OS doesn’t boot on some reason, the computer
tries to run WinRE</p><p>In case of Silent Bitlocker Encryption, Bitlocker encryption
is enabled on OS drive while Windows is still in Pre Boot Environment (Win PE).
This is to protect the OS drive contents. </p><p>As such it is necessary to have WinRE (Recovery Environment)
enabled so that Windows can be recovered in any system crash issues.</p><p>During Windows 10 installation, Windows automatically
creates a system partition for recovery.</p><p style="margin:0in;margin-bottom:.0001pt;"><p><b>Resolution:</b> Check if WinRE is enabled. Run the
command <b><span style="background:#CCFFCC;">reagentc /info</span></b> on an
elevated command prompt:</p><p><span asset="4509193" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509193]</span></p><p>If disabled, to fix this issue or configure WinRE, you need
to run command <b><span style="background:#CCFFCC;">reagentc /enable</span></b>
in administrative command prompt. </p><p><p><span style="background:#F2DCDB;">This command will work only
if you did not made any changes to the system partitions as created by Windows
in default. Windows 10 during installation by default creates a recovery
partition (499MB) which will contain the <b>Winre.wim</b> file</span></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509194" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509194]</span></p><p>Running <b><span style="background:#CCFFCC;">diskpart &gt;
list volume</span></b> command will show you the volumes as created on the hard
drive. If you see that Volume 1 status is not healthy, you are out of luck and
would require to re-install Windows</p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509195" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509195]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p>If the partition status is heathy, but running the <b><span style="background:#CCFFCC;">reagentc /enable</span></b> gives you an error, you
can go and check the BCD entry if Windows Boot Loader contains the recovery
sequence GUID by running <b><span style="background:#CCFFCC;">bcdedit /enum all</span></b></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509196" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509196]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p>In the list of boot variants, find the&nbsp;<b>Windows Boot
Loader&nbsp;</b>section with<b>&nbsp;identifier={current}</b>. <span style="background:#F2DCDB;">The GUID value of&nbsp;<b>recoverysequence&nbsp;</b>attribute
should be unique and not a string of 0’s.</span></p><p>BCD config is out of Intune scope so I will not dig into it.</p><p style="margin:0in;margin-bottom:.0001pt;"><p><b><span style="background:yellow;">#4
&gt; Contact manufacturer for BIOS upgrade</span></b></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509197" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509197]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p><b>Cause:</b> Silent Bitlocker Encryption requires UEFI BIOS
as it does not supports BIOS in legacy mode. Check the BIOS mode using <b><span style="background:#CCFFCC;">msinfo32</span></b></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509198" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509198]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p><b>Resolution: </b>You need to enable UEFI BIOS by booting
to BIOS if your device supports EFI/UEFI. If your device only supports legacy
BIOS, then you are out of luck.</p><p><b><span style="background:yellow;">#5
&gt; Conflicting GPO</span></b></p><p><b>Error:</b> BitLocker Drive Encryption cannot be
applied to this drive because there are conflicting Group Policy settings for
recovery options on operating system drives. Storing recovery information to
Active Directory Domain Services cannot be required when the generation of
recovery passwords is not permitted. Please have your system administrator
resolve these policy conflicts before attempting to enable BitLocker…</p><p><b>Resolution:</b> You need to get rid of the conflicting
GPO</p><p><b><span style="background:yellow;">#6
&gt; SecureBoot could not be read</span></b></p><p><b>Error</b>: BitLocker cannot use Secure Boot for integrity
because the UEFI variable ‘SecureBoot’ could not be read. A required privilege
is not held by the client.</p><p style="margin:0in;margin-bottom:.0001pt;"><p><b>Cause:</b> Check to see if the system TPM supports PCR
[7] and is used by BitLocker/Device Encryption. Run the command <b><span style="background:#CCFFCC;">Manage-bde -protectors -get %systemdrive%</span></b></p><p style="margin:0in;margin-bottom:.0001pt;"><div style="margin:0px 0in 0.000133333px;"><span asset="4509199" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509199]</span><br></div><p>If PCR validation profile doesn't show that BitLocker uses <b>Secure
Boot</b> for integrity validation (for example, PCR validation profile says PCR
0, 2, 4, 11), this indicates that BitLocker cannot use PCR [7] which is a
requirement for silent encryption.</p><div style="margin-top:14px;margin-bottom:14px;"><span asset="4509200" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509200]</span><br></div><p><p><b>Resolution:</b> Ensure Secure Boot is enabled in UEFI
settings. Run <b><span style="background:#CCFFCC;">msinfo32</span></b> to check:</p><p><span asset="4509201" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509201]</span></p><p>However if you something like below, your device does not
have support:</p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509202" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509202]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p><b><span style="background:lime;">Success
events:</span></b></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509203" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509203]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509204" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509204]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p>You can also verify if the Bitlocker Recovery Key has been
uploaded to Azure by checking the device details from under Azure AD devices
section.</p><p><span asset="4509205" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509205]</span></p><p>Registry path to verify the Bitlocker policy as delivered to
the device: <b><span style="background:#CCFFFF;">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PolicyManager\current\device\BitLocker</span></b></p><p style="margin:0in;margin-bottom:.0001pt;"><span asset="4509206" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4509206]</span></p><p style="margin:0in;margin-bottom:.0001pt;"><br></p><p><span style="background:#FFFF99;">The registry path<b>
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PolicyManager\current\device </b>will
contain all the policy as received/enforced by the MDM</span></p></div>