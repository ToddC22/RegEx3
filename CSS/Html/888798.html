<header><h1>How to troubleshoot Simple Network Management Protocol service startup issues</h1></header><div class='kb-notice-section section'><div internal-content-body=""><div class="internal-content"><div class="bold internal-content-body-title spacer-12-bottom">Microsoft Internal Support Information</div><div class="row"><div class="col-xs-24 internal-content-body-content"><p>BUG #: <a href='http://bugcheck/bugs/ContentMaintenance/6616.asp' title='Link only available for Microsoft corporate network users' target='_blank'>6616 (Content Maintenance)</a></p></div></div></div></div></div><div class='kb-notice-section section'>This article applies to Windows 2000. <span class='text-base'>Support for Windows 2000 ends on July 13, 2010.</span> The <a id='kb-link-1' href='/win2000' target='_self'>Windows 2000 End-of-Support Solution Center</a> is a starting point for planning your migration strategy from Windows 2000. For more information see the <a id='kb-link-2' href='/lifecycle/' target='_self'>Microsoft Support Lifecycle Policy</a>.</div><div class='kb-summary-section section'>This article describes some Simple Network Management Protocol (SNMP) service startup issues. This article also describes how to troubleshoot these SNMP service startup issues.</div><div class='kb-moreinformation-section section'>You may experience one of the following symptoms:<br> <ul class='sbody-free_list'><li>The following events are added to the System log:</li><li>The SNMP service stops responding.</li><li>The SNMP process CPU utilization is 70 to 80 percent.</li><li>An access violation occurs in the SNMP process, and then you receive the following error message:<div class='sbody-error'>An application error has occurred and an application log is being generated. SNMP.EXE Exception: access violation (0xc0000005), Address: &lt;<strong class='sbody-strong'>address</strong>&gt;</div></li><li>The stack is overwritten in the SNMP extension agents.</li></ul>To resolve these SNMP issues, use one or more of the following methods, depending on your symptoms:<br> <ul class='sbody-free_list'><li>Apply the latest service pack to the operating system.<br><br><span class='text-base'>Note</span> If you removed the SNMP service after you have applied Microsoft Windows NT 4.0 Service Pack 6a, you must reinstall Windows NT 4.0 Service Pack 6a.</li><li>Install the latest SNMP security update. To download the latest SNMP security update, MS02-006, visit the following Microsoft Web site:<div class='indent'><a id='kb-link-3' href='http://www.microsoft.com/technet/security/bulletin/ms02-006.mspx' target='_self'>http://www.microsoft.com/technet/security/bulletin/MS02-006.mspx</a></div></li><li>Confirm that the SNMP service uses the correct User Datagram Protocol (UDP) ports. The SNMP service uses the default UDP port 161 for general SNMP messages. The SNMP service uses the default UDP port 162 for SNMP trap messages. The SNMP service sends SNMP trap packets to the SNMP trap host or manager by using UDP port 162. If these ports are being used by another service, you can change the settings by modifying the local services file on the agent. The services file is located in the %systemroot%\System32\Drivers\Etc folder.<br><br><span class='text-base'>Note</span> To make sure that another service or program does not bind to UDP port 161, type <span class='sbody-userinput'>netstat –an</span> at a command prompt, and then press ENTER. If you find another service or program that binds to UDP port 161, stop the automatic startup of that service or program.<br><br><span> For more information about a related topic, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-4' href='/en-us/help/158770'>158770 </a> SNMP service will not start with Event ID: 7024<br><br></div></span></li><li>Use the DependOnService feature to make third-party services depend on the SNMP service. The startup of another service may succeed if the SNMP service starts before a third-party service starts. To avoid this timing issue, make the third-party service dependent on the SNMP service by using the DependOnService feature.<span> For more information about the DependOnService feature, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-5' href='/en-us/help/193888'>193888  </a> How to delay loading of specific services<br><br></div></span></li><li>Disable or remove extension agents from the Management Information Base until the issue no longer exists. Disable or remove extension agents one extension agent at a time. The registry entries in the following registry subkey define the list of extension agents that are configured:<div class='indent'><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SNMP\Parameters\ExtensionAgents</strong></div><span class='text-base'>Note</span> The values of the registry entries in the previous registry subkey contain pointers to the <strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SOFTWARE</strong> registry subkey. Find the location in the <strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SOFTWARE</strong> subkey to which these pointers point. Then, obtain the path and the name of the dynamic link library (DLL) files that are listed in the<br><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SOFTWARE</strong>subkey.<br><br>Contact the vendor of the extension agent for the latest version of the DLL files. You must temporarily rename the suspected third-party DLL files that are listed in the <strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SOFTWARE</strong> subkey, and then restart the computer. <br><br><span class='text-base'>Note</span> This method changes the settings in the value data of the<br><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SNMP\Parameters</strong>registry subkey. The following examples show the changed value data in the<br><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SNMP\Parameters</strong>registry subkey. <div class='indent'>Name: 1<br>Value data: SOFTWARE\\Microsoft\\LANManagerMIB2Agent\\CurrentVersion <br><br>Name: 2<br>Value data: SOFTWARE\\Microsoft\\RFC1156Agent\\CurrentVersion <br><br>Name: 3<br>Value data: SOFTWARE\\Microsoft\\DhcpMibAgent\\CurrentVersion <br><br>Name: 4<br>Value data: SOFTWARE\\Microsoft\\WinsMibAgent\\CurrentVersion <br><br>Name: 0<br>Value data: Software\\Microsoft\\W3SVC\\CurrentVersion <br><br>Name: 5<br>Value data: Software\\Microsoft\\MSFTPSVC\\CurrentVersion <br><br>Name: 6<br>Value data: SOFTWARE\\Empire Technologies\\Empire SystemEDGE\\CurrentVersion <br><br>Name: 7<br>Value data: SOFTWARE\\ComputerAssociates\\ARCserveIT\\Base\\SNMP <br><br>Name: dptscsi<br>Value data: SOFTWARE\\DPT\\SNMP\\SCSI_SYSTEM_AGENT\\CurrentVersion <br><br>Name: ASMAgent<br>Value data: SOFTWARE\\AsmAgent\\CurrentVersion</div>The SNMP service loads the extension agents in the same order in which the extension agents are listed in the<br><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SNMP\Parameters</strong>registry subkey. In this example, the DLL files in the corresponding<br><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SOFTWARE</strong> registry subkey of the agent number 7 have the following path and name:<div class='indent'><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\SOFTWARE\ComputerAssociates\ARCserveIT\Base\SNMP</strong><br><br>Name: <strong class='sbody-strong'>path</strong><br>Value data: C:\\Programme\\ComputerAssociates\\ARCserve\\tasnmp<br><br>Name: TrapEnable<br>Value data: 1</div><span class='text-base'>Note</span> DLL files might not be referenced with a .dll file name extension in the registry entry. Sometimes the error messages that are described earlier in the &quot;More Information&quot; section are related to competing SNMP monitors.<br><br>Compaq Insight Manager versions 4.22 and 4.21 are also known to cause this kind of issue. Compaq Insight Manager version 3.6 does not cause this issue.</li></ul>The SNMP agent service is a master agent that runs in the Snmp.exe process. The SNMP agent service accepts the requests of the manager program. Then, the SNMP agent service forwards the requests to the appropriate DLL file for processing.<br><br>To restart the SNMP service, follow these steps:<br> <ol class='sbody-num_list'><li>Click <strong class='uiterm'>Start</strong>, click <strong class='uiterm'>Run</strong>, type <span class='sbody-userinput'>cmd</span> in the <strong class='uiterm'>Open</strong> box, and then click <strong class='uiterm'>OK</strong>.</li><li>At the command prompt, type <span class='sbody-userinput'>net stop snmp</span>, and then press ENTER to stop the SNMP service.</li><li>To see how to configure SNMP agent error logging, type<br><span class='sbody-userinput'>net help start snmp</span> at the command prompt, and then press ENTER.</li><li>Use the checked build of the Snmp.exe program with the following command syntax:<div class='indent'><span class='text-base'>net start snmp [/logtype:<strong class='sbody-strong'>type</strong>] [/loglevel:<strong class='sbody-strong'>level</strong>]</span></div><span class='text-base'>Note</span> The <span class='text-base'>/LOGTYPE:<strong class='sbody-strong'>type</strong></span> parameter determines where the log is created. The possible<br><strong class='sbody-strong'>type</strong> values include the following:<div class='indent'>2 - Write logs into a file. This option creates a file under the %SYSTEMROOT%\System32 folder that is named Snmpdbg.log.<br>4 - Write logs into the System  log.<br>6 - Write logs into both a file and the System  log<br>8 - Show the output in a DebugView window.</div>The default value is 4. <br><br>The <span class='text-base'>/LOGLEVEL:level</span> parameter determines the debug level. More events are logged if you use a higher number for the debug level. The default debug level is 1, and 1 is also the minimum debug level. The range of the debug level is from 1 to 20.<br><br>If you are using a Microsoft Windows XP-based or a Windows Server 2003-based computer, type<br><span class='sbody-userinput'>snmp.exe /debug /loglevel:5 /logtype:2</span> at a command prompt, and then press ENTER. In this case, the  Snmpdbg.log file is written to the directory from which you ran the Snmp.exe command.</li></ol><h3 class='sbody-h3'>How to find the process or the service that loads a particular DLL file</h3>To find the process or the service that loads a particular DLL file, follow these steps:<br> <ol class='sbody-num_list'><li>At a command prompt, type <span class='sbody-userinput'>tlist -m &lt;<strong class='sbody-strong'>module name</strong>&gt;</span>, and then press ENTER. For example, type <span class='sbody-userinput'>tlist -m tasnmp.dll</span> at a command prompt, and then press ENTER.</li><li> In the output of this command, note the process that is associated with the DLL file. </li><li>Disable the service that is related to the DLL file.</li></ol><h3 class='sbody-h3'>Use SNMP resource kit utilities</h3>You can use the Snmputil.exe command-line tool from the Microsoft Windows NT4.0 Resource Kit to run SNMP functions. You can also use the Snmputilg.exe utility to run SNMP functions. The Snmputilg.exe utility has a graphical user interface and is similar to the Snmputil.exe command-line tool.<h3 class='sbody-h3'>SnmpExtensionQuery</h3>The extension agent calls the <span class='text-base'>SnmpExtensionQuery</span> function when it determines whether the object identifier (also known as the OID) of an SNMP request matches the supportedView object identifier. The supportedView object identifier is returned by the DLL file of the extension agent from the <span class='text-base'>SnmpExtensionInit</span> function. The RequestType argument indicates the type of SNMP request that is being processed. The following list describes the possible RequestType arguments:<br> <ul class='sbody-free_list'><li>ASN_RFC1157_GETREQUEST indicates that the SNMP service gets the request.</li><li>ASN_RFC1157_GETNEXTREQUEST indicates that the SNMP service gets the next request.</li></ul></div><div class='kb-moreinformation-section section'>The Oracle Peer SNMP Master Agent version 8.1.5 program uses UDP port 161. For more information about the Oracle Peer SNMP Master Agent program, view the Oracle SNMP Support Reference Guide. To view this document, visit the following San Diego State University Web site: <div class='indent'><a id='kb-link-6' href='http://www.lc.leidenuniv.nl/awcourse/oracle/em.920/a96672/toc.htm' target='_self'>http://www.lc.leidenuniv.nl/awcourse/oracle/em.920/a96672/toc.htm</a></div> Oracle has changed its software to use port 1161 in Oracle Peer SNMP Master Agent 8.1.6.<br><br>If you find that another service or program uses USP port 161, use a tool like Portqry.exe, Findport.exe, or Fport.exe to determine the process of the port that is being used. The Fport.exe tool reports all open TCP/IP and UDP ports and maps these ports to their related programs. To download the Fport.exe tool, visit the following Foundstone, Inc. Web site: <div class='indent'><a id='kb-link-7' href='http://www.foundstone.com' target='_self'>http://www.foundstone.com</a></div>You can use the Portqry.exe tool to help troubleshoot TCP/IP connectivity issues. The Portqry.exe tool runs on Microsoft Windows 2000 and on Windows XP. The Portqry.exe tool reports the port status of TCP and UDP ports on a computer. <br><br><span> Microsoft provides third-party contact information to help you find technical support. This contact information may change without notice. Microsoft does not guarantee the accuracy of this third-party contact information. <br> </span></div><div class='kb-moreinformation-section section'>You may find the following entries in the Snmpdbg.log file on a Microsoft Windows NT 4.0 Service Pack 6a-based computer:<pre class='sbody-pre'>SNMP: INIT: registering service control handler.<br>SNMP: INIT: setting service status to pending.<br>SNMP: INIT: initializing master agent.<br>SNMP: INIT: reading registry parameters.<br>SNMP: INIT: loading permitted managers.<br>SNMP: INIT: loading extension agents.<br>SNMP: INIT: processing SOFTWARE\Microsoft\LANManagerMIB2Agent\CurrentVersion.<br>SNMP: INIT: processing C:\WINNT\System32\lmmib2.dll.<br>SNMP: INIT: processing SOFTWARE\Microsoft\RFC1156Agent\CurrentVersion.<br>SNMP: INIT: processing C:\WINNT\System32\inetmib1.dll.<br>SNMP: INIT: processing SOFTWARE\Microsoft\WinsMibAgent\CurrentVersion.<br>SNMP: INIT: processing C:\WINNT\System32\winsmib.dll.<br>SNMP: INIT: processing SOFTWARE\Microsoft\DhcpMibAgent\CurrentVersion.<br>SNMP: INIT: processing C:\WINNT\System32\dhcpmib.dll.<br>SNMP: INIT: processing SOFTWARE\ComputerAssociates\ARCserveIT\Base\SNMP.<br>SNMP: INIT: processing C:\Programme\ComputerAssociates\ARCserve\tasnmp.<br>SNMP: INIT: processing SOFTWARE\Empire Technologies\Empire SystemEDGE\CurrentVersion.<br>SNMP: INIT: processing C:\WINNT\System32\sysedge.dll.<br>SNMP: INIT: registry parameters successfully read.<br>SNMP: INIT: C:\WINNT\System32\lmmib2.dll loading.<br>SNMP: INIT: C:\WINNT\System32\lmmib2.dll supports 1.3.6.1.4.1.77.1.<br>SNMP: INIT: C:\WINNT\System32\lmmib2.dll loaded successfully.<br>SNMP: INIT: C:\WINNT\System32\inetmib1.dll loading.<br>SNMP: INIT: C:\WINNT\System32\inetmib1.dll supports 1.3.6.1.2.1.2.<br>SNMP: INIT: C:\WINNT\System32\inetmib1.dll supports 1.3.6.1.2.1.3.<br>SNMP: INIT: C:\WINNT\System32\inetmib1.dll supports 1.3.6.1.2.1.4.<br>SNMP: INIT: C:\WINNT\System32\inetmib1.dll supports 1.3.6.1.2.1.5.<br>SNMP: INIT: C:\WINNT\System32\inetmib1.dll supports 1.3.6.1.2.1.6.<br>SNMP: INIT: C:\WINNT\System32\inetmib1.dll supports 1.3.6.1.2.1.7.<br>SNMP: INIT: C:\WINNT\System32\inetmib1.dll loaded successfully.<br>SNMP: INIT: C:\WINNT\System32\winsmib.dll loading.<br>SNMP: INIT: C:\WINNT\System32\winsmib.dll supports 1.3.6.1.4.1.311.1.2.<br>SNMP: INIT: C:\WINNT\System32\winsmib.dll loaded successfully.<br>SNMP: INIT: C:\WINNT\System32\dhcpmib.dll loading.<br>SNMP: INIT: C:\WINNT\System32\dhcpmib.dll supports 1.3.6.1.4.1.311.1.3.<br>SNMP: INIT: C:\WINNT\System32\dhcpmib.dll loaded successfully.<br>SNMP: INIT: C:\Programme\ComputerAssociates\ARCserve\tasnmp loading.<br>(1) SNMP: INIT: C:\Programme\ComputerAssociates\ARCserve\tasnmp supports 1.3.6.1.4.1.11.2.3.9.7.<br>SNMP: INIT: C:\Programme\ComputerAssociates\ARCserve\tasnmp loaded successfully.<br>SNMP: INIT: C:\WINNT\System32\sysedge.dll loading.<br>SNMP: INIT: C:\WINNT\System32\sysedge.dll supports 1.3.6.1.2.1.25.<br>SNMP: INIT: C:\WINNT\System32\sysedge.dll supports 1.3.6.1.4.1.546.<br>SNMP: INIT: C:\WINNT\System32\sysedge.dll loaded successfully.<br>SNMP: INIT: setup udp listen port.<br>SNMP: INIT: error 10047 creating ipx socket.<br>SNMP: INIT: agentCommThread tid=0x282.<br>SNMP: INIT: setting service status to running.<br>SNMP: INIT: agentTrapThread entered.<br>SNMP: TRAP: polling C:\WINNT\System32\sysedge.dll for traps.<br>SNMP: PDU: agentCommThread entered.<br>SNMP: SVC: serviceHandlerFunction entered, dwControl=4.<br>(2)<br>...<br>SNMP: PDU: request received from 10.20.16.20 (59 octets).<br>SNMP: PDU: processing get request containing 2 variable(s).<br>SNMP: PDU: 1.3.6.1.2.1.31.1.6.0 not in supported view(s).<br>SNMP: PDU: request failed, errorStatus=NOSUCHNAME, errorIndex=1.<br>(3)<br>...<br>SNMP: PDU: request received from 10.20.16.20 (43 octets).<br>SNMP: PDU: processing get request containing 1 variable(s).<br>SNMP: PDU: creating query for C:\WINNT\System32\inetmib1.dll (0x76ab4417).<br>SNMP: PDU: adding variable 1 to query 0x76ab4417 (1.3.6.1.2.1.2.1.0).<br>SNMP: PDU: processing query 0x76ab4417.<br>SNMP: PDU: updating variable 1 from query 0x76ab4417 (1.3.6.1.2.1.2.1.0).<br>...<br>SNMP: PDU: request received from 10.20.16.20 (50 octets).<br>SNMP: PDU: processing getnext request containing 1 variable(s).<br>SNMP: PDU: creating query for C:\WINNT\System32\sysedge.dll (0x00b02bfb).<br>SNMP: PDU: adding variable 1 to query 0x00b02bfb (1.3.6.1.4.1.326.2.2.2.1.4.2.1.7).<br>SNMP: PDU: processing query 0x00b02bfb.<br>SNMP: PDU: request failed, errorStatus=GENERR, errorIndex=1.<br>SNMP: PDU: deleting query 0x00b02bfb.<br>(4)<br> </pre><span class='text-base'>Notes</span><ul class='sbody-free_list'><li>In the initialization phase, each agent loads one or more lines that indicate which management information base (MIB) is supported. For example, the following MIB is supported:<div class='indent'>SNMP: INIT: C:\Programme\ComputerAssociates\ARCserve\tasnmp supports 1.3.6.1.4.1.11.2.3.9.7.</div></li><li>The output until the following line is correct if the IPX protocol is not loaded:<div class='indent'>SNMP: SVC: serviceHandlerFunction entered, dwControl=4.</div></li><li>The following error occurs if no agent that supports the 1.3.6.1.2.1.31 object identifier is loaded:<div class='indent'>SNMP: PDU: request failed, errorStatus=NOSUCHNAME, errorIndex=1.</div></li><li>The following error occurs if an extension subagent .dll file (Sysedge.dll) receives a request for processing an MIB object that the .dll file does not support:<div class='sbody-error'>SNMP: PDU: request failed, errorStatus=GENERR, errorIndex=1.</div></li></ul></div><div class='kb-moreinformation-section section'><span> For more information about related topics, click the following article numbers to view the articles in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-8' href='/en-us/help/149421'>149421 </a> Using detailed logging to debug SNMP issues<br><br></div></span><span><div class='indent'><a id='kb-link-9' href='/en-us/help/158770'>158770 </a> SNMP service will not start with event ID: 7024<br><br></div></span><span><div class='indent'><a id='kb-link-10' href='/en-us/help/232663'>232663 </a> How to use the Snmputil.exe tool to verify the Microsoft SNMP agent configuration<br><br></div></span><span><div class='indent'><a id='kb-link-11' href='/en-us/help/314147'>314147 </a> MS02-006: An unchecked buffer in the SNMP service may allow code to run<br><br></div></span><span><div class='indent'><a id='kb-link-12' href='/en-us/help/136403'>136403 </a> Description of UDP ports<br><br></div></span><span><div class='indent'><a id='kb-link-13' href='/en-us/help/233395'>233395 </a> SNMP access violation after installing Windows NT 4.0 Service Pack 4<br><br></div></span><span><div class='indent'><a id='kb-link-14' href='/en-us/help/272680'>272680 </a> SNMP service does not start or hangs on shutdown<br><br></div></span><span><div class='indent'><a id='kb-link-15' href='/en-us/help/314731'>314731 </a> An access violation occurs in SNMP if you run a GETNEXT query against RIP<br><br></div></span><span><div class='indent'><a id='kb-link-16' href='/en-us/help/317960'>317960 </a> SNMP management programs may stop responding if invalid trap frames are received<br><br></div></span>For more information about SNMP, visit the following Microsoft Web site:<div class='indent'><a id='kb-link-17' href='http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/default.mspx?mfr=true' target='_self'>http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/default.mspx?mfr=true</a></div><span> The third-party products that this article discusses are manufactured by companies that are independent of Microsoft. Microsoft makes no warranty, implied or otherwise, regarding the performance or reliability of these products. <br> </span></div><div class='kb-moreinformation-section section'><span><div class='indent'><a id='kb-link-18' href='/en-us/help/157492'>157492 </a> Tracing the SNMP Event Log Extension Agent<br><br></div></span></div><div class='kb-moreinformation-section section'><span><div class='indent'><a id='kb-link-19' href='/en-us/help/177250'>177250 </a> Cheyenne ArcServe may cause SNMP service to fail<br><br></div></span></div><div class='kb-securedata-section section'>ArcserveIT Arcserv 2000 Adv.Edition, Dell Open Manage OpenManager Netserver Agents traps Stop 21a DrWtsn DrWatson DRWTSN32 0xC0000005 80% 100% CPU stack corruption SMNP failure SNMP consuming CPU timeSNMP spiking snmputil.exe MIB snmp-trap SNMPAPI.DLL tasnmp.dll agntsvc.exe Oracle SNMP Peer Master Agent OracleSNMPPeerMasterAgent OracleAgent DBSNMP.EXE Tivoli SMS Site Net Multi Link UPS Compaq Insight Agent MIB</div><div class='kb-securedata-section section'>Content Maintenance Bug number: 6616 </div><div class='kb-securedata-section section'>Author: waltere<br>Writer: v-xieren<br>Tech Reviewer: v-jackho<br>Editor: v-cgold</div>