<header><h1>[SDP3][45b23d1b-c3e1-469c-8743-f9cf5867e60c] Print Spooler Cleanup Diagnostic</h1></header><div class='kb-summary-section section'>The Print Spooler Cleanup Diagnostic can be used to clean non-Microsoft print monitors and processors from Print Spooler for troubleshooting. Additionally, it collects basic information about the print spooler and the computer, such as information about print drivers, printers, basic networking, and failover clustering. &#160;</div><div class='kb-moreinformation-section section'>The Print Spooler Cleanup Diagnostic removes non-Microsoft print processors and monitors by changing information in the registry as follows:&#160;<ul class='sbody-free_list'><li>It removes non-Microsoft print monitors from {PrintRootKey}\Monitors, and moves them to {PrintRootKey}\Disabled Monitors.</li><li>It scans all printer drivers in the printers key, and updates all print drivers that are using one of the disabled monitors and disabled them.</li><li>It removes non-Microsoft print processors {PrintRootKey}\Environments\{Architecture}\Print Processors, and moves them to {PrintRootKey}\Environments\{Architecture}\Disabled Print Processors.</li><li>It scans all printers in the printers key, updates all print drivers that are using one of the disabled print processors, and moves them to &quot;WinPrint.&quot; The old print processor configuration is stored on a registry value named &quot;Disabled Print Processor.&quot; </li></ul><span class='text-base'>Note</span> {PrintRootKey} refers to the registry key containing the spooler service configuration. For the local machine, the subkey is the following: <div class='indent'><strong class='sbody-strong'>HKLM\SYSTEM\CurrentControlSet\Control\Print</strong></div>For Clustered printers, this subkey refers to HKLM\Cluster\Resources\{PrintResource} (where {PrintResource} is a GUID that contains the print resource configuration). {Architecture} refers to the machine architecture. <br><br>Before changing the configuration, the print spooler cleanup creates a backup of the print keys and stops the spooler service. Additionally, it creates a backup of the print spooler service.<br><br>The print spooler cleanup has the following execution modes: <br><ul class='sbody-free_list'><li><span class='text-base'>Express Cleanup</span> - Removes all non-Microsoft print monitors and processors from print spooler </li><li><span class='text-base'>Selective Cleanup</span> - Allows you to select which non-Microsoft print monitors and processors to disable </li><li><span class='text-base'>Express Restore</span> - Re-enables all non-Microsoft print monitors and processors disabled by a previous execution </li><li><span class='text-base'>Selective cleanup/restore</span> - Lets you select which third-party print monitors or print processors you want to re-enable or disable </li></ul>In addition to cleaning non-Microsoft print processors and monitors, the Print Spooler Cleanup Diagnostic also collects information about the computer and the print spooler. This information can be uploaded to Microsoft for troubleshooting, as listed in the following section. <br><br><h3 class='sbody-h3'>Information collected</h3><h5 class='sbody-h5 text-subtitle'>FailoverCluster feature</h5><div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Description</span></td><td class='sbody-td'><span class='text-base'>File name</span></td></tr><tr class='sbody-tr'><td class='sbody-td'>Basic Failover Cluster information vai clusmps.exe utility (on operating Systems earlier than Windows Server 2008 R2)<br></td><td class='sbody-td'>{ComputerName}_cluster_mps_information.txt<br></td></tr><tr class='sbody-tr'><td class='sbody-td'>Basic Failover Cluster information, including information from existing resources and groups via FailoverCluster PowerShell cmdlets (Windows Server 2008 R2 and newer)<br></td><td class='sbody-td'>          resultreport.xml<br> <br></td></tr></table></div><br><h5 class='sbody-h5 text-subtitle'>General information</h5><div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Description</span></td><td class='sbody-td'><span class='text-base'>File name</span></td></tr><tr class='sbody-tr'><td class='sbody-td'>Basic System Information including machine name, service pack, computer model and processor name and speed<br></td><td class='sbody-td'>          resultreport.xml<br> <br></td></tr></table></div><br><h5 class='sbody-h5 text-subtitle'>Networking basic information</h5><div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Description</span></td><td class='sbody-td'><span class='text-base'>File name</span></td></tr><tr class='sbody-tr'><td class='sbody-td'>Basic SMB configuration information, such as output of net.exe subcommands, such as net share, net sessions, net use, net accounts, net config<br></td><td class='sbody-td'>{ComputerName}_SMB-Info.txt<br></td></tr><tr class='sbody-tr'><td class='sbody-td'>Basic TCP/IP and networking configuration information, such as TCP/IP registry key and outputs from ipconfig, netstat, nbtstat and netsh commands<br></td><td class='sbody-td'>{ComputerName}_TcpIp-Info.txt<br></td></tr></table></div><br><h5 class='sbody-h5 text-subtitle'>Print drivers and printers information</h5><div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Description</span></td><td class='sbody-td'><span class='text-base'>File name</span></td></tr><tr class='sbody-tr'><td class='sbody-td'>Information about Print drivers and printers, including print monitors, processors, and print driver file version information taken after changing spooler configuration<br></td><td class='sbody-td'>{ComputerName}_After changes_PrintInfo.htm<br></td></tr><tr class='sbody-tr'><td class='sbody-td'>Information about Print drivers and printers, including print monitors, processors, and print driver file version information taken prior to change spooler configuration<br></td><td class='sbody-td'>{ComputerName}_Prior to change_PrintInfo.htm<br></td></tr><tr class='sbody-tr'><td class='sbody-td'>Print Resource Registry Key, where {ResourceName} is the name of the print resource (or &#39;Local&#39; to local print spooler) and {Date} is the current date. Print resource registry key is HKLM\SYSTEM\CurrentControlSet\Control\Print for local or HKLM\Cluster\Resources\{ResourceGUID}\Parameters\Printers<br></td><td class='sbody-td'>{ComputerName}_PrintResource-{ResourceName}-{Date}-After_Change.Reg<br></td></tr></table></div><br>In addition to collecting this information, the diagnostic package can perform the following actions: <ul class='sbody-free_list'><li>Check for Event 602 on PrintService/Admin Event Log (KB 2457866)</li><li>Check for the presence of KB 982728 if the Kyocera print driver is installed</li><li>Check for print driver failure to download from a Print Server because of Point and Print Restrictions</li><li>Determine whether the HP Universal Print Driver was upgraded from 5.2 to 5.3</li><li>Check for orphaned print jobs in the Spooler folders</li><li>Check for the number of subkeys under &quot;DevModes2&quot;</li><li>Detect the presence of set*.tmp files in the System32 folder</li><li>Check for the Print Update Rollup for Windows 7 and Windows Server 2008 R2</li><li>Check the size of the Client Side Rendering Print Provider settings</li><li>Determine whether the binary version of win32spl.dll is older than the required version</li><li>Check whether cluster groups are in an Offline or Failed state</li><li>Check for errors when gathering cluster information by using the Get-ClusterNode cmdlet</li><li>Check whether the state of one or more cluster nodes is down or paused</li><li>Determine whether the Cluster service is not running or is offline</li><li>Flag when third-party Print Processor are disabled</li><li>Flag when third-party Print Monitors are disabled</li><li>Flag when third-party Print Monitors are re-enabled</li><li>Flag when third party Print Processors are re-enabled</li><li>Determine whether the diagnostic package is able to communicate with one or more cluster nodes</li><li>Check whether Winprint Print Processor is enabled on the computer</li><li>Flag when Remote Desktop Services are detected</li></ul></div><div class='kb-references-section section'>For more information, click the following article number to go to the article in the Microsoft Knowledge Base:&#160;<div class='indent'><a id='kb-link-1' href='/en-us/help/2598970'>2598970 </a> Information about Microsoft Automated Troubleshooting Services and Support Diagnostic Platform<br></div></div><div class='kb-securedata-section section'>          List of rules in this package:<br>          <br> <div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Rule ID</span></td><td class='sbody-td'><span class='text-base'>Description</span></td><td class='sbody-td'><span class='text-base'>SSID</span></td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrinterKB2457866Check</td><td class='sbody-td'>Check for event 602 on PrintService/Admin Event Log (KB2457866)</td><td class='sbody-td'>be176206-956d-4292-8496-33087667a4b9</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrinterKB982728Check</td><td class='sbody-td'>Check for KB 982728 when Kyocera print driver is installed</td><td class='sbody-td'>37c7811c-047a-41b8-a0f6-9926eeea6dd9</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrinterKB2618460Check</td><td class='sbody-td'>Check if print driver may fail to download from a Print Server due Point and Print Restrictions</td><td class='sbody-td'>ba2104af-9bd9-4b18-b72b-d6c30459619e</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrintingHPTCPMonCheck</td><td class='sbody-td'>Check if HP Port Monitor HPTCPMON is installed</td><td class='sbody-td'>bd5a7e32-c3f4-4a09-999f-c53e45c9c81e</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_HPZ12ServiceCheck</td><td class='sbody-td'>Check if HP Print Services &#39;Net Driver HPZ12&#39; or &#39;Pml Driver HPZ12&#39; are installed</td><td class='sbody-td'>09acdb89-faac-4678-b643-03567fb9c8a0</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrintHpzui4wmCheck</td><td class='sbody-td'>The print spooler may crash or hang due to OEM HP print driver</td><td class='sbody-td'>3cef55d4-c002-4814-b7a1-e136e1fbd50c</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_Check_ZenographicsUI</td><td class='sbody-td'>Checking for the presence of Zenographics Device Manager User Interface</td><td class='sbody-td'>815bc4f4-d848-4d6c-ac6f-63647e0fe5b4</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_2628581_HPUPDUpgrade</td><td class='sbody-td'>Check if HP Universal Print Driver was upgraded from 5.2 to 5.3</td><td class='sbody-td'>3769dbb6-e231-47d3-8b2e-ff2183ea23b5</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrintSpoolerOldSPLSHD</td><td class='sbody-td'>Check for orphaned print jobs in Spooler folders</td><td class='sbody-td'>caad2f13-26ce-457a-b66f-9a3a597895eb</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrintDevModes2CountCheck</td><td class='sbody-td'>Check for the number of subkeys under DevModes2</td><td class='sbody-td'>276b0707-36ed-48f3-84ee-a666f2102ac6</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrintSetTMPSystem32Check</td><td class='sbody-td'>Detect the presence of set*.tmp files in system32 folder</td><td class='sbody-td'>87d27614-c6c9-4998-8b68-eecd8efcae73</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrintZSDDMUICheck</td><td class='sbody-td'>Check the for Zenographics version 6.21 known for causing spooler problems</td><td class='sbody-td'>cd9a5be8-144d-474b-a14b-8cbf33236726</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_Win7PrintUpdateRollupCheck</td><td class='sbody-td'>Check for Print Update Rollup for Windows 7 and Windows Server 2008 R2</td><td class='sbody-td'>fd7538cc-3850-4280-a215-043e9f27dbc2</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrintCSRBloatingCheck</td><td class='sbody-td'>Check the size of Client Side Rendering Print Provider settings</td><td class='sbody-td'>363386bf-0c5b-4d64-a14f-dd2729cb3e0f</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrinterShowOffline</td><td class='sbody-td'> Check if the binary version of win32spl.dll is older than required version.</td><td class='sbody-td'>75c0b3b3-a05f-4d0f-bd14-e956cf5c126f</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_ClusterGroupDown</td><td class='sbody-td'>Check if cluster groups are in Offline or Failed state</td><td class='sbody-td'>696a1ce6-51f5-493f-ae42-03997aab060a</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_ClusterInfoErr</td><td class='sbody-td'>Check for errors gathering cluster information via Get-ClusterNode cmdlet</td><td class='sbody-td'>380f9dfe-ba88-409f-85d7-a3b1e586ed87</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_ClusterNodeDown</td><td class='sbody-td'>Check if the state of one or more cluster nodes is down or paused</td><td class='sbody-td'>65db61bf-9fac-4bf0-b95a-311870d74d4a</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_ClusterSvcDown</td><td class='sbody-td'>Check if Cluster service is not running or offline</td><td class='sbody-td'>497f68a7-df83-45e2-b94b-b7a2538b35ef</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_PrintInfo</td><td class='sbody-td'>Print Drivers and Printers information</td><td class='sbody-td'></td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_DisabledPrintProcessor</td><td class='sbody-td'>Third party Print Processor disabled</td><td class='sbody-td'>8d8a06aa-dd81-4c10-a2c1-ee2eac31edbe</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_DisabledPrintMonitor</td><td class='sbody-td'>Third party Print Monitor disabled</td><td class='sbody-td'>180d72a7-d40f-4859-b8b9-bb5399bea2b4</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_ReEnabledPrintMonitor</td><td class='sbody-td'>Third party Print Monitor re-enabled</td><td class='sbody-td'>0098b34f-423b-4dc9-a454-4afbf1ba9564</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_ReEnabledPrintProcessor</td><td class='sbody-td'>Third party Print Processor re-enabled</td><td class='sbody-td'>229c1352-f579-458c-8ee0-1c9d8f94e7e4</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_UnableCommunicateNodes</td><td class='sbody-td'>Unable to communicate to one or more cluster nodes</td><td class='sbody-td'>180d72a7-d40f-4859-b8b9-bb5399bea2b5</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_WinPrintMissing</td><td class='sbody-td'>Check if Winprint Print Processor is enabled on machine</td><td class='sbody-td'>c936191c-9fd0-4a69-8e39-2d134af02791</td></tr><tr class='sbody-tr'><td class='sbody-td'>RC_RDSSpoolerCleanup</td><td class='sbody-td'>Remote Desktop Services Detected</td><td class='sbody-td'>8a9f6e30-3bbc-4ad7-a1e3-7809d26cb965</td></tr></table></div>          <br>          Steps to reproduce: <br>Product Bug Number:<br> <br>Author ID (email alias): andret <br>Writer ID (email alias): andret <br>Tech Review ID (email alias): kaushika <br>Confirm Article has been Tech Reviewed: Yes<br>Confirm Article released for Publishing: Yes </div>