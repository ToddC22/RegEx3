<header><h1>How to configure Microsoft Distributed Transaction Coordinator on a Windows Server 2003 cluster</h1></header><div class='kb-summary-section section'> This article describes how to install the Microsoft Distributed Transaction Coordinator (MS DTC) resource on a Windows Server 2003 cluster. Microsoft only supports running MS DTC on cluster nodes as a clustered resource. There are two options for installing MS DTC.<br><br>Before you use Cluster Administrator or Cluster.exe to create the MS DTC resource, you must enable Network DTC access.<span> For more information on enabling DTC access, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-1' href='/en-us/help/817064'>817064 </a> How to enable network DTC access in Windows Server 2003<br><br></div></span><span class='text-base'>Notes</span><ul class='sbody-free_list'><li>You should not put  the MS DTC resource online before you follow the instructions in the Microsoft Knowledge Base (KB) 817064 article to enable Network DTC Access. <br><br>For Windows Server 2003-based computers that are running Service Pack 1 or a later service pack, do not follow the steps in the KB817064 article yet. First, you must complete the steps in the following &quot;More information&quot; section to add the MS DTC resource to the cluster. Then, you can follow the steps in the KB817064 article to complete the configuration. </li><li>If this is a Majority Node Set (MNS) cluster, do not use the MNS resource as the storage device for MS DTC. MS DTC requires a storage resource, such as a physical disk.</li></ul></div><div class='kb-moreinformation-section section'> To install the MS DTC, use one of the following methods.<h3 class='sbody-h3'>Method 1: Use Cluster Administrator</h3>This section documents how to install MS DTC through Cluster Administrator on all nodes in a cluster. You only have to install the MS DTC once in Cluster Administrator and MSDTC will be configured on all nodes in the cluster. You do not have to install MS DTC manually on each node. <br> <ol class='sbody-num_list'><li>Start Cluster Administrator. To do so: <br><ol class='sbody-alpha_list'><li>Click <strong class='uiterm'>Start</strong>, and then point to<br> <strong class='uiterm'>All Programs</strong></li><li>In <strong class='uiterm'>Administrative Tools</strong>, click<br> <strong class='uiterm'>Cluster Administrator</strong>.</li></ol></li><li>Create a Group Named &quot;MSDTC Group&quot; that contains a Physical Disk, Network Name, and an IP Address. To do so: <br><ol class='sbody-alpha_list'><li>In the <strong class='uiterm'>File Menu</strong> select<br> <strong class='uiterm'>New</strong>, and then click <strong class='uiterm'>Group</strong>. The New Group Wizard is available.</li><li>Follow the instructions that the New Group Wizard provides to create the MSDTC Group.</li></ol><span class='text-base'>Note</span> When creating the MS DTC, moving the resource group into a group other than SQL Server or Exchange Server group is highly recommended. Creating the MS DTC resource in its own resource group and assigning it to a separate cluster group keeps the resource highly available. <br><br><span class='text-base'>Note</span> If you create the resource in the same cluster group, and if Resource A has failed over, Resource B will also failover. When you create the resouce in a different cluster group, even when Resource A has failed over, the resource B does not failover. Creating Cluster Resouces in the different cluster groups decreases unnecessary failovers of the Cluster Resouces.<br><br><br><span class='text-base'>Important</span> After the new group for MS DTC is created you must create the Network Name, IP address and Physical Disk for Msdtc. You may already have the physical disk resource that can be moved into the new group. After the MS DTC Group is created you must create the IP address resource, Network Name resource and the Physical disk resources. You may already have a physical disk resource that must be moved into the new MS DTC group. </li><li>Create an IP address resource:<br><ol class='sbody-alpha_list'><li>Right-click the MS DTC group, and then click<br> <strong class='uiterm'>New\Resource</strong>. </li><li>Type a descriptive name such as <span class='sbody-userinput'>MSDTC IP Address</span>. </li><li>In <strong class='uiterm'>Resource Type</strong>, click <strong class='uiterm'>IP Address</strong>, click to select the <strong class='uiterm'>MSDTC Group</strong> check box, and then click <strong class='uiterm'>Next</strong>. </li><li>In <strong class='uiterm'>Possible Owners</strong>, click<br> <strong class='uiterm'>Next</strong> unless you do not want MS DTC to run on a particular node.<br> </li><li>In <strong class='uiterm'>Dependencies</strong>, do not add any dependencies, and then click <strong class='uiterm'>Next</strong>. </li><li>In <strong class='uiterm'>TCP/IP Address Parameters</strong>, select the public network, type the unique static IP address for MS DTC, and then click<br> <strong class='uiterm'>Next</strong>.</li><li>Click <strong class='uiterm'>Finish</strong>, and then click<br> <strong class='uiterm'>OK</strong> to confirm that the resource has been created.</li></ol></li><li>Create a Network Name resource:<br><ol class='sbody-alpha_list'><li>Right-click the MS DTC group, and then click<br> <strong class='uiterm'>New\Resource</strong>. </li><li>Type a descriptive name such as <span class='sbody-userinput'>MSDTC Network name</span>. </li><li>In <strong class='uiterm'>Resource Type</strong>, click<br> <strong class='uiterm'>Network name</strong>, click to select the <strong class='uiterm'>MSDTC Group</strong> check box, and then click <strong class='uiterm'>Next</strong>. </li><li>In <strong class='uiterm'>Possible Owners</strong>, click<br> <strong class='uiterm'>Next</strong> unless you do not want MS DTC to run on a particular node.<br> </li><li>In <strong class='uiterm'>Dependencies</strong>, add the MS DTC IP address as a resource dependency, and then click <strong class='uiterm'>Next</strong>.<br> </li><li>In <strong class='uiterm'>Name</strong>, type the network name for the MS DTC resource, and then click <strong class='uiterm'>Next</strong>. </li><li>Click <strong class='uiterm'>Finish</strong>, and then click<br> <strong class='uiterm'>OK</strong> to confirm that the resource has been created.</li></ol></li><li>Create a &quot;Physical disk&quot; resource. <br><br><span class='text-base'>Note</span> You may already have a physical disk resource created. If so, you will have to move this physical disk resource into the MS DTC group and go to the next step.<br><ol class='sbody-alpha_list'><li>Right-click the MS DTC group, and then click<br> <strong class='uiterm'>New\Resource</strong>. </li><li>Type a descriptive name such as <span class='sbody-userinput'>MSDTC Physical disk</span>. </li><li>In <strong class='uiterm'>Resource Type</strong>, click<br> <strong class='uiterm'>Physical disk</strong>, click to select the <strong class='uiterm'>MSDTC Group</strong> check box, and then click <strong class='uiterm'>Next</strong>. </li><li>In <strong class='uiterm'>Possible Owners</strong>, click<br> <strong class='uiterm'>Next</strong> unless you do not want MS DTC to run on a particular node.<br> </li><li>In <strong class='uiterm'>Dependencies</strong>, do not add any dependencies, and then click <strong class='uiterm'>Next</strong>. </li><li>In <strong class='uiterm'>Disk Parameters</strong>, click the physical disk that you will use for MS DTC. </li><li>Click <strong class='uiterm'>Finish</strong>, and then click<br> <strong class='uiterm'>OK</strong> to confirm that the resource has been created.</li></ol></li><li>Right-click the MS DTC Group, and then click<br><strong class='uiterm'>New\Resource</strong>.</li><li>Type a name, such as <span class='sbody-userinput'>MSDTC Resource</span>.</li><li>In <strong class='uiterm'>Resource Type</strong>, click to select<br><strong class='uiterm'>Distributed Transaction Coordinator</strong>, verify that the<br><strong class='uiterm'>MSDTC Group</strong> is selected, and then click<br><strong class='uiterm'>Next</strong>.</li><li>In <strong class='uiterm'>Possible Owners</strong>, click<br><strong class='uiterm'>Next</strong> unless you do not want MS DTC to run on a particular node.</li><li>In <strong class='uiterm'>Dependencies</strong>, press and hold the CTRL key on the keyboard, select both the Physical Disk and Network Name that you created in step 2, and then click the <strong class='uiterm'>Add</strong> button.</li><li>Click <strong class='uiterm'>Finish</strong>, and then click<br><strong class='uiterm'>OK</strong> to confirm that the resource has been created. <br><br><span class='text-base'>Note</span> You should not put the MS DTC resource online before you follow the instructions in Microsoft Knowledge Base article 817064 to enable Network DTC Access.<br></li><li>Complete the steps that are documented in Knowledge Base article 817064. <br><br> </li><li>Right-click the MSDTC Resource, and then click<br><strong class='uiterm'>Bring Online</strong>.</li></ol><h3 class='sbody-h3'>Method 2: Use Cluster.exe</h3> This section documents how to install MSDTC with Cluster.exe. Cluster.exe is optimal for scripting the installation and configuration of MSDTC on several clusters. You only have to configure MS DTC once on a cluster and all nodes in the cluster are updated. <br> <ol class='sbody-num_list'><li>Complete the steps that are documented in Knowledge Base article 817064. <br><br><span class='text-base'>Note</span> It is not necessary to enable network DTC access if the cluster is dedicated to Exchange Server.</li><li>At a command prompt, create a Group named &quot;MSDTC Group&quot; that contains a Physical Disk, Network Name, and an IP Address (or use an existing Group).<br><br><span class='text-base'>Note</span> You can script the creation of Groups and Resources with Cluster.exe. See &quot;Help and Support&quot; and review the Cluster Commands Overview section.<br><br><span class='text-base'>Note</span> We recommend that you create the MS DTC resource in its own resource group, such as you would for Microsoft SQL Server, where you can do so. To do this, follow step 2 to create this new group. If you cannot do this, or if you have a light-use DTC scenario such as a cluster dedicated to Exchange Server, proceed and use the Cluster group. On dedicated Exchange Server clusters, the MS DTC resource should be placed in the default cluster group.<br></li><li>Type the following command at a command prompt:<div class='indent'><span class='sbody-userinput'>cluster clustername res &quot;MSDTC Resource&quot; /CREATE /GROUP:&quot;MSDTC Group&quot; /TYPE:&quot;Distributed Transaction Coordinator&quot;<br></span></div> This command creates the MS DTC Resource.<br><br><span class='text-base'>Note</span> If you are using an existing cluster group, substitute the name of the group with &quot;MSDTC Group.&quot; </li><li>Run the following commands:<div class='indent'><span class='sbody-userinput'>cluster clustername res &quot;MSDTC Resource&quot; /ADDDEP:&quot;<strong class='sbody-strong'>Network Name</strong>&quot;<br><br>cluster clustername res &quot;MSDTC Resource&quot; /ADDDEP:&quot;<strong class='sbody-strong'>Disk Q</strong>:&quot;<br></span></div> where <strong class='sbody-strong'>Network Name</strong> is the proper Network Name resource that you are using, and <strong class='sbody-strong'>Disk Q</strong>is the physical disk that is located in the MSDTC Group.<br><br> These commands add the proper dependencies. </li><li>Run the following command to bring MS DTC online:<div class='indent'><span class='sbody-userinput'>cluster clustername res &quot;MSDTC Resource&quot; /ON<br></span></div> This will bring MSDTC online. </li></ol><span class='text-base'>Note</span> You cannot install MS DTC in a mixed-mode Cluster. All nodes in the Cluster must run Windows Server 2003 to use these methods. See &quot;Help and Support&quot; for more information. </div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Recovery from failures</h3> In several cases, the configuration of the MS DTC cluster resource results in a condition where the resource fails to come online on one or more nodes in the cluster. There can be many causes for this and it is impossible to identify a silver bullet that will resolve every issue. Additionally, there is a very real possibility that bugs still exist in our cluster configuration code. <br><br>It would be a great benefit to be able to identify and fix these bugs.<br><br>This leads to the following suggestions: <br> <ul class='sbody-free_list'><li>Contact the MSDTCPD alias for help in the diagnosis of failures in the configuration of the MS DTC cluster resource. Use the ComPlus Product Studio database as an additional source for information on bug status.</li><li>The MSDTC dev team is in the process of putting together a SharePoint for the MSDTC issues, including cluster issues. After the root cause of the failure is identified, the MS DTC cluster resource still needs to be configured. Unfortunately, the failures can leave the installation in a state that makes it a little more complicated to recover. The development teams&#39; current suggestion to get things back is to do the following: <br><ul class='sbody-free_list'><li>Run the <span class='text-base'>msdtc -uninstall</span> command on all the nodes in the cluster.</li><li>Delete the <strong class='sbody-strong'>HKEY_LOCAL_MACHINE\Software\Microsoft\MSDTC</strong> registry key on all the nodes in the cluster.</li><li>Delete the <strong class='sbody-strong'>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\MSDTC</strong> registry key on all the nodes in the cluster.</li><li>Verify that there is no entry for the MSDTC resource under the following registry key: <div class='indent'><strong class='sbody-strong'>HKEY_LOCAL_MACHINE\Cluster\Resources</strong></div></li><li>Run the <span class='text-base'>msdtc -install</span> command on all the nodes in the cluster. This creates an MSDTC resource in the Cluster Group (assuming that the cluster service is running). If you want the nodes in a different group, you will have to delete it and recreate it by using Cluster Administrator.</li></ul></li></ul></div><div class='kb-references-section section'><span> For more information about how to create a base virtual server that includes information about how to create a Network Name and IP Address resource, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-2' href='/en-us/help/257932'>257932 </a> Using Microsoft Cluster Server to create a virtual server<br><br></div></span></div><div class='kb-securedata-section section'>mscs dtc event id 4148</div><div class='kb-securedata-section section'>Author: stevemat (2001-06-14T08:31:00)<br>Tech Reviewer: JEFFWADE (2001-06-20T07:36:00)<br>Edit Reviewer: V-DIANAG (2001-06-26T10:15:00) </div>