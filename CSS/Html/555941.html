<header><h1>You cannot create quotas on File Server Resource Manager (FSRM) in Windows Server 2003 R2</h1></header><div class='kb-notice-section section'>Shijaz Abdulla MVP</div><div class='kb-notice-section section'><div class='kb-disclaimer-msi'>MICROSOFT CORPORATION AND/OR ITS RESPECTIVE SUPPLIERS MAKE NO REPRESENTATIONS ABOUT THE SUITABILITY, RELIABILITY, OR ACCURACY OF THE INFORMATION AND RELATED GRAPHICS CONTAINED HEREIN. ALL SUCH INFORMATION AND RELATED GRAPHICS ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND. MICROSOFT AND/OR ITS RESPECTIVE SUPPLIERS HEREBY DISCLAIM ALL WARRANTIES AND CONDITIONS WITH REGARD TO THIS INFORMATION AND RELATED GRAPHICS, INCLUDING ALL IMPLIED WARRANTIES AND CONDITIONS OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, WORKMANLIKE EFFORT, TITLE AND NON-INFRINGEMENT.  YOU SPECIFICALLY AGREE THAT IN NO EVENT SHALL MICROSOFT AND/OR ITS SUPPLIERS BE LIABLE FOR ANY DIRECT, INDIRECT, PUNITIVE, INCIDENTAL, SPECIAL, CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF USE, DATA OR PROFITS, ARISING OUT OF OR IN ANY WAY CONNECTED WITH THE USE OF OR INABILITY TO USE THE INFORMATION AND RELATED GRAPHICS CONTAINED HEREIN, WHETHER BASED ON CONTRACT, TORT, NEGLIGENCE, STRICT LIABILITY OR OTHERWISE, EVEN IF MICROSOFT OR ANY OF ITS SUPPLIERS HAS BEEN ADVISED OF THE POSSIBILITY OF DAMAGES.</div></div><div class='kb-summary-section section'><div class='indent'><span class='sbody-italic'>This article gives information on how to resolve problems with Windows Server 2003 R2 File Server Resource Manager.</span></div></div><div class='kb-symptoms-section section'><ul class='sbody-free_list'><li>You have uninstalled File Server Resource Manager without removing the quotas and quota templates you have already created. You have then re-installed File Server Resource Manager on the same computer.<br></li><li>When you open the File Server Resource Manager console, you see there are no quotas defined, but when you try to create a new quota and apply it on a folder, you get the following error:<br></li></ul>&#160;<br><strong class='sbody-strong'>&#160;&#160;&#160;&#160; Can&#39;t create quota in the given path as a quota already exists for that path.</strong><br><strong class='sbody-strong'>&#160;&#160;&#160;&#160; An unexpected error has occurred. Please check application event log for more information</strong><br><strong class='sbody-strong'></strong>&#160;<br><ul class='sbody-free_list'><li>The following events are logged in the Application Event Log</li></ul>&#160;<br><strong class='sbody-strong'>&#160;&#160;&#160; EventID: 0</strong><br><strong class='sbody-strong'>&#160;&#160;&#160; Type: Error</strong><br><strong class='sbody-strong'>&#160;&#160;&#160; Source: FSRM</strong><br><strong class='sbody-strong'>&#160;&#160;&#160; User: N/A</strong><br><strong class='sbody-strong'>&#160;&#160;&#160; Description:</strong><br><strong class='sbody-strong'>&#160;&#160;&#160; </strong><strong class='sbody-strong'>An unexpected error occurred in the File Server Resource Manager MMC snap-in<br>&#160;&#160;&#160; at Microsoft.Storage.SrmMmc.QuotaDataCache.Enumerate( RemoteManager remoteManager, SrmDataCacheEnumEventHandler EventHandler, Int32 BatchSize)<br>&#160;&#160;&#160; at Microsoft.Storage.SrmMmc.QuotasDisplayArea.EnumerateItemsIntoListView()<br>&#160;&#160;&#160; Exception from HRESULT: 0x80045316<br>&#160;&#160;&#160; at Microsoft.Storage.ISrmQuotaManager.EnumQuotas(String strPath)<br>&#160;&#160;&#160; at Microsoft.Storage.SrmMmc.QuotaDataCache.Enumerate(RemoteManager remoteManager, SrmDataCacheEnumEventHandler EventHandler, Int32 BatchSize)<br>&#160;</strong><br>&#160;&#160;&#160; <strong class='sbody-strong'>Event ID: 8197 </strong><br><strong class='sbody-strong'>&#160;&#160;&#160; Source: SRMSVC </strong><br><strong class='sbody-strong'>&#160;&#160;&#160; Type: Error </strong><br><strong class='sbody-strong'>&#160;&#160;&#160; User: N/A</strong><br><strong class='sbody-strong'>&#160;&#160;&#160; Description: not available</strong><br></div><div class='kb-cause-section section'>When you define quotas, File Server Resource Manager (FSRM)&#160;stores information about these quotas in the <strong class='sbody-strong'>quota.xml</strong>,&#160; <strong class='sbody-strong'>quota.md</strong>, and <strong class='sbody-strong'>databasefilescreen</strong> files in the <strong class='sbody-strong'>\System Volume Information\SRM</strong> folder on the drive that the quotas were imposed initially. During a&#160;clean&#160;uninstallation of the FSRM, these files are removed. However, if the uninstallation was not&#160;completed successfully&#160;and you re-installed FSRM on the same computer, these files still remain and are not over-written by a subsequent re-installation of FSRM.</div><div class='kb-resolution-section section'>The resolution involves recreating the <strong class='sbody-strong'>quota.xml</strong>,&#160; <strong class='sbody-strong'>quota.md</strong>, and <strong class='sbody-strong'>databasefilescreen</strong> files in the <strong class='sbody-strong'>\System Volume Information\SRM</strong> folder on the drive that the quotas were imposed initially.<br><strong class='sbody-strong'></strong>&#160;<br><strong class='sbody-strong'>WARNING:</strong>&#160;You will lose all your quota definitions and quota template&#160;configuration when you follow this procedure. Perform these steps only if you wish to start configuring File Server Resource Manager from scratch.<br>&#160;<br>The <strong class='sbody-strong'>System Volume Information</strong> folder can be found on the root folder of any Windows volume. This is folder is critical for the functioning of the operating system, hence it is accessible only by the <strong class='sbody-strong'>SYSTEM</strong> account. It is a hidden system folder, which can be made visible if you configure the <strong class='sbody-strong'>Folder Options </strong>in <strong class='sbody-strong'>Windows Explorer </strong>to <strong class='sbody-strong'>Show hidden and system files</strong>.<br>&#160;<br>Since only the <strong class='sbody-strong'>SYSTEM </strong>account can access this folder, we will use a workaround to get to this folder. We will use the <strong class='sbody-strong'>AT</strong> command to schedule a job to open the <strong class='sbody-strong'>Command Prompt (cmd.exe)</strong>. The AT command starts cmd.exe in the <strong class='sbody-strong'>SYSTEM </strong>account context and you will be able to access the <strong class='sbody-strong'>\System Volume Information\</strong> folder.<br>&#160;<br><ol class='sbody-num_list'><li>Open <strong class='sbody-strong'>Command Prompt</strong>.<br>&#160;<br></li><li>Type the command:<br><strong class='sbody-strong'>AT [time in hh:mm] /interactive cmd.exe<br><br></strong>where <strong class='sbody-strong'>[time in hh:mm] </strong>is the next minute with respect to your system clock. For example, if the time now is 20:09, then the command should be<br><strong class='sbody-strong'>AT 20:10 /interactive cmd.exe<br>&#160;</strong><br></li><li>Wait for the next minute. In the above example, wait till 20:10. The Command Prompt window will appear. This window is running under the <strong class='sbody-strong'>SYSTEM</strong> user context.<br>&#160;<br></li><li>Type each of the following commands in the Command Prompt window:<br><strong class='sbody-strong'>CD \System Volume Information\SRM<br>ATTRIB quota.xml -s -h<br>ATTRIB quota.md -s -h<br>ATTRIB databasefilescreen -s -h<br>DEL quota.xml<br>DEL quota.md<br>DEL databasefilescreen<br>exit<br>&#160;</strong><br></li><li>Re-install <strong class='sbody-strong'>File Server Resource Manager</strong>. The above files will be recreated. The&#160;previous&#160;quota settings will be lost and you can recreate your quotas.<br></li></ol></div>