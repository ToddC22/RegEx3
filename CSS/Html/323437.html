<header><h1>How To Configure Network Load Balancing Parameters in Windows Server 2003</h1></header><div><span></span></div><div class='kb-securedata-section section'>DO NOT DELETE OR ARCHIVE THIS ARTICLE<br>This article is referenced by TechNet.<br>Contact the Content Business Manager for this product if you have any questions.</div><div class='kb-securedata-section section'><a managed-link="" href='#7' target="" bookmark-id='7'>REFERENCES</a></div><div class='kb-notice-section section'><span>For a Microsoft Windows 2000 version of this article, see<br> <a id='kb-link-1' href='/EN-US/help/303608'>303608 </a>. <br></span><a class='bookmark' id='toc'></a><h3 class='sbody-h3'>IN THIS TASK</h3><ul class='sbody-free_list'><li><a managed-link="" href='#1' target="" bookmark-id='1'>SUMMARY</a><ul class='sbody-free_list'><li><a managed-link="" href='#2' target="" bookmark-id='2'>Configure Network Load Balancing Parameters</a><ul class='sbody-free_list'><li><a managed-link="" href='#3' target="" bookmark-id='3'>Configure Cluster Parameters</a></li><li><a managed-link="" href='#4' target="" bookmark-id='4'>Configure Host Parameters</a></li><li><a managed-link="" href='#5' target="" bookmark-id='5'>Configure Port Rules</a></li></ul></li><li><a managed-link="" href='#8' target="" bookmark-id='8'>Enable Multicast Support</a></li><li><a managed-link="" href='#9' target="" bookmark-id='9'>Enable Internet Group Management Protocol (IGMP) Support</a></li><li><a managed-link="" href='#10' target="" bookmark-id='10'>Manage Existing Clusters from Network Load Balancing Manager by Using a Host List</a></li><li><a managed-link="" href='#6' target="" bookmark-id='6'>Troubleshooting</a></li></ul></li></ul><a class='bookmark' id='1'></a></div><div> This step-by-step article describes how to configure Network Load Balancing parameters in Windows Server 2003.<br><br> You can use Network Load Balancing to spread incoming requests across as many as 32 servers. You can do so to expand enterprise-wide services, such as Web servers, Terminal Services, and streaming-media servers. Network Load Balancing also makes sure that your servers respond quickly, even under heavy loads. It does this by automatically detecting when a server stops working, and then quickly reassigning client traffic among the remaining servers. This safeguard can help you provide uninterrupted, continuous service for your critical business programs.<br><br><h3 class='sbody-h3'><a class='bookmark' id='2'></a>Configure Network Load Balancing Parameters</h3> To configure Network Load Balancing parameters, you must configure the cluster parameters, host parameters, and port rules.<br><br><span>For additional information about how to set up TCP/IP for Network Load Balancing, click the article number below to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-2' href='/EN-US/help/323431'>323431 </a> How To Set Up TCP/IP for Network Load Balancing in Windows Server 2003<br></div></span><h4 class='sbody-h4'><a class='bookmark' id='3'></a>Configure Cluster Parameters</h4><ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, click <span class='text-base'>Control Panel</span>, and then double-click <span class='text-base'>Network Connections</span>.</li><li>Right-click <span class='text-base'>Local Area Connection</span>, and then click <span class='text-base'>Properties</span>. </li><li>In the <strong class='uiterm'>Local Area Connection Properties</strong>dialog box, click to select the <span class='text-base'>Network Load Balancing</span> check box, and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Cluster Parameters</span> tab, and then type values in the <strong class='uiterm'>IP address</strong>,<br><strong class='uiterm'>Subnet mask</strong>, and <strong class='uiterm'>Full Internet name</strong> check boxes.</li><li>Under <strong class='uiterm'>Cluster operation mode</strong>, click <span class='text-base'>Multicast</span> to specify whether a multicast media access control address is used for cluster operations. If you select this option, Network Load Balancing converts the cluster network address into a multicast address when this is needed. It also makes sure that the cluster Internet Protocol (IP) addresses resolve to this multicast address as part of the Address Resolution Protocol (ARP). The network adapter to which the Network Load Balancing driver is bound retains its original media access control address. For more information, see the &quot;Network Load Balancing clusters&quot; Windows Server 2003 Help and Support Center topic.</li><li>Click to select the <strong class='uiterm'>Allow remote control</strong>check box to turn on remote-control operations. Type the password in the<br><strong class='uiterm'>Remote password</strong> and <strong class='uiterm'>Confirm password</strong>boxes.</li></ol><span class='text-base'>WARNING</span>: The Network Load Balancing remote control option presents many security risks. Microsoft recommends that you do not turn on remote control and instead use Network Load Balancing Manager or other remote management tools such as Windows Management Instrumentation (WMI).<br><br> For additional information about the use of Remote Control in Network Load Balancing, see the &quot;Network Load Balancing parameters: Network Load Balancing Clusters&quot; Windows Server 2003 Help and Support Center topic.<br><br><h4 class='sbody-h4'><a class='bookmark' id='4'></a>Configure Host Parameters</h4><ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, click <span class='text-base'>Control Panel</span>, and then double-click <span class='text-base'>Network Connections</span>.</li><li>Right-click <span class='text-base'>Local Area Connection</span>, and then click <span class='text-base'>Properties</span>.</li><li>In the <strong class='uiterm'>Local Area Connection Properties</strong>dialog box, click <span class='text-base'>Network Load Balancing</span>, and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Host Parameters</span> tab.</li><li>Type a value in the <strong class='uiterm'>Priority (Unique host identifier)</strong> box.</li><li>Under <strong class='uiterm'>Dedicated IP configuration</strong>, type values in the <strong class='uiterm'>IP address</strong> and <strong class='uiterm'>Subnet mask</strong>boxes.</li><li>Under <strong class='uiterm'>Initial host state</strong>, specify the host state with regard to the Network Load Balancing cluster when Windows is started.</li></ol><span class='text-base'>IMPORTANT</span>: You may have a problem if you are working from a computer that has a single network adaptor that is bound to Network Load Balancing in Unicast mode. You cannot use Network Load Balancing Manager on this computer to configure and manage other hosts because a single network adapter in Unicast mode cannot have intra-host communication. However, you can communicate with computers that are outside the cluster.<br><br> To make sure that Network Load Balancing Manager is displaying the most recent host information, right-click the cluster, and then click <span class='text-base'>Refresh</span>. You must do so because the host properties that Network Load Balancing Manager displays are a copy of the host properties that were configured the last time Network Load Balancing Manager connected to that host. When you click <span class='text-base'>Refresh</span>, Network Load Balancing Manager reconnects to the cluster and displays updated information. <br><br><span class='text-base'>NOTE</span>: You can also open the <span class='text-base'>Network Load Balancing Properties</span> dialog box through the Network Connections tool. However, Network Load Balancing Manager is the preferred method. If you use the Network Connections tool, you must make the same configuration changes on every cluster host. Using both Network Load Balancing Manager and the Network Connections tool together to change Network Load Balancing properties may create unpredictable results. <br><br> The parameters that are set in the <span class='text-base'>Network Load Balancing Properties</span> dialog box are recorded in the registry on each host. Changes to Network Load Balancing parameters are applied when you click <span class='text-base'>OK</span> in the <span class='text-base'>Network Load Balancing Properties</span> dialog box. Clicking <span class='text-base'>OK</span> stops Network Load Balancing (if it is running), reloads the parameters, and then restarts cluster operations.<br><br><h4 class='sbody-h4'><a class='bookmark' id='5'></a>Configure Port Rules</h4> Before you continue, review the &quot;Port Rules&quot; section of the &quot;Checklist: Enabling and configuring Network Load Balancing&quot; Windows Server 2003 Help and Support Center topic. Without a complete understanding of the topics that are addressed in this section, you cannot properly configure port rules. <br><br> Configuring port rules includes the creation, editing, and removal of port rules.<br><br> To create port rules: <br> <ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, click <span class='text-base'>Control Panel</span>, and then double-click <span class='text-base'>Network Connections</span>.</li><li>Right-click <span class='text-base'>Local Area Connection</span>, and then click <span class='text-base'>Properties</span>. </li><li>In the <span class='text-base'>Local Connection Properties</span> dialog box, click <span class='text-base'>Network Load Balancing</span>, and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Port Rules</span> tab, and then click <span class='text-base'>ADD</span>.</li><li>Type values for the <strong class='uiterm'>Port range</strong>, <span class='text-base'>Protocols</span>, <strong class='uiterm'>Filtering mode</strong>, <span class='text-base'>Affinity</span>, <strong class='uiterm'>Load weight</strong>, and <strong class='uiterm'>Handling priority</strong> boxes by using information from the installation check list.</li><li>Click <span class='text-base'>OK</span>. </li></ol> To edit port rules: <br> <ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, click <span class='text-base'>Control Panel</span>, and then double-click <span class='text-base'>Network Connections</span>.</li><li>Right-click <span class='text-base'>Local Area Connection</span>, and then click <span class='text-base'>Properties</span>. </li><li>In the <span class='text-base'>Local Connection Properties</span> dialog box, click <span class='text-base'>Network Load Balancing</span>, and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Port Rules</span> tab.</li><li>In the list of rules, double-click the rule to display the rule&#39;s parameters in the <span class='text-base'>Configuration</span> area above the list of rules. </li><li>Modify the <strong class='uiterm'>Port range</strong>, <span class='text-base'>Protocols</span>, and <strong class='uiterm'>Filtering mode</strong> parameters as necessary.</li><li>Click <span class='text-base'>OK</span>.</li></ol> To remove port rules: <br> <ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, click <span class='text-base'>Control Panel</span>, and then double-click <span class='text-base'>Network Connections</span>.</li><li>Right-click <span class='text-base'>Local Area Connection</span>, and then click <span class='text-base'>Properties</span>.</li><li>In the <strong class='uiterm'>Local Area Connection Properties</strong>dialog box, click <span class='text-base'>Network Load Balancing</span>, and then click <span class='text-base'>Properties</span>. </li><li>Click the <span class='text-base'>Port Rules</span> tab, click the rule that you want to remove, and then click <span class='text-base'>Remove</span>.</li></ol><span class='text-base'>IMPORTANT</span>: The number and type of rules must be exactly the same for each host in the cluster. You can make sure of this by using Network Load Balancing Manager to configure port rules (see the second note below). If you are using Network Load Balancing Manager, when you add additional hosts, they automatically inherit the cluster port rules from the initial host. <br><br>  If a host tries to join the cluster with a different number of rules, or with different rules from the other hosts, it is not accepted as part of the cluster. The rest of the cluster then continues to handle the traffic as before. At the same time, a message is entered into the Windows event log. When this occurs, see the Event log to determine which host is in conflict with the other cluster hosts, resolve the conflict, and then restart Network Load Balancing on that host. <br><br> To allow Network Load Balancing to properly handle IP fragments, avoid using <span class='text-base'>None</span> when you select UDP or Both for your protocol setting. <br><br><span class='text-base'>NOTE</span>: When you are using Network Load Balancing Manager, you must be a member of the Administrators group on the host that you are configuring, or you must have been delegated the appropriate authority. As a security best practice, consider using &quot;Run as&quot; to perform this procedure. If you are configuring a cluster or host by running Network Load Balancing Manager from a computer that is not part of the cluster, you do not have to be a member of the Administrators group on that computer. <br><br> You can also open the <span class='text-base'>Network Load Balancing Properties</span> dialog box through the Network Connections tool. However, Network Load Balancing Manager is the preferred method. If you use the Network Connections tool, you must make the same configuration changes on every cluster host. Using both Network Load Balancing Manager and the Network Connections tool together to change Network Load Balancing properties may lead to unpredictable results. <br><br> If all your hosts are running a product in Windows Server 2003, you can specify port rules to apply to only specific IP addresses. This is useful when you create virtual clusters. If you are not running Windows Server 2003, you must apply the port rules to all IP addresses. For more information about virtual clusters, see &quot;Understanding Virtual Clusters&quot;.<br><br> The list of all currently installed port rules is sorted by port range.<br><br> The parameters that are set in the <span class='text-base'>Network Load Balancing Properties</span> dialog box are recorded in the registry on each host. <br><br>  Changes to Network Load Balancing parameters are applied when you click <span class='text-base'>OK</span> in the <span class='text-base'>Network Load Balancing Properties</span> dialog box. Clicking <span class='text-base'>OK</span> stops Network Load Balancing (if it is running), reloads the parameters, and then restarts cluster operations. <br><br> If you are working from a computer that has a single network adaptor that is bound to Network Load Balancing in Unicast mode, you cannot use Network Load Balancing Manager on this computer to configure and manage other hosts because a single network adapter in Unicast mode cannot have intra-host communication. However, you can communicate with computers that are outside the cluster. <br><br> To make sure that Network Load Balancing Manager is displaying the most recent host information, right-click the cluster, and then click <span class='text-base'>Refresh</span>. You must do so because the host properties that Network Load Balancing Manager displays are a copy of the host properties that were configured the last time Network Load Balancing Manager connected to that host. When you click <span class='text-base'>Refresh</span>, Network Load Balancing Manager reconnects to the cluster and displays updated information.<br><br><h3 class='sbody-h3'><a class='bookmark' id='8'></a>Enable Multicast Support</h3><ol class='sbody-num_list'><li>To start Network Load Balancing Manager, type<br><span class='sbody-userinput'>nlbmgr</span> at a command prompt, and then press ENTER.</li><li>If Network Load Balancing Manager does not already list the cluster, connect to the cluster.</li><li>Right-click the cluster, and then click <span class='text-base'>Cluster Properties</span>.</li><li>On the <span class='text-base'>Cluster Parameters</span> tab, in <strong class='uiterm'>Cluster operation mode</strong>, click <span class='text-base'>Multicast</span>. If appropriate, you can also enable Internet Group Management Protocol (IGMP) support by clicking to select the <strong class='uiterm'>IGMP multicast</strong> check box.</li></ol><span class='text-base'>IMPORTANT</span>: If you are working from a computer that has a single network adaptor that is bound to Network Load Balancing in Unicast mode, you cannot use Network Load Balancing Manager on this computer to configure and manage other hosts because a single network adapter in Unicast mode cannot have intra-host communication. However, you can communicate with computers that are outside the cluster. <br><br><span class='text-base'>NOTE</span>: When you are using Network Load Balancing Manager, you must be a member of the Administrators group on the host that you are configuring, or you must have been delegated the appropriate authority. As a security best practice, consider using &quot;Run as&quot; to perform this procedure. If you are configuring a cluster or host by running Network Load Balancing Manager from a computer that is not part of the cluster, you do not have to be a member of the Administrators group on that computer. <br><br> You can also open the <span class='text-base'>Network Load Balancing Properties</span> dialog box through the Network Connections tool. However, Network Load Balancing Manager is the preferred method. If you use the Network Connections tool, you must make the same configuration changes on every cluster host. Using both Network Load Balancing Manager and the Network Connections tool together to change Network Load Balancing properties may lead to unpredictable results. <br><br> You can only enable IGMP support when your cluster is configured for multicast mode. If you enable IGMP support, the permitted multicast IP address is restricted to the standard class D range. This is 224.0.0.0 to 239.255.255.255.<br><br><h3 class='sbody-h3'><a class='bookmark' id='9'></a>Enable Internet Group Management Protocol (IGMP) Support</h3><ol class='sbody-num_list'><li>To start Network Load Balancing Manager, type<br><span class='sbody-userinput'>nlbmgr</span> at a command prompt, and then press ENTER.</li><li>If Network Load Balancing Manager does not already list the cluster, connect to the cluster.</li><li>Right-click the cluster, and then click <span class='text-base'>Cluster Properties</span>.</li><li>On the <span class='text-base'>Cluster Parameters</span> tab, click to select the <strong class='uiterm'>IGMP multicast</strong> check box to enable IGMP support on all the hosts in the cluster.</li></ol><span class='text-base'>IMPORTANT</span>: If you are working from a computer that has a single network adaptor that is bound to Network Load Balancing in Unicast mode, you cannot use Network Load Balancing Manager on this computer to configure and manage other hosts because a single network adapter in Unicast mode cannot have intra-host communication. However, you can communicate with computers that are outside the cluster. <br><br><span class='text-base'>NOTE</span>: When you are using Network Load Balancing Manager, you must be a member of the Administrators group on the host that you are configuring, or you must have been delegated the appropriate authority. As a security best practice, consider using &quot;Run as&quot; to perform this procedure. If you are configuring a cluster or host by running Network Load Balancing Manager from a computer that is not part of the cluster, you do not have to be a member of the Administrators group on that computer. <br><br> You can also open the <span class='text-base'>Network Load Balancing Properties</span> dialog box through the Network Connections tool. However, Network Load Balancing Manager is the preferred method. If you use the Network Connections tool, you must make the same configuration changes on every cluster host. Using both Network Load Balancing Manager and the Network Connections tool together to change Network Load Balancing properties may lead to unpredictable results. <br><br> You can only enable IGMP support when your cluster is configured for multicast mode. If you enable IGMP support, the permitted multicast IP address is restricted to the standard class D range. This is 224.0.0.0 to 239.255.255.255.<br><br><h3 class='sbody-h3'><a class='bookmark' id='10'></a>Manage Existing Clusters from Network Load Balancing Manager by Using a Host List</h3><ul class='sbody-free_list'><li>From the Windows interface:<br><ol class='sbody-num_list'><li>To start Network Load Balancing Manager, type<br> <span class='sbody-userinput'>nlbmgr</span> at a command prompt, and then press ENTER.</li><li>On the <span class='text-base'>File</span> menu, click <span class='text-base'>Load Host List</span>.</li><li>Locate your host list text file, click it, and then click <span class='text-base'>Open</span>.<br><br><span class='text-base'>IMPORTANT</span>: If you are working from a computer that has a single network adaptor that is bound to Network Load Balancing in Unicast mode, you cannot use Network Load Balancing Manager on this computer to configure and manage other hosts because a single network adapter in Unicast mode cannot have intra-host communication. However, you can communicate with computers that are outside the cluster. <br><br> For security reasons, make sure that only users in the local Administrators group have access to the host list file. <br><br><span class='text-base'>NOTE</span>: When you are using Network Load Balancing Manager, you must be a member of the Administrators group on the host that you are configuring, or you must have been delegated the appropriate authority. As a security best practice, consider using &quot;Run as&quot; to perform this procedure. If you are configuring a cluster or host by running Network Load Balancing Manager from a computer that is not part of the cluster, you do not have to be a member of the Administrators group on that computer.<br><br> The host list text file is a text file that you create by using Notepad or any other similar tool. The file must list the name of each host. Each host name must be separated by a line break. You can include comments in the host list by preceding the comment with a semicolon (;). <br><br> You can use this procedure to connect to multiple hosts and all Network Load Balancing clusters on those hosts. The clusters and hosts are then displayed in Network Load Balancing Manager. This is particularly useful when a host&#39;s Network Load Balancing network adapter is having connectivity problems, but another network adapter is available on that host. You can also use this procedure to detect and diagnose problems such as cluster hosts that are converging separately.</li></ol></li><li>At a command prompt:<br><ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, point to <span class='text-base'>All Programs</span>, point to <span class='text-base'>Accessories</span>, and then click <span class='text-base'>Command Prompt</span>.</li><li>At the command prompt, type <span class='sbody-userinput'>nlbmgr /hostlist<br> <strong class='sbody-strong'>host-list</strong></span>, and then press ENTER, where<br> <strong class='sbody-strong'>host-list</strong> is the fully qualified path to a text file that you create using Notepad or any other similar tool. The file must list the name of each host. Each host name must be separated by a line break.</li></ol></li></ul><span class='text-base'>IMPORTANT</span>: For security reasons, make sure that only users in the local Administrators group have access to the host list file. <br><br><span class='text-base'>NOTE</span>: To run Nlb.exe from a remote computer, you must enable remote control on the host that is running Network Load Balancing. The Network Load Balancing remote control option presents many security risks. Only use remote control on a secure computer inside your firewall. Because of the many security risks remote control presents, Microsoft recommends that you do not enable the remote control feature. Instead, use other remote management tools such as Network Load Balancing Manager or Windows Management Instrumentation (WMI).<br> <br><br> When you are using Nlb.exe, you must be a member of the Administrators group on the host that you are configuring, or you must have been delegated the appropriate authority. As a security best practice, consider using &quot;Run as&quot; to perform this procedure. If you are configuring a cluster or host by running Nlb.exe from a computer that is not part of the cluster, you do not have to be a member of the Administrators group on that computer.<br><br>  To view the complete syntax for this command, type <span class='sbody-userinput'>nlbmgr /help</span> at a command prompt, and then press ENTER.<br><br> Make sure that only users in the local Administrators group have access to the host list file. <br><br> You can include comments in the host list by preceding the comment with a semicolon (;). <br><br> You can use this procedure to connect to multiple hosts and all Network Load Balancing clusters on those hosts. The clusters and hosts are then displayed in Network Load Balancing Manager. This is particularly useful when a host&#39;s Network Load Balancing network adapter is having connectivity problems, but another network adapter is available on that host. You can also use this procedure to detect and diagnose problems such as cluster hosts that are converging separately.<br> <br><br><h3 class='sbody-h3'><a class='bookmark' id='6'></a>Troubleshooting</h3> The number and type of rules must be exactly the same for each host in the cluster. If a host tries to join the cluster with a different number of rules from the other hosts, it is not accepted as part of the cluster, and the rest of the cluster continues to handle the traffic as before. At the same time, a message is logged in the Windows Event log. If this occurs, view the Event log to determine which host is in conflict with the other cluster hosts, resolve the conflict, and then restart Network Load Balancing on that host.<br><br> You must also add the cluster IP address or addresses to the TCP/IP settings of the local area connection: <br> <ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, click <span class='text-base'>Control Panel</span>, and then double-click <span class='text-base'>Network Connections</span>.</li><li>Right-click <span class='text-base'>Local Area Connection</span>, and then click <span class='text-base'>Properties</span>.</li><li>In the <strong class='uiterm'>Local Area Connection Properties</strong>dialog box, click <span class='text-base'>Internet Protocol</span>, and then click <span class='text-base'>Properties</span>.</li><li>Click <span class='text-base'>Advanced</span>.</li><li>Click <span class='text-base'>ADD</span>.</li><li>Add the cluster IP and subnet mask addresses.</li><li>Confirm your changes.</li></ol></div><div class='kb-securedata-section section'><h3 class='sbody-h3'><a class='bookmark' id='7'></a>REFERENCES</h3><span class='text-base'>ClonePlaceholder</span><br><br> The following links are placeholders only and should be replaced with the appropriate link to the Windows Server 2003 clones after the clones are created.<br><br><span>For additional information about how to configure load-balancing settings, click the article number below to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-8' href='/EN-US/help/198496'>198496 </a> How to Configure WLBS Port Rules<br></div></span><span>For additional information about load-balancing settings for specific configurations, click the article numbers below to view the articles in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-9' href='/EN-US/help/219285'>219285 </a> Load Balancing FTP with WLBS<br></div></span><span><div class='indent'><a id='kb-link-10' href='/EN-US/help/232141'>232141 </a> Load Balancing Telnet with WLBS<br></div></span><span><div class='indent'><a id='kb-link-11' href='/EN-US/help/219277'>219277 </a> Load Balancing HTTP with WLBS<br></div></span><span><div class='indent'><a id='kb-link-12' href='/EN-US/help/203597'>203597 </a> Load Balancing PPTP with WLBS<br></div></span></div><div class='kb-securedata-section section'>kbclustering</div><div class='kb-textlegacy-section section'>Author: pattim (2002-05-22T05:26:00) Edit Reviewer: A-CGOLD (2002-10-01T22:19:00) Tech Reviewer: JAMIRC (2002-09-25T07:32:00)<br> </div>