<header><h1>Keepass crashes and fails to synchronize with UE-V</h1></header><div class='kb-symptom-section section'><p>Keepass.exe fails to synchronize settings with Microsoft User Experience Virtualization 1.0 (UE-V 1.0) enabled and crashes on launch.&nbsp; An error similar to the following will be reported in the Application log:</p><dl><dt><font size="2" face="Tahoma"><em>Log Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Application<br>Source:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Application Error<br>Event ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1000<br>Task Category: Application Crashing Events<br>Level:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Error<br>Keywords:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Classic<br>Description:<br>Faulting application name: KeePass.exe, version: 2.20.1.0, time stamp: 0x506d455e<br>Faulting module name: KERNELBASE.dll, version: 6.1.7601.18015, time stamp: 0x50b8479b<br>Exception code: 0xe0434352<br>Fault offset: 0x0000000000009e5d<br>Faulting process id: 0x544<br>Faulting application start time: 0x01cdef9d0028ee0a<br>Faulting application path: C:\Program Files (x86)\KeePass2x\KeePass.exe<br>Faulting module path: C:\WINDOWS\system32\KERNELBASE.dll<br>Report Id: 3dff0aaa-5b90-11e2-bb4e-005056c00008<br>Faulting package full name: %14<br>Faulting package-relative application ID: %15</em></font></dt></dl><font size="2" face="Tahoma"><p>A UEV debug (ETL) trace will show a pattern similar to the following:</p><dl><dt><font size="2" face="Tahoma"><em>03:43:05.689 01-10-2013&nbsp;11&nbsp;1348&nbsp;10232&nbsp;16&nbsp;2013-Jan-10 20:43:05.689 - Orchestrator: [10232]: INFO: An updated settings data package was not found to import for settings location template KeePass.<br>&nbsp;<br>...<br>&nbsp;<br>03:43:05.689 01-10-2013&nbsp;2&nbsp;1348&nbsp;5540&nbsp;16&nbsp;2013-Jan-10 20:43:05.690 - AppAgent: [5540]: SCOPE: &lt;-- SyncSettingsFromCentralStoreToLocalStore() [Settings successfully imported]<br>&nbsp;<br>03:43:05.689 01-10-2013&nbsp;2&nbsp;1348&nbsp;5540&nbsp;16&nbsp;2013-Jan-10 20:43:05.690 - AppAgent: [5540]: INFO: Calling monitored application's main entry point.<br>&nbsp;<br>03:43:05.767 01-10-2013&nbsp;102&nbsp;4636&nbsp;10872&nbsp;0&nbsp;The Agent Driver trapped the start of process WerFault.exe (ID 9752).</em></font></dt></dl></font> </div><div class='kb-cause-section section'>This crash occurs because UE-V and Keepass.exe both attempt to load different versions of the .Net runtime into the same process space when the UE-V agent DLL is injected in to the Keepass.exe process. </div><div class='kb-resolution-section section'><p>To resolve this issue,&nbsp;complete the following steps:</p><p>1. Open Notepad.exe in an elevated context by right-clicking on a shortcut to Notepad and choosing<strong>Run as administrator...</strong>.</p><p>2. Select <strong>File\New...</strong> and create or edit&nbsp;a file named <strong>keepass.exe.config</strong> in the same folder as Keepass.exe (C:\Program Files (x86)\KeePass Password Safe 2 by default). Make sure to remove the .txt extension.</p><p>3. Copy and paste the following lines in to keepass.exe.config.&nbsp; If the file exists, change the<span><strong>&lt;startup&gt;</strong> tag&nbsp;to <strong>&lt;startup useLegacyV2RuntimeActivationPolicy=&quot;true&quot;&gt;</strong></span>:&nbsp;</p><p><span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;<br>&lt;configuration&gt;<br>&nbsp;&lt;startup useLegacyV2RuntimeActivationPolicy=&quot;true&quot;&gt;<br>&nbsp;&nbsp;&lt;supportedRuntime version=&quot;v4.0&quot; /&gt;<br>&nbsp;&nbsp;&lt;supportedRuntime version=&quot;v2.0.50727&quot; /&gt;<br>&nbsp;&lt;/startup&gt;<br>&nbsp;&lt;runtime&gt;<br>&nbsp;&nbsp;&lt;assemblyBinding xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot;&gt;<br>&nbsp;&nbsp;&nbsp;&lt;dependentAssembly&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;assemblyIdentity name=&quot;KeePass&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;publicKeyToken=&quot;fed2ed7716aecf5c&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;culture=&quot;neutral&quot; /&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;bindingRedirect oldVersion=&quot;2.0.9.0-2.20.0.0&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newVersion=&quot;2.20.0.18622&quot; /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;/dependentAssembly&gt;<br>&nbsp;&nbsp;&lt;/assemblyBinding&gt;<br>&nbsp;&nbsp;&lt;enforceFIPSPolicy enabled=&quot;false&quot; /&gt;<br>&nbsp;&nbsp;&lt;loadFromRemoteSources enabled=&quot;true&quot; /&gt;<br>&nbsp;&lt;/runtime&gt;<br>&lt;/configuration&gt;</span></p><p><span>4. </span>Save the file and exit Notepad.</p><p>5. Re-launch Keepass.exe.</p> </div><div class='kb-msconfidential-section section'><div><div><h5>Keywords:&nbsp; keepass, key pass, keypass</h5><h5>Steps to reproduce.</h5><p><h5>Product Bug Number:</h5><h5>Author ID (email alias):&nbsp; markstan</h5><h5>Writer ID(email alias):&nbsp; markstan</h5><h5>Tech Review ID (email alias):</h5><h5>Confirm Article has been Tech Reviewed: Yes/No</h5><h5>Confirm Article released for Publishing: Yes/No</h5></div></div> </div>