<header><h1>Behavior of the LooksAlive and IsAlive functions for the resources that are included in the Windows Server Clustering component of  Windows Server 2003</h1></header><div class='kb-notice-section section'><div internal-content-body=""><div class="internal-content"><div class="bold internal-content-body-title spacer-12-bottom">Microsoft Internal Support Information</div><div class="row"><div class="col-xs-24 internal-content-body-content"><p>BUG #: <a href='http://bugcheck/bugs/ContentMaintenance/51729.asp' title='Link only available for Microsoft corporate network users' target='_blank'>51729 (Content Maintenance)</a></p></div></div></div></div></div><div class='kb-summary-section section'>This article describes the behavior of the <span class='text-base'>LooksAlive</span> and <span class='text-base'>IsAlive</span> entry-point functions for the resources that are included in the Windows Server Clustering component of Microsoft Windows Server 2003.<br></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Physical Disk resource (ClusRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The Cluster service (ClusDisk.sys) issues a reservation every three seconds against all managed disks  or against all Physical Disk resources. The <span class='text-base'>LooksAlive </span>poll verifies whether the flag on the Physical Disk resource is set. If the flag is not set,  the periodic reservation has failed.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span>test performs a procedure that is equivalent    to a <span class='text-base'>DIR</span> command that is performed against the root of the disk.<br></li></ul></div><div class='kb-moreinformation-section section'><span class='text-base'>Note</span> When the <span class='text-base'>IsAlive</span> function is used in the context of the Physical Disk resource, the <span class='text-base'>FindFirstFile</span> function is  used on the root directory of every Physical Disk resource.<br></div><div class='kb-moreinformation-section section'><span class='text-base'>Note</span> When the Physical Disk resource is created, the Cluster  service creates a temporary file to verify that the disk is not corrupted and that it has appropriate permissions to the root.  This verification process creates  and then deletes a small file on the disk.  The following is an excerpt from the Cluster.log file that shows this process:<br><br><div class='indent'>Physical Disk <strong class='sbody-strong'>Disk X</strong>: DisksWriteTestFile: Creating test file (X:\zClusterOnlineChk.tmp)</div><h3 class='sbody-h3'>IP Address resource (ClusRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>IP Address resource failure detection is based primarily on  Microsoft Cluster  service (MSCS) network interface failure detection. The IP Address resource listens for network interface failure notifications by using the Cluster  service (ClusAPI). When the Cluster  service declares that a network interface has failed,  the IP Address resource sets a failure flag on each IP Address resource that is hosted on the failed interface. For example, this behavior may occur when a loss of heartbeats causes nodes to vote on which interface has failed. The next time that the <span class='text-base'>LooksAlive</span> function is called, the resource fails. <br><br>The <span class='text-base'>LooksAlive</span> function also does the following:<br><br><ul class='sbody-free_list'><li> Queries the TCP/IP driver to make sure that the network table entry for the virtual IP address is still present in the stack. The network table entry corresponds to an IP address.</li><li>Queries the NetBT driver to make sure that the NetBT device is still present if NetBIOS is enabled for the resource.</li></ul><span>For more information about network interface failure detection in server clusters, click the following article number to view the article in the Microsoft Knowledge Base:<br><br><div class='indent'><a id='kb-link-1' href='/en-us/help/892422'>892422 </a> Overview of event ID 1123 and event ID 1122 logging in Windows 2000-based and Windows Server 2003-based server clusters<br><br></div></span></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> test is the same as the <span class='text-base'>LooksAlive</span>  test in this context.<br></li></ul><h3 class='sbody-h3'>Network Name resource (ClusRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>Network Name resource failure detection has a &quot;still present&quot; test that is similar to the IP Address resource test. If NetBIOS is enabled for a Network Name resource, the Network Name resource queries the NetBT device to verify that the virtual name is still loaded on the network stack. <br><br>The Network Name resource also has a worker thread that registers Host (A) resource records  every 24 hours. Optionally, reverse lookup (PTR) resource records can be registered.  The Network Name resource uses the DNS server or servers that are associated with the Network Name resource’s dependent node IP address or addresses. The DNS servers must be configured to accept dynamic updates. <br><br>The status for each registration attempt is verified during  the <span class='text-base'>LooksAlive </span> test. If all the registrations fail and if the virtual name is no longer registered by using NetBIOS, the virtual name is considered to be no longer reachable. Therefore, the resource has failed. Additionally, the Network Name resource  fails if the &quot;DNS is Required&quot; property is set to one and if one or more DNS registrations have failed.<br><br><br><br><span class='text-base'>Note</span> In both of these scenarios, a communications time-out with the DNS server is not considered to be a failure.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> test is the same as the <span class='text-base'>LooksAlive</span>  test in this context.<br></li></ul><h3 class='sbody-h3'>File Share resource (ClusRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The <span class='text-base'>LooksAlive</span> test for a File Share resource retrieves the properties of the share from the Server service as a basic test that the share exists.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive</span> test for a File Share resource does the same thing as a <span class='text-base'>LooksAlive</span> test. If the<span class='text-base'> MaxUsers</span> property is set to -1 (unlimited), the <span class='text-base'>IsAlive </span> function opens the first file on the share by using the share name. Otherwise, the <span class='text-base'>IsAlive </span> function tests that the directory path that is associated with the share is still valid.<br></li></ul></div><div class='kb-moreinformation-section section'><span class='text-base'>Notes</span><ul class='sbody-free_list'><li>When the <span class='text-base'>LooksAlive</span> function is used in the context of the File Share resource, the <span class='text-base'>NetShareGetInfo </span>function is used for standard shares at the 502 level.</li><li>When the <span class='text-base'>IsAlive</span> function is used in the context of the File Share resource, the <span class='text-base'>FindFirstFile</span> function is  used when <span class='text-base'>MaxUsers</span> is -1 (unlimited).  If the value of <span class='text-base'>MaxUsers</span> is anything other than -1 (unlimited), the <span class='text-base'>GetFileAttributes</span> function is used.  This behavior keeps the Cluster  service from using a connection to do its test.  For example, if you limit a file share to allow for only five users and if the <span class='text-base'>FindFirstFile</span> function is used, a connection is used to perform the query.<br><br><br></li></ul></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>File Share resource as stand-alone DFS Root (ClusRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The <span class='text-base'>LooksAlive</span> test for a Distributed File System (DFS) Root File Share resource retrieves the feature flags of the share from the Server service as a basic test that the share exists. The flags are checked to verify that the share is marked as a DFS Root.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive</span> test for a DFS Root File Share resource does the same thing as the <span class='text-base'>LooksAlive</span> test. Additionally, the <span class='text-base'>IsAlive</span> test requests the referrals that are associated with the dependent virtual name. If that test is successful, the DFS Root File Share resource opens the first file on the share.<br></li></ul></div><div class='kb-moreinformation-section section'><span class='text-base'>Notes</span><ul class='sbody-free_list'><li>When the <span class='text-base'>LooksAlive </span> function is used in the context of the File Share resource as a stand-alone DFS Root, the <span class='text-base'>NetShareGetInfo</span> function is used at the 1005 level.</li><li>When the <span class='text-base'>IsAlive </span> function is used in the context of the File Share resource as a stand-alone DFS Root, the DFS Root File Share resource obtains referrals by opening a handle to the &quot;\\<strong class='sbody-strong'>virtual name</strong>\IPC$&quot; DFS driver device object  and by issuing the FSCTL_DFS_GET_REFERRALS API. The <span class='text-base'>FindFirstFile</span> function is used to open the file on the share.</li></ul></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Spooler resource (ClusRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The <span class='text-base'>LooksAlive</span> test for the Spooler resource queries Service Control Manager (SCM) to see whether the SpoolSV.exe process is in a &quot;Running&quot; state.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> function tests the Spooler resource by making a call to the Local Print Provider (Localspl.dll) in the printing subsystem. The call directs the Local Print Provider to grab and to release a critical section of code in memory. This test verifies that the Spooler service  is  functional  and responsive.<br></li></ul></div><div class='kb-moreinformation-section section'><span class='text-base'>Note</span> When the <span class='text-base'>LooksAlive</span> function is used in the context of the Spooler resource, the <span class='text-base'>QueryServiceStatus</span> function is actually used.<br></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Generic Service resource (ClusRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The <span class='text-base'>LooksAlive </span> test for the Generic Service resource queries SCM to see whether the specified service is in a &quot;Running&quot; state.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive</span> test is the same as the <span class='text-base'>LooksAlive </span>test in this context.<br></li></ul></div><div class='kb-moreinformation-section section'><span class='text-base'>Note</span> When the <span class='text-base'>LooksAlive </span> function is used in the context of the Generic Service resource, the <span class='text-base'>QueryServiceStatus</span> function is actually used.<br><br></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Generic Application resource (ClusRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The Generic Application resource differs from most other core resources because the resource does not implement the standard <span class='text-base'>LooksAlive</span> and <span class='text-base'>IsAlive</span> entry points. Instead the Generic Application resource returns the process handle of the child application process back to Resource Monitor.  Therefore, the Resource Monitor process  must wait for the process handle. If the application fails, the process handle is signaled. This behavior indicates that the process has stopped. In this case, the Generic Application resource does not take five seconds to fail when the application fails. Instead, the Generic Application resource goes to a failed state immediately, even though the default value for the <span class='text-base'>LooksAlive</span> test is five seconds.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> test is the same as the <span class='text-base'>LooksAlive</span>  test in this context.<br></li></ul><h3 class='sbody-h3'>Generic Script resource (ClusRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The Generic Script resource type lets a developer implement a custom <span class='text-base'>LooksAlive </span>entry point by using a scripting language, such as Microsoft Visual Basic Scripting Edition (VBscript) or Jscript. The developer of the script must build the <span class='text-base'>LooksAlive</span> code in this scenario.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> test is the same as the <span class='text-base'>LooksAlive</span>  test in this context.<br></li></ul><h3 class='sbody-h3'>Distributed Transaction Coordinator resource (MTXClu.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The <span class='text-base'>LooksAlive</span> test for the Distributed Transaction Coordinator resource queries SCM to see whether the specified service is in a &quot;Running&quot; state.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> test is the same as the <span class='text-base'>LooksAlive</span>  test in this context.<br></li></ul></div><div class='kb-moreinformation-section section'><span class='text-base'>Note</span> When the <span class='text-base'>LooksAlive </span>function is used in the context of the Distributed Transaction Coordinator resource, the <span class='text-base'>QueryServiceStatus </span>function is actually used.<br><br></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Message Queuing resource  (MQClus.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The <span class='text-base'>LooksAlive</span> test for the Message Queuing resource queries SCM to see whether the corresponding Message Queuing cluster service is in a &quot;Running&quot; state.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> test is the same as the <span class='text-base'>LooksAlive</span>  test in this context.<br></li></ul></div><div class='kb-moreinformation-section section'><span class='text-base'>Note</span> When the <span class='text-base'>LooksAlive </span> function is used in the context of the Message Queuing resource, the <span class='text-base'> QueryServiceStatus</span> function is actually used.<br><br></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Message Queuing Triggers resource (MQTGClus.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The<span class='text-base'> LooksAlive</span> test for the Message Queuing Triggers resource queries SCM to see whether the corresponding Message Queuing Triggers cluster service is in a &quot;Running&quot; state.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> test is the same as the <span class='text-base'>LooksAlive</span>  test in this context.<br><br></li></ul></div><div class='kb-moreinformation-section section'><span class='text-base'>Note</span> When the <span class='text-base'>LooksAlive </span> function is used in the context of the Message Queuing Triggers resource, the <span class='text-base'>QueryServiceStatus</span> function is actually used.<br></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>WINS resource (ClNetRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The<span class='text-base'> LooksAlive</span> test for the Windows Internet Name Service (WINS) resource queries SCM to see whether the corresponding WINS service is in a &quot;Start Pending&quot; or &quot;Running&quot; state.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> test is the same as the <span class='text-base'>LooksAlive</span>  test in this context.<br><br></li></ul></div><div class='kb-moreinformation-section section'><span class='text-base'>Note</span> When the <span class='text-base'>LooksAlive </span> function is used in the context of the WINS resource, the <span class='text-base'>LooksAlive </span> function calls the <span class='text-base'>ResUtilVerifyService</span> utility function. This function calls the <span class='text-base'>QueryServiceStatus</span> function.<br></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>DHCP resource (ClNetRes.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The<span class='text-base'> LooksAlive</span> test for the Dynamic Host Configuration Protocol (DHCP)  resource queries SCM to see whether the corresponding DHCP service is in a &quot;Start Pending&quot; or &quot;Running&quot; state.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> test is the same as the <span class='text-base'>LooksAlive</span>  test in this context.<br><br></li></ul></div><div class='kb-moreinformation-section section'><span class='text-base'>Note</span> When the <span class='text-base'>LooksAlive</span> function is used in the context of the DHCP resource, the <span class='text-base'>LooksAlive </span> function calls the <span class='text-base'>ResUtilVerifyService</span> utility function. This function calls the <span class='text-base'>QueryServiceStatus</span> function.<br><br><br></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Volume Shadow Copy Service Task resource (VSSTask.DLL)</h3><ul class='sbody-free_list'><li><span class='text-base'>LooksAlive</span><br>The <span class='text-base'>LooksAlive </span>test for the Volume Shadow Copy Service Task resource verifies if the job is known to the Task Scheduler service.<br></li><li><span class='text-base'>IsAlive</span><br>The <span class='text-base'>IsAlive </span> test is the same as the <span class='text-base'>LooksAlive</span>  test in this context.<br><br></li></ul></div><div class='kb-securedata-section section'>Author: stevemat<br>Writer: Darryl Gittins V-DGit <br>Tech reviewer: EntireNet with preview to stevemat<br>Editor: v-crweb</div>