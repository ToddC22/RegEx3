<header><h1>HOW TO: Configure the SMTP Virtual Server for Message Delivery</h1></header><div class='kb-notice-section section'><a class='bookmark' id='toc'></a><h3 class='sbody-h3'>IN THIS TASK</h3><ul class='sbody-free_list'><li><a managed-link="" href='#1' target="" bookmark-id='1'>SUMMARY</a></li><li><ul class='sbody-free_list'><li><a managed-link="" href='#2' target="" bookmark-id='2'>Configure Retry Tries and Intervals</a></li><li><a managed-link="" href='#3' target="" bookmark-id='3'>Set the Message Hop Count</a></li><li><a managed-link="" href='#4' target="" bookmark-id='4'>Set the Masquerade Domain</a></li><li><a managed-link="" href='#5' target="" bookmark-id='5'>Set a Fully Qualified Domain Name</a></li><li><a managed-link="" href='#6' target="" bookmark-id='6'>Configure a Smart Host</a></li><li><a managed-link="" href='#7' target="" bookmark-id='7'>Enable a Reverse DNS Lookup</a></li></ul></li></ul><a class='bookmark' id='1'></a></div><div>After a connection has been opened and the receiving server has acknowledged that it is ready to receive data, messages can be transmitted for delivery. This step-by-step article describes how to deliver messages.<br><br><br><a class='bookmark' id='2'></a><h3 class='sbody-h3'>Configure Retry Tries and Intervals</h3>If a message cannot be delivered on the first try, the Microsoft Simple Mail Transport Protocol (SMTP) Service sends it again from the Queue directory after a specified time. You can set the interval between delivery tries and also designate the number of times to try to deliver a message. After the limit is reached, the non-delivery report (NDR) and messages are sent to the Badmail directory.<br><br><br>You can use these settings to increase your server output speed, but these settings affect outgoing messages only and have no effect on the rate at which other servers process incoming messages. To configure these settings, follow these steps:<br><br><ol class='sbody-num_list'><li>In the Microsoft Management Console (MMC), click to select the SMTP virtual server, and then click <span class='text-base'>Properties</span> on the <span class='text-base'>Action</span> menu. </li><li>Click the <span class='text-base'>Delivery</span> tab. </li><li>For <span class='text-base'>First retry interval (minutes)</span>, type a value for the time to try delivery before posting the first notification. The default is 15 minutes.</li><li>For <span class='text-base'>Second retry interval (minutes)</span>, type a value for the time to try delivery before posting the second notification. The default is 30 minutes, which is 30 minutes after the first retry interval.</li><li>For <span class='text-base'>Third retry interval (minutes</span>), type a value for the time to try delivery before posting the third notification. The default is 60 minutes, which is 60 minutes after the second retry interval. </li><li>For <span class='text-base'>Subsequent retry interval (minutes)</span>, type a value for the time to try delivery before posting a notification. The default is 240 minutes. </li></ol><a class='bookmark' id='3'></a><h3 class='sbody-h3'>Set the Message Hop Count</h3>When a message is delivered, it may be routed to a number of servers before it reaches its final destination. You can designate how many servers the message is permitted to pass through. This is named the hop count. To set the message hop count, follow these steps:<br><br><ol class='sbody-num_list'><li>In the MMC, click to select the SMTP virtual server, and then click <span class='text-base'>Properties</span> on the <span class='text-base'>Action</span> menu.</li><li>On the <span class='text-base'>Delivery</span> tab, click <span class='text-base'>Advanced</span> to open the <span class='text-base'>Advanced Delivery</span> dialog box. </li><li>For <span class='text-base'>Maximum hop count</span>, type a value for the number of hops a message can take between the source and destination servers. The default is 15 hops. </li></ol><span class='text-base'>NOTE:</span> After the hop count is set, the SMTP server counts the hops that are listed in the <span class='text-base'>Received</span> fields of the message header. When the number of <span class='text-base'>Received</span> fields exceeds the maximum hop count setting, the message is returned to the sender with an NDR.<br><br><br><br><a class='bookmark' id='4'></a><h3 class='sbody-h3'>Set the Masquerade Domain</h3>The masquerade domain replaces any local domain name that is used in any <span class='text-base'>Mail From</span> lines in the protocol. The replacement occurs on the first hop only. <br><br><ol class='sbody-num_list'><li>In the MMC, click to select the SMTP virtual server, and then click <span class='text-base'>Properties</span> on the <span class='text-base'>Action</span> menu. </li><li>On the <span class='text-base'>Delivery</span> tab, click <span class='text-base'>Advanced</span> to open the <span class='text-base'>Advanced Delivery</span> dialog box. </li><li>For <span class='text-base'>Masquerade domain</span>, type a domain name that you want to appear in message headers, instead of the actual name of the domain.</li></ol><span class='text-base'>NOTE</span>: All replies to such messages are routed through the SMTP virtual server that uses the masquerade domain.<br><br></div><div class='kb-securedata-section section'>The <span class='text-base'>Masquerade domain</span> feature only applies to the P1 (envelope) address and not the P2 (content) address.<br></div><div class='kb-summary-section section'><a class='bookmark' id='5'></a><h3 class='sbody-h3'>Set a Fully Qualified Domain Name</h3><br>At startup, the name that is designated on the <span class='text-base'>Network Identification</span> tab of the <span class='text-base'>System Properties</span> dialog box is automatically used for the fully qualified domain name (FQDN). If you change the name (either manually or by joining a Microsoft Windows 2000 domain), the new name is automatically used for the FQDN the next time the computer is restarted. You do not have to perform any action to update the FQDN for the virtual server.<br><br><br>To override the automatic use of the computer and domain names on the <span class='text-base'>Network Identification</span> tab, change the FQDN in the <span class='text-base'>Advanced Delivery</span> dialog box (this is accessed through the <span class='text-base'>Delivery</span> tab). The Microsoft SMTP Service can then use the designated name instead of the name that is specified on the <span class='text-base'>Network Identification</span> tab. To set the FQDN, follow these steps:<br><br><ol class='sbody-num_list'><li>In the MMC, click to select the SMTP virtual server, and then click <span class='text-base'>Properties</span> on the <span class='text-base'>Action</span> menu. </li><li>On the <span class='text-base'>Delivery</span> tab, click <span class='text-base'>Advanced</span> to open the <span class='text-base'>Advanced Delivery</span> dialog box.</li><li>For <span class='text-base'>Fully-qualified domain</span> name, type the FQDN.</li></ol><br><br><a class='bookmark' id='6'></a><h3 class='sbody-h3'>Configure a Smart Host</h3><br>You can route all outgoing messages for remote domains through a smart host instead of sending them directly to the domain. This permits you to route messages over a connection that may be more direct or less costly than other routes. The smart host is similar to the route domain option for remote domains. The difference is that after a smart host is designated, all outgoing messages are routed to that server. With a route domain, only messages for the remote domain are routed to a specific server. <br><br><br>If you set up a smart host, you can still designate a different route for a remote domain. The route domain setting overrides the smart host setting. To set up a smart host, follow these steps:<br><br><ol class='sbody-num_list'><li>In the MMC, click to select the SMTP virtual server, and then click <span class='text-base'>Properties</span> on the <span class='text-base'>Action</span> menu.</li><li>On the <span class='text-base'>Delivery</span> tab, click <span class='text-base'>Advanced</span> to open the <span class='text-base'>Advanced Delivery</span> dialog box.</li><li>In <span class='text-base'>Smart host</span>, type the name of the smart host server. You can type a string to represent a name, or you can type an IP address.</li><li>If you want the Microsoft SMTP Service to try to deliver remote messages directly before it forwards them to the smart host server, click to select the <span class='text-base'>Attempt direct delivery before sending to smart host</span> check box. The default is to send all remote messages to the smart host, not to try direct delivery.</li></ol><span class='text-base'>NOTE:</span> You can identify the smart host by the FQDN or by an IP address. Note that if you change the IP address, you must also change it on every virtual server. If you use an IP address, enclose it in brackets ([]) to increase system performance. Microsoft SMTP Service checks first for a server name, then an IP address. The brackets identify the value as an IP address, so the DNS lookup is bypassed.<br><br><br><br><a class='bookmark' id='7'></a><h3 class='sbody-h3'>Enable a Reverse DNS Lookup</h3><br>If you select this option, Microsoft SMTP Service tries to verify that the IP address of the client matches the host or domain that is submitted by the client in the EHLO or HELO command. <br><br><br><span class='text-base'>NOTE:</span> Because this feature verifies addresses for all incoming messages, its use can affect Microsoft SMTP Service performance. Clear the check box to disable the feature.<br><br>If the reverse DNS lookup is successful, the Received header remains intact. If the verification is unsuccessful, &quot;unverified&quot; appears after the IP address in the Received header of the message. To enable reverse DNS lookup, follow these steps:<br><br><ol class='sbody-num_list'><li>In the MMC, click to select the SMTP virtual server, and then click <span class='text-base'>Properties</span> on the <span class='text-base'>Action</span> menu.</li><li>On the <span class='text-base'>Delivery</span> tab, click <span class='text-base'>Advanced</span> to open the <span class='text-base'>Advanced Delivery</span> dialog box.</li><li>Click to select the <span class='text-base'>Perform reverse DNS lookup on incoming messages</span> check box. </li></ol></div><div class='kb-textlegacy-section section'>DOC INFO: Author is: choople Author: CHOOPLE (2001-07-11T10:12:00) Edit Reviewer: V-SYLVAN (2002-06-07T14:20:00) Tech Reviewer: dankel (2002-06-05T12:29:00)<br></div>