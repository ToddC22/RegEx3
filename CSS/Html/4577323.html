<header><h1>Important log analytic files for SCEP deployment with Microsoft Intune</h1></header><span asset="4476087" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4476087]</span><ul><li><strong>Content Idea (CI): </strong><a managed-link="" href="https://aka.ms/CIEdit?id=121786" target="" data-content-type="" data-content-id="" bookmark-id="">121786</a></li></ul><p><strong>Support Topic: </strong><ul><li>Azure\Microsoft Intune</li></ul></p><div><h1 style="margin:12pt 0in 0in;font-size:16pt;font-family:&quot;Calibri Light&quot;, sans-serif;color:rgb(47, 84, 150);font-weight:normal;"><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;"><div style="margin:0px 0in 10.6667px;text-align:justify;"><div style="margin:0px 0in 10.6667px;"></div></div></div></h1><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-justify:inter-ideograph;">SCEP
certificate deployment is one of the most challenging and complicated scenarios
when working with Microsoft Intune. The process requires in-depth knowledge of
many components both on-premise and on the cloud. Therefore, I have written a
step-by-step guide last year on how to set up the SCEP infrastructure for
Intune: <a href="https://techcommunity.microsoft.com/t5/intune-customer-success/support-tip-how-to-configure-ndes-for-scep-certificate/ba-p/455125">https://techcommunity.microsoft.com/t5/intune-customer-success/support-tip-how-to-configure-ndes-for-scep-certificate/ba-p/455125</a>.</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-justify:inter-ideograph;">During
my day-to-day work with our clients on SCEP related issues, we regularly
request the customer to provide a large set of log files from various locations.
Hence, I am frequently asked by my clients why it is necessary to collect that
many diagnostics files and what kind of information these files provide. Today,
I would like to discuss on some important log files you can analyze when
working with SCEP deployment scenarios. I hope it will help you to better
understand the SCEP workflow and to empower our clients to actively perform log
analysis on their own.</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-justify:inter-ideograph;">When
talking about this topic, I’d like to break up the process into three parts:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;"><ol style="margin-bottom:0in;"><li>Overview of relevant log files and their
functions.</li><li>Tips to analyze log files.</li><li>Troubleshooting example.</li></ol><br></div><div style="margin:0px 0in 10.6667px;text-align:justify;"><div style="font-family:Calibri, sans-serif;font-size:11pt;"><b><u><span style="font-size:12.0pt;">Overview of relevant log files and
their functions</span></u></b><br></div></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><b><u>Server-side
logs</u></b></p><p style="margin:0in 0in 8pt 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;"><span><span>1.<span style="font:7.0pt &quot;Times New Roman&quot;;">&nbsp; &nbsp;</span></span></span><b>IIS server logs</b>: The SCEP deployment is
relying on the NDES role which is running on IIS. Therefore, the IIS logs
located in the <i><span>C:\inetpub\logs\LogFiles\W3SVC1</span></i><span> </span>directory of your
NDES server will usually be the first entry point when troubleshooting SCEP related
issues:</p><div style="margin:0px 0in 10.6667px 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-indent:-0.25in;">&nbsp; &nbsp; &nbsp; &nbsp;<span asset="4577300" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577300]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;margin-left:.5in;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;margin-left:.5in;text-align:justify;text-justify:inter-ideograph;">IIS logs will tell you immediately if the SCEP deployment succeeded
or failed. I will further discuss on this later in the blog post.</p><p style="margin:0in 0in 8pt 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;"><span><span>2.<span style="font:7.0pt &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><b>Event logs</b>: The application event logs of
your NDES server are another important information source for SCEP related scenarios.
Under <i>Windows Logs -&gt; Application</i> we can filter relevant log entries according
to below event source (<i>Microsoft-Windows-NetworkDeviceEnrollmentService</i>):</p><p style="margin:0in 0in 8pt 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;">&nbsp; &nbsp; &nbsp; &nbsp;<span asset="4577301" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577301]</span></p><p style="margin:0in 0in 8pt 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;">&nbsp; &nbsp; &nbsp; &nbsp;<span asset="4577302" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577302]</span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;margin-left:.5in;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">Errors coming from this event source shall be certainly
further investigated.</p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">&nbsp;</p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;"><span><span>3.<span style="font:7.0pt &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><b>NDES plugin log</b>: The NDES server
communicates with the Intune cloud backend via the Intune Connector software
which needs to be installed on the NDES server. Further details on how to
properly install the connector can be found in this blog post:<br><br><a href="https://techcommunity.microsoft.com/t5/intune-customer-success/support-tip-how-to-configure-ndes-for-scep-certificate/ba-p/455125">https://techcommunity.microsoft.com/t5/intune-customer-success/support-tip-how-to-configure-ndes-for-scep-certificate/ba-p/455125</a>.<br><br>The Intune connector has an important log file stored under
the <i><span>C:\Program
Files\Microsoft Intune\NDESPolicyModule\Logs </span></i><span>directory which is the NDES plugin log. This log file provides
additional details on the activities seen in the IIS logs:</span></p><div style="margin:0px 0in 0px 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-indent:-0.25in;">&nbsp; &nbsp; &nbsp; &nbsp;<span asset="4577303" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577303]</span><br>&nbsp;</div><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;"><span><span>4.<span style="font:7.0pt &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><b>NDES connector log</b>: This log file is also
generated by the Intune Connector and is located under <i><span>C:\Program Files\Microsoft
Intune\NDESConnectorSvc\Logs\Logs</span></i><span>. You can see many connection- related information from this
analytic file which helps you to verify if the Intune Connector was able to
successfully establish the connection to the Intune cloud backend. The file
needs to be opened by <i>SvcTraceViewer</i> tool which is included in the
Windows 10 SDK (</span><a href="https://developer.microsoft.com/en-us/windows/downloads/windows-10-sdk/">https://developer.microsoft.com/en-us/windows/downloads/windows-10-sdk/</a><span>). <span>&nbsp;</span></span></p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;"><span><span><br></span></span></p><div style="margin:0px 0in 0px 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-indent:-0.25in;">&nbsp; &nbsp; &nbsp; &nbsp;<span asset="4577304" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577304]</span><br><br>Above is a screenshot of the log file opened with <i>SvcTraceViewer</i>.
Under the <i>Activity </i>tab, we can see the relevant log entries. The log
file could be named as e.g. <i>NDESConnector_2020-03-11_124317.</i></div><div style="margin:0px 0in 0px 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-indent:-0.25in;"><i><br></i><span>5.<span style="font-size:7pt;font-family:&quot;Times New Roman&quot;;">&nbsp; &nbsp;&nbsp;</span></span><b>CRP log</b><span>: The CRP (Certificate
Registration Point) log file includes the main part of the SCEP deployment activities.
It provides detailed information on the certificate deployment with all its
sub-steps. If IIS logs and NDES plugin log do not provide sufficient information,
this analytic file should be checked next. Similar to the NDES connector log,
it needs to be opened by </span><i>SvcTraceViewer </i><span>and is located under </span><i>C:\Program Files\Microsoft
Intune\NDESConnectorSvc\Logs\Logs. </i><span>The log file could be named as
e.g. </span><i>CertificateRegistrationPoint_2020-03-12_010230</i><span>.</span></div><div style="margin:0px 0in 0px 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-indent:-0.25in;"><span><br></span></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><b><u>Client-side
logs</u></b></p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;"><span><span>1.<span style="font:7.0pt &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><b>Event logs (for Windows 10)</b>: Please
navigate to <strong><i><span style="font-family:&quot;Calibri&quot;,sans-serif;color:black;background:white;font-weight:normal;">Applications and
Services Logs &gt; Microsoft &gt; Windows &gt;
DeviceManagement-Enterprise-Diagnostic-Provider</span></i></strong> which
includes all MDM related events. For SCEP scenarios, it is recommended to
filter the log file for Event IDs <i>32</i> and <i>307</i>. Below screenshot
shows an example if the SCEP deployment fails on the client device:</p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;">&nbsp; &nbsp; &nbsp; &nbsp;<span asset="4577305" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577305]</span></p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">&nbsp;</p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;"><span><span>2.<span style="font:7.0pt &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><b>Company portal logs (for Android)</b>: The
company portal logs are the Intune client logs for both Android and iOS
devices. Below video will show you how to collect the log files:<br><br><a href="https://www.youtube.com/watch?v=JdbVI7KHcFk">https://www.youtube.com/watch?v=JdbVI7KHcFk</a><br><br>The logs will be collected and sent as attachment to an email
address of your choice. When opening the attachment, you will see these files:</p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;">&nbsp; &nbsp; &nbsp; &nbsp;<span asset="4577306" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577306]</span><br><br>SCEP related log entries will be included in the <i>OMADMLog</i>
files.<br><br></p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;"><span><span>3.<span style="font:7.0pt &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><b>XCode logs (for iOS)</b>: Unfortunately, the
company portal logs for iOS devices do not provide as much information as those
for Android phones. Therefore, I would rather recommend to collect XCode logs in
case the SCEP deployment goes to iOS devices. You may refer to this doc for a
step-by-step guide on how to collect these log files: <a href="https://docs.microsoft.com/en-us/mem/intune/protect/troubleshoot-scep-certificate-profiles">https://docs.microsoft.com/en-us/mem/intune/protect/troubleshoot-scep-certificate-profiles</a>.</p><p style="margin:0in 0in 0in 0.5in;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;text-indent:-.25in;"><br></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">Now
as we have discussed what kind of analytic files are available for SCEP
scenarios, I’d also like to share some tips and best practices on how to
efficiently analyze these logs in the next chapter.</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">&nbsp;</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><b><u><span style="font-size:12.0pt;">Tips to analyze log files</span></u></b></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">The <b>IIS
logs</b> (<i><span>C:\inetpub\logs\LogFiles\W3SVC1</span></i>)
should be a good entry point for analyzing SCEP deployment. When you open the
log file, you will see below entries:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577307" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577307]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span style="font-size:12.0pt;"></span><span style="font-size:12.0pt;"></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">When
the client requests the SCEP certificate from the NDES server, the first two
operations are <i><span style="background:yellow;">GetCACert</span>
and <span style="background:yellow;">GetCACaps</span> </i>which
should succeed with return code <i><span style="background:yellow;">200</span></i>:</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;"><span style="font-size:10.0pt;font-family:Consolas;color:#171717;background:#F2F2F2;">fe80::f53d:89b8:c3e8:5fec%13 <span style="background:yellow;">GET
/certsrv/mscep/mscep.dll/pkiclient.exe operation=GetCACaps&amp;message</span>=default
80 - fe80::f53d:89b8:c3e8:5fec%13 Mozilla/4.0+(compatible;+Win32;+NDES+client)
- <span style="background:yellow;">200 0 0 186 0</span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;"><span style="font-size:10.0pt;font-family:Consolas;color:#171717;background:#F2F2F2;">fe80::f53d:89b8:c3e8:5fec%13 <span style="background:yellow;">GET
/certsrv/mscep/mscep.dll/pkiclient.exe operation=GetCACert&amp;message</span>=default
80 - fe80::f53d:89b8:c3e8:5fec%13 Mozilla/4.0+(compatible;+Win32;+NDES+client)
- <span style="background:yellow;">200 0 0 3567 0</span></span><span style="font-size:12.0pt;"></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">During
these steps, NDES will verify if the client can successfully connect to the
NDES server. If this is not the case and the return code is e.g. <i>500</i>, we
need to confirm if the NDES server is reachable from public network. The below
document provides additional details on how to properly resolve connectivity
problems:</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><a href="https://docs.microsoft.com/en-us/mem/intune/protect/troubleshoot-scep-certificate-device-to-ndes">https://docs.microsoft.com/en-us/mem/intune/protect/troubleshoot-scep-certificate-device-to-ndes</a></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">Please
also pay attention if you can see the below two entries:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577308" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577308]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span style="font-size:12.0pt;"></span><span style="font-size:12.0pt;"></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">The <i><span style="background:yellow;">VerifyRequest</span> </i>(verifying
permissions and certificate template configurations) must return <i><span style="background:yellow;">201</span> </i>and the <i><span style="background:yellow;">Notify</span> </i>operation
(confirmation that the client device received the SCEP certificate successfully)<i></i>must return <i><span style="background:yellow;">204</span>.
</i>If these two operations return any other codes besides 201 and 204, we can
be sure that the SCEP deployment failed. The SCEP deployment also failed if you
do not see <i>VerifyRequest</i> and <i>Notify</i> operations in the log files
at all (this can happen if e.g. <i>GetCaCert</i> and<i> GetCACaps</i>
operations failed).</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">Please
refer to <a href="https://support.microsoft.com/en-us/help/943891/the-http-status-code-in-iis-7-0-iis-7-5-and-iis-8-0">https://support.microsoft.com/en-us/help/943891/the-http-status-code-in-iis-7-0-iis-7-5-and-iis-8-0</a>
for common IIS error codes and their causes.</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">Therefore,
IIS logs provide a good overview about the deployment process and we can always
verify if the SCEP deployment succeeded or not based on the return codes.
However, how can I relate these log entries with the other log files introduced
in the previous chapter if I want even more information?</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">The <b>NDES
plugin log</b> (<i><span>C:\Program
Files\Microsoft Intune\NDESPolicyModule\Logs</span></i>) provides a more
detailed view than the IIS logs and we can map the IIS entries to those entries
stored in NDES plugin log:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577309" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577309]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span style="font-size:12.0pt;"></span><span style="font-size:12.0pt;"></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">As
you can see from the above screenshot, both <i>VerifyRequest</i> and <i>Notify</i>
shall return <span style="background:yellow;">0x0</span>
and the verify challenge shall return the value <i><span style="background:yellow;">true</span></i> if the SCEP deployment succeeded
without issues. The 0x0 return code in NDES plugin log is the equivalent to the
201 return code for <i>VerifyRequest</i> and 204 return code for <i>Notify</i>.</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577310" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577310]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span style="font-size:12.0pt;"></span><span style="font-size:12.0pt;"></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">You
might have noted that the log file includes the entry <i>‘Sending request to
certificate registration point’</i>. The certificate registration point is the
component of the NDES server which handles the <i>VerifyRequest </i>and <i>Notify
</i>operations and therefore, the next step is to check the <b>CRP log </b>located
in <i><span>C:\Program
Files\Microsoft Intune\NDESConnectorSvc\Logs\Logs.</span></i></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><b><u><span>Note</span></u></b><span>: If you do not find the log
file (named e.g. <i>CertificateRegistrationPoint_2020-03-11_051139</i>) at all that
means that the certificate request did not reach the </span>certificate
registration point. A common cause for this is if you have not correctly
configured the client/server SSL authentication certificates. I would recommend
you to go through the article <a href="https://techcommunity.microsoft.com/t5/intune-customer-success/support-tip-how-to-configure-ndes-for-scep-certificate/ba-p/455125">https://techcommunity.microsoft.com/t5/intune-customer-success/support-tip-how-to-configure-ndes-for-scep-certificate/ba-p/455125</a>
again and verify if the NDES server is correctly set up.</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">The
CRP log content could look similar to below screenshot:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577311" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577311]</span><br></div><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577312" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577312]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">As
you can see the CRP log also notes down if the <i>VerifyRequest</i> or <i>Notify</i>
operation finished successfully but with way more information compared to the
other log files. For example, the log also notes down which user and which
device is involved in the certificate request:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577313" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577313]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">You
can then paste this user ID into your Azure AD portal to find out which exact
user has requested the certificate:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577314" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577314]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">If
anything goes wrong during the deployment process, we will see errors marked in
red:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577315" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577315]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">As a
result of this, the <i>VerifyRequest </i>finished with status <i>False</i>.</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">In
many situations, you could also encounter connection related issues e.g. the
Intune Connector software was not able to connect to our Intune cloud backend. The
<b>NDES connector log </b>(<i><span>C:\Program
Files\Microsoft Intune\NDESConnectorSvc\Logs\Logs</span></i>)<b> </b>logs down
all connection activities:</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span><span asset="4577316" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577316]</span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span>You
can see from above screenshot that all backend URLs will be logged and
therefore, if any errors come up when the connector tries to access these URLs,
it is a good idea to review your Internet as well as you proxy/firewall settings.
The below document provides additional details on Intune network endpoints for needed
for proxy/firewall settings:</span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><a href="https://docs.microsoft.com/en-us/mem/intune/fundamentals/intune-endpoints">https://docs.microsoft.com/en-us/mem/intune/fundamentals/intune-endpoints</a></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">Let
me now share with you a recent SCEP issue we encountered and how we fixed the
problem by analyzing the log files mentioned in this article.</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><br></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><b><u><span style="font-size:12.0pt;"></span></u></b></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><b><u><span style="font-size:12.0pt;"></span></u></b></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><b><u><span style="font-size:12.0pt;"></span></u></b></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><b><u><span style="font-size:12.0pt;"></span></u></b></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><b><u><span style="font-size:12.0pt;"></span></u></b></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><b><u><span style="font-size:12.0pt;">Troubleshooting sample</span></u></b></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">I
recently worked with a client who faced a complex issue while deploying SCEP
certificates. The client configured a SCEP profile on Intune but the deployment
of this profile failed on all devices. As a first step, we checked the client’s
<b>NDES plugin log</b> and found below entries:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577317" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577317]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">The <i>VerifyRequest
</i>returned <i>false </i>so we could already conclude that some
pre-requirements have not been met. We further analyzed the <b>CRP log </b>and
identified below error during the <i>VerifyRequest </i>operation:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577318" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577318]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">The Intune
Connector was not able to retrieve the <i>CN={{OnPrem</i>_<i>Distinguished_Name}}</i>
property from the Intune backend. Therefore, we first verified the client’s
configuration of his SCEP certificate profile on Intune. We realized that he selected
<i>CN={{OnPrem</i>_<i>Distinguished_Name}}</i> for the certificate’s subject
name format:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577319" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577319]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><u>Note</u>:
<span>The </span><i>CN={{OnPrem</i>_<i>Distinguished_Name}}</i><span>property
is <span style="color:#171717;background:white;">a sequence of relative
distinguished names separated by comma, such as </span><em><span style="font-family:&quot;Calibri&quot;,sans-serif;color:#171717;">CN=Jane
Doe,OU=UserAccounts,DC=corp,DC=contoso,DC=com</span></em><span style="color:#171717;background:white;">. These values are obtained from the
clients local AD which means that they need to be properly synched to Azure AD
so that Intune can query them</span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">Afterwards,
we performed a test and changed the subject name format to <i><span style="color:#171717;background:white;">CN={{UserName}} </span></i><span style="color:#171717;background:white;">and the
issue disappeared immediately. This helped us to confirm that the issue was
related to the subject name format and that the client’s SCEP infrastructure
has no issues in general.</span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span style="color:#171717;background:white;">Armed with this information, we further analyzed the CRP log and
found another entry about the subject name:</span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span style="color:#171717;background:white;"><span asset="4577320" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577320]</span><br></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">Obviously,
this is the subject name value which was passed to the Intune Connector. Therefore,
we further read through our official docs to verify if the passed value is in
the correct format and we found this article:</p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><a href="https://docs.microsoft.com/ja-jp/mem/intune/protect/certificates-profile-scep#avoid-certificate-signing-requests-with-escaped-special-characters">https://docs.microsoft.com/ja-jp/mem/intune/protect/certificates-profile-scep#avoid-certificate-signing-requests-with-escaped-special-characters</a></p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577321" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577321]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">We
verified that the subject name value indeed included an escaped character (‘<span style="background:yellow;">,</span>’) and a backslash:</p><div style="margin:0px 0in 10.6667px;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;"><span asset="4577322" contenteditable="false" unselectable="on" props="{&#34;size&#34;:&#34;full&#34;}">[Asset 4577322]</span><br></div><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span></span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-justify:inter-ideograph;">After
we explained the root cause to the client, he accepted to use <i><span style="color:#171717;background:white;">CN={{UserName}} </span></i><span style="color:#171717;background:white;">as his
subject name format as he was not willing to change the value on his local AD. </span></p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-justify:inter-ideograph;"><span style="color:#171717;background:white;">Below are some helpful links on the SCEP deployment topic for
your reference:</span></p><ul style="margin-bottom:0in;"><li><span style="color:#171717;background:white;">How to build up
your NDES infrastructure: </span><a href="https://techcommunity.microsoft.com/t5/intune-customer-success/support-tip-how-to-configure-ndes-for-scep-certificate/ba-p/455125"><span style="background:white;">https://techcommunity.microsoft.com/t5/intune-customer-success/support-tip-how-to-configure-ndes-for-scep-certificate/ba-p/455125</span></a><span style="color:#171717;background:white;">. </span></li><li><span style="color:#171717;background:white;">How to
troubleshoot SCEP related issues: </span><a href="https://docs.microsoft.com/en-us/mem/intune/protect/troubleshoot-scep-certificate-device-to-ndes"><span style="background:white;">https://docs.microsoft.com/en-us/mem/intune/protect/troubleshoot-scep-certificate-device-to-ndes</span></a><span style="color:#171717;background:white;">.</span></li><li>Frequent IIS error codes: <a href="https://support.microsoft.com/en-us/help/943891/the-http-status-code-in-iis-7-0-iis-7-5-and-iis-8-0">https://support.microsoft.com/en-us/help/943891/the-http-status-code-in-iis-7-0-iis-7-5-and-iis-8-0</a></li></ul><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;"><span style="color:#171717;background:white;"></span></p><br><p><p style="margin:0in 0in 8pt;text-align:justify;"><span><br></span></p><p><p style="margin:0in 0in 8pt;font-size:11pt;font-family:Calibri, sans-serif;text-align:justify;text-justify:inter-ideograph;">&nbsp;</p><br></div><div>(This section intentionally left blank)</div>