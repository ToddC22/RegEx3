<header><h1>How to use Group Policy to audit registry keys in Windows Server 2003</h1></header><div><span></span></div><div class='kb-securedata-section section'>DO NOT DELETE OR ARCHIVE THIS ARTICLE<br>This article is referenced by TechNet.<br>Contact the Content Business Manager for this product if you have any questions.</div><div class='kb-securedata-section section'><a managed-link="" href='#11' target="" bookmark-id='11'>REFERENCES</a></div><div class='kb-notice-section section'><span>For a Microsoft Windows 2000 version of this article, see<br> <a id='kb-link-1' href='/EN-US/help/315416'>315416 </a>. <br></span><a class='bookmark' id='toc'></a><h3 class='sbody-h3'>IN THIS TASK</h3><ul class='sbody-free_list'><li><a managed-link="" href='#1' target="" bookmark-id='1'>SUMMARY</a><ul class='sbody-free_list'><li><a managed-link="" href='#2' target="" bookmark-id='2'>Create a Group Policy Object</a></li><li><a managed-link="" href='#3' target="" bookmark-id='3'>Turn On Auditing in Group Policy</a><ul class='sbody-free_list'><li><a managed-link="" href='#4' target="" bookmark-id='4'> Turn On Auditing on a Domain Controller</a></li><li><a managed-link="" href='#5' target="" bookmark-id='5'> Turn On Auditing on a Computer That Is Not a Member of a Domain</a></li></ul></li><li><a managed-link="" href='#6' target="" bookmark-id='6'> Audit a Registry Key</a></li><li><a managed-link="" href='#7' target="" bookmark-id='7'> Use a Security Template to Audit Registry Keys</a><ul class='sbody-free_list'><li><a managed-link="" href='#8' target="" bookmark-id='8'> Create a Security Template</a></li><li><a managed-link="" href='#9' target="" bookmark-id='9'> Apply the Security Template</a></li></ul></li><li><a managed-link="" href='#10' target="" bookmark-id='10'>Troubleshooting</a></li></ul></li></ul><a class='bookmark' id='1'></a></div><div> This article describes how to use Group Policy to configure auditing of Windows registry keys. <br><br><h3 class='sbody-h3'><a class='bookmark' id='2'></a>Create a Group Policy Object</h3> To create a Group Policy object (GPO) that you can use to turn on auditing in a domain, follow these steps: <br> <ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, point to <span class='text-base'>Administrative Tools</span>, and then click <strong class='uiterm'>Active Directory Users and Computers</strong>.</li><li>Right-click your domain, and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Group Policy</span> tab, and then click <span class='text-base'>New</span>.</li><li>Type the name that you want to use for this policy (for example, <span class='sbody-userinput'>Enable auditing policy</span>), and then press ENTER.</li><li>Click <span class='text-base'>Properties</span>, and then click the <span class='text-base'>Security</span> tab.</li><li>Click to clear the <span class='text-base'>Allow</span> check box next to <span class='text-base'>Apply Group Policy</span> for the security groups that you want to prevent from having this policy applied.</li><li>Click to select the <span class='text-base'>Allow</span> check box next to <span class='text-base'>Apply Group Policy</span> for the groups to which you want to apply this policy, and then click <span class='text-base'>OK</span>.</li><li>Click <span class='text-base'>OK</span>, click <span class='text-base'>OK</span> again, and then quit Active Directory Users and Computers.</li></ol><h3 class='sbody-h3'><a class='bookmark' id='3'></a>Turn On Auditing in Group Policy</h3> If auditing is not already turned on, you must turn it on. In a domain, turn on auditing in a GPO that is linked to the domain. On either a server or a workstation that is not a member of the domain, turn on auditing in a local GPO. <br><br><h4 class='sbody-h4'><a class='bookmark' id='4'></a>Turn On Auditing on a Domain Controller</h4><ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, point to <span class='text-base'>Administrative Tools</span>, and then click <strong class='uiterm'>Active Directory Users and Computers</strong>.</li><li>Right-click your domain, and then click <span class='text-base'>Properties</span>. </li><li>Click the <span class='text-base'>Group Policy</span> tab, click the Group Policy object that you want to use, and then click <span class='text-base'>Edit</span>.</li><li>Under <span class='text-base'>Computer Configuration</span>, expand <span class='text-base'>Windows  Settings</span>, expand <span class='text-base'>Security Settings</span>, expand <span class='text-base'>Local Policies</span>, and then click <span class='text-base'>Audit Policy</span>.</li><li>In the right pane, double-click <strong class='uiterm'>Audit object access</strong>.</li><li>Click to select the <strong class='uiterm'>Define these policy settings</strong> check box, click to select the <span class='text-base'>Success</span> check box, click to select the <span class='text-base'>Failure</span> check box, and then click <span class='text-base'>OK</span>.<br><br><span class='text-base'>NOTE</span>: The Audit object access policy setting is enough to turn on auditing for the Windows registry.</li><li>Quit the Group Policy Object Editor snap-in, and then click<br><span class='text-base'>Close</span>.</li></ol><h4 class='sbody-h4'><a class='bookmark' id='5'></a>Turn On Auditing on a Computer That Is Not a Member of a Domain</h4><ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, and then click <span class='text-base'>Run</span>.</li><li>In the <span class='text-base'>Open</span> box, type <span class='sbody-userinput'>gpedit.msc</span>, and then click <span class='text-base'>OK</span>.</li><li>Under <span class='text-base'>Computer Configuration</span>, expand <span class='text-base'>Windows  Settings</span>, expand <span class='text-base'>Security Settings</span>, expand <span class='text-base'>Local Policies</span>, and then click <span class='text-base'>Audit Policy</span>.</li><li>In the right pane, double-click <strong class='uiterm'>Audit object access</strong>.</li><li>Click to select the <span class='text-base'>Success</span> check box, click to select the <span class='text-base'>Failure</span> check box, and then click <span class='text-base'>OK</span>.<br><br><span class='text-base'>NOTE</span>: The Audit object access policy is enough to turn on auditing for the Windows registry.</li><li>Quit the Group Policy Object Editor snap-in.</li></ol><h3 class='sbody-h3'><a class='bookmark' id='6'></a>Audit a Registry Key</h3><span><span class='text-base'>Important</span> This section, method, or task contains steps that tell you how to modify the registry. However, serious problems might occur if you modify the registry incorrectly. Therefore, make sure that you follow these steps carefully. For added protection, back up the registry before you modify it. Then, you can restore the registry if a problem occurs. For more information about how to back up and restore the registry, click the following article number to view the article in the Microsoft Knowledge Base: <div class='indent'><a id='kb-link-2' href='/en-us/help/322756'>322756 </a> How to back up and restore the registry in Windows</div></span><ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, and then click <span class='text-base'>Run</span>.</li><li>In the <span class='text-base'>Open</span> box, type <span class='sbody-userinput'>regedit</span>, and then click <span class='text-base'>OK</span>.</li><li>Locate and click the registry key that you want to audit, for example:<br><br><span class='text-base'>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></li><li>On the <span class='text-base'>Edit</span> menu, click <span class='text-base'>Permissions</span>.</li><li>Click <span class='text-base'>Advanced</span>, click the <span class='text-base'>Auditing</span> tab, and then click <span class='text-base'>Add</span>.</li><li>Type the user account or group whose access to this registry key you want to audit, click <span class='text-base'>Check Names</span> to verify the name, and then click <span class='text-base'>OK</span>.</li><li>In the <strong class='uiterm'>Apply onto</strong> box, click the option that you want.</li><li>Click to select the <span class='text-base'>Successful</span> and <span class='text-base'>Failed</span> check boxes next to the following access types:<br><br><span class='text-base'>Set Value</span><br><span class='text-base'>Create Subkey</span></li><li>Click <span class='text-base'>OK</span>, and then click <span class='text-base'>OK</span>. <br><br> You may receive the following message:<br><br> The current Audit Policy for this computer does not have auditing turned on. If this computer receives audit policy from the domain, please ask a domain administrator to turn on auditing using Group Policy Editor. Otherwise, use the Local Computer Policy Editor to configure the audit policy locally on this computer. <br><br> If auditing is not turned on, you must turn it on by following the steps in the <a managed-link="" href='#3' target="" bookmark-id='3'>Turn On Auditing in Group Policy</a> section of this article. </li><li>Click <span class='text-base'>OK</span></li><li>Quit Registry Editor.</li></ol> Audit events are displayed in the Security log of Event Viewer.<br> <br><br><h3 class='sbody-h3'><a class='bookmark' id='7'></a>Use a Security Template to Audit Registry Keys</h3> You can also use a security template to audit registry keys. To configure the audit policy, either create a custom security template or modify an existing template, and then use Group Policy to apply this template to multiple computers in a domain or an organizational unit (OU).<br> <br><br><h4 class='sbody-h4'><a class='bookmark' id='8'></a>Create a Security Template</h4> To create a new security template or to modify an existing template, follow these steps: <br> <ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, and then click <span class='text-base'>Run</span>.</li><li>In the <span class='text-base'>Open</span> box, type <span class='sbody-userinput'>mmc</span>, and then click <span class='text-base'>OK</span>.</li><li>On the <span class='text-base'>File</span> menu, click <span class='text-base'>Add/Remove Snap-in</span>.</li><li>Click <span class='text-base'>Add</span>, click <span class='text-base'>Security Templates</span>, click <span class='text-base'>Add</span>, click <span class='text-base'>Close</span>, and then click <span class='text-base'>OK</span>.</li><li>In the console tree, expand <span class='text-base'>Security Templates</span>, and then expand <span class='text-base'><strong class='sbody-strong'>drive</strong>:\WINDOWS\Security\Templates</span>, where <strong class='sbody-strong'>drive</strong> is the drive on which Windows is installed.</li><li>Do one of the following:<br><ul class='sbody-free_list'><li>If you want to modify an existing template, expand the template that you want to use, for example, <span class='text-base'>hisecws</span> (high-security workstation template).<br></li><li>If you want to create a new security template, follow these steps: <br><ol class='sbody-alpha_list'><li>Right-click <span class='text-base'><strong class='sbody-strong'>drive</strong>:\WINDOWS\Security\Templates</span>, and then click <span class='text-base'>New Template</span>.</li><li> Type a name for the template in the<br> <strong class='uiterm'>Template name</strong> box, and then click <span class='text-base'>OK</span>.</li><li>Expand the new template that you created.</li></ol></li></ul></li><li>Right-click <span class='text-base'>Registry</span>, and then click <span class='text-base'>Add Key</span>.</li><li>In the <span class='text-base'>Registry</span> list, click the registry key that you want to use, and then click<br><span class='text-base'>OK</span>. For example:<br><br><span class='text-base'>MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></li><li>Click <span class='text-base'>Advanced</span>, click the <span class='text-base'>Auditing</span> tab, and then click <span class='text-base'>Add</span>.</li><li>Type the user account or group whose access to this registry key you want to audit, click <span class='text-base'>Check Names</span> to verify the name, and then click <span class='text-base'>OK</span>.</li><li>In the <strong class='uiterm'>Apply onto</strong> box, click the option that you want.</li><li>Click to select the <span class='text-base'>Successful</span> and <span class='text-base'>Failed</span> check boxes next to the type of access that you want to audit for either the selected user or the selected security group, and then click <span class='text-base'>OK</span>.<br><br> For example, click to select the <span class='text-base'>Successful</span> and <span class='text-base'>Failed</span> check boxes next to <span class='text-base'>Set Value</span>. </li><li>Click <span class='text-base'>OK</span>. <br><br> If you receive the following message, click <span class='text-base'>OK</span>:<br><br> The current Audit Policy for this computer does not have auditing turned on. If this computer receives audit policy from the domain, please ask a domain administrator to turn on auditing using Group Policy Editor. Otherwise, use the Local Computer Policy Editor to configure the audit policy locally on this computer. </li><li>Click <span class='text-base'>OK</span>, and then click <span class='text-base'>OK</span>.</li><li>Expand <span class='text-base'>Local Policies</span>, and then click <span class='text-base'>Audit Policy</span>.</li><li>In the right pane, double-click <strong class='uiterm'>Audit object access</strong></li><li>Click to select <strong class='uiterm'>Define these policy settings</strong> in the<strong class='uiterm'>  template</strong> check box, click to select the <span class='text-base'>Success</span> check box, click to select the <span class='text-base'>Failure</span> check box, and then click <span class='text-base'>OK</span>.<br><br><span class='text-base'>NOTE</span>: The Audit object access policy setting is enough to turn on auditing for the Windows registry.</li><li>Quit the Security Templates snap-in.</li><li>If a <span class='text-base'>Save Security Templates</span> dialog box is displayed, click <span class='text-base'>Yes</span> to save the custom security template that you created.</li></ol><h4 class='sbody-h4'><a class='bookmark' id='9'></a>Apply the Security Template</h4> Use Group Policy to apply the security template that contains the audit policy that you configured. To do so, follow these steps: <br> <ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, point to <span class='text-base'>Administrative Tools</span>, and then click <strong class='uiterm'>Active Directory Users and Computers</strong>.</li><li>Do one of the following:<br><ul class='sbody-free_list'><li>If you want to apply the security template to the whole domain, right-click the domain, and then click <span class='text-base'>Properties</span>. <br><br> -or-</li><li>If you want to apply the security templates to an organizational unit, expand the domain, right-click the organizational unit, and then click <span class='text-base'>Properties</span>. </li></ul></li><li>Create a GPO to use to apply the security template. To do so:<br><ol class='sbody-alpha_list'><li>Click the <span class='text-base'>Group Policy</span> tab.</li><li>Click <span class='text-base'>New</span>.</li><li>Type a name for the GPO in the <strong class='uiterm'>New Group Policy Object</strong> box (for example, <span class='sbody-userinput'>Apply Audit Policy Security Template</span>), and then press ENTER.</li></ol></li><li>Click <span class='text-base'>Edit</span>.</li><li>Under <span class='text-base'>Computer Configuration</span>, expand <span class='text-base'>Windows  Settings</span>, right-click <span class='text-base'>Security Settings</span>, and then click <span class='text-base'>Import Policy</span>.</li><li>Click the security template that you created, click to select the <strong class='uiterm'>Clear this database before importing</strong> check box, and then click <span class='text-base'>Open</span>.<br><br><span class='text-base'>NOTE</span>: When the <strong class='uiterm'>Clear this database before importing</strong>check box is selected, all of the security settings in the GPO are replaced with those of the security template that you import.</li><li>Quit the Group Policy Object Editor snap-in, and then click<br><span class='text-base'>Close</span>.</li><li>Quit Active Directory Users and Computers.</li></ol><h3 class='sbody-h3'><a class='bookmark' id='10'></a>Troubleshooting</h3> After you configure auditing, the service may not work. This behavior can occur for any of the following reasons: <br> <ul class='sbody-free_list'><li>A site, a domain, or an organizational unit policy setting overrides the audit policy that you configured. To troubleshoot this issue, follow these steps:<br><ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, and then click <span class='text-base'>Run</span>.</li><li>In the <span class='text-base'>Open</span> box, type <span class='sbody-userinput'>gpedit.msc</span>, and then click <span class='text-base'>OK</span>.</li><li>Under <span class='text-base'>Computer Configuration</span>, expand <span class='text-base'>Windows  Settings</span>, expand <span class='text-base'>Security Settings</span>, expand <span class='text-base'>Local Policies</span>, and then click <span class='text-base'>Audit Policy</span>.</li><li>In the right pane, view the item in the <span class='text-base'>Security Setting</span> column of the policy that you want to use.<br><br> If the security setting of the policy is <strong class='uiterm'>No auditing</strong>, a higher-level GPO may be overriding the audit policy setting that you configured. To confirm this behavior, view the higher-level GPO items that are linked to either the organizational unit or to the domain for possible conflicts. </li><li>Click to select the <strong class='uiterm'>Audit these attempts</strong> check box, click to select the <span class='text-base'>Success</span> check box, click to select the <span class='text-base'>Failure</span> check box, and then click <span class='text-base'>OK</span>.<br><br><span class='text-base'>NOTE</span>: The Audit object access policy setting is enough to turn on auditing for the Windows registry.</li><li>Quit the Group Policy Object Editor snap-in.</li></ol></li><li>A GPO that overrides the audit policy setting has a higher priority. To troubleshoot this issue, follow these steps:<br><ol class='sbody-num_list'><li>Click <span class='text-base'>Start</span>, point to <span class='text-base'>Administrative Tools</span>, and then click <strong class='uiterm'>Active Directory Users and Computers</strong>.</li><li>In the console tree, right-click your domain, and then click <span class='text-base'>Properties</span>.</li><li>Click the <span class='text-base'>Group Policy</span> tab. View the <strong class='uiterm'>Group Policy Objects Links</strong> list.<br> <br><br> Items that are higher in the list override other lower-level items.</li><li>If the GPO that contains your audit policy setting is listed below a higher-priority GPO item that turns off auditing, do one of the following steps:<br><ul class='sbody-free_list'><li>Click the GPO that contains the audit policy setting that you want to use, and then click <span class='text-base'>Up</span> to move it above the higher-priority item in the list.<br><br><span class='text-base'>WARNING</span>: Make sure that other settings in your GPO do not conflict with the settings in the GPO items that are listed below it.<br><br>  -or-</li><li>Edit the GPO items that are listed above the GPO that contains the audit policy setting to remove conflicting policy settings.<br><br><span class='text-base'>NOTE</span>: You may want to combine the audit settings from one GPO with those of a higher-level GPO to resolve the audit policy conflict and to reduce the number of GPO items.</li></ul></li><li>When you are finished, click <span class='text-base'>OK</span>, and then click <span class='text-base'>Exit</span> on the <span class='text-base'>File</span> menu.</li></ol></li><li>The site, the domain, or the organizational unit policy setting that contains the audit policy setting has not replicated to other computers. To resolve this issue, use the Secedit.exe command-line utility to force Group Policy to be refreshed. </li></ul></div><div class='kb-securedata-section section'><span class='text-base'>ClonePlaceholder</span><br><br><span class='text-base'>The following link to a Windows 2000 article is a placeholder only and should  be replaced with the appropriate link to the Windows Server 2003 clone after the clone is created.</span><br><br><span>For more information about using Secedit, click the following article number to view the article in the Microsoft Knowledge Base:<br><br><div class='indent'><a id='kb-link-4' href='/en-us/help/227302'>227302 </a> Using SECEDIT to force a Group Policy refresh immediately<br><br></div></span></div><div class='kb-summary-section section'><a class='bookmark' id='11'></a></div><div><span>For more information about using Group Policy, click the following article numbers to view the articles in the Microsoft Knowledge Base:<br><br><div class='indent'><a id='kb-link-5' href='/en-us/help/214752'>214752 </a> How to add custom registry settings to Security Configuration Editor<br><br></div></span></div><div class='kb-securedata-section section'><span class='text-base'>ClonePlaceholder</span><br><br><span class='text-base'>The following links to Windows 2000 articles are placeholders only and should  be replaced with the appropriate links to the Windows Server 2003 clone after (and if) the clones are created.</span><br><br><span><div class='indent'><a id='kb-link-13' href='/EN-US/help/220862'>220862 </a> Local Group Policy Settings Do Not Take Effect <br></div></span><span><div class='indent'><a id='kb-link-14' href='/EN-US/help/227448'>227448 </a> Using Secedit.exe to Force Group Policy to Be Applied Again <br></div></span><span>For more information about auditing, click the following article numbers to view the articles in the Microsoft Knowledge Base:<br><br><div class='indent'><a id='kb-link-15' href='/en-us/help/248260'>248260 </a> How to enable Local Security Auditing in Windows 2000 <br><br></div></span><span><div class='indent'><a id='kb-link-16' href='/en-us/help/234926'>234926 </a> Windows 2000 Security Templates are incremental <br><br></div></span><span><div class='indent'><a id='kb-link-17' href='/EN-US/help/299475'>299475 </a> Windows 2000 Security Event Descriptions (Part 1 of 2)<br></div></span><span><div class='indent'><a id='kb-link-18' href='/EN-US/help/301677'>301677 </a> Windows 2000 Security Event Descriptions (Part 2 of 2)<br></div></span><span><div class='indent'><a id='kb-link-19' href='/en-us/help/300549'>300549 </a> How to enable and apply security auditing in Windows 2000<br><br></div></span></div><div class='kb-securedata-section section'>kbmgmtsvc</div><div class='kb-textlegacy-section section'>Author: V-CGLENN (2002-06-18T10:41:00) Edit Reviewer: V-DIANAG (2002-08-06T08:55:00) Tech Reviewer: JAMIRC (2002-08-05T07:49:00)<br> </div>