<header><h1>How to enable a Cisco IPSec VPN client to connect to a Cisco VPN concentrator through ISA Server 2000</h1></header><div class='kb-notice-section section'>DO NOT DELETE OR ARCHIVE THIS ARTICLE<br>This article is referenced by TechNet.<br>Contact the Content Business Manager for this product if you have any questions.</div><div class='kb-notice-section section'><a class='bookmark' id='toc'></a><h3 class='sbody-h3'>IN THIS TASK</h3><ul class='sbody-free_list'><li><a managed-link="" href='#1' target="" bookmark-id='1'>SUMMARY</a><ul class='sbody-free_list'><li><a managed-link="" href='#2' target="" bookmark-id='2'>Provide Support for the Cisco VPN Client</a><ul class='sbody-free_list'><li><a managed-link="" href='#3' target="" bookmark-id='3'>Create the Protocol Definitions</a></li><li><a managed-link="" href='#4' target="" bookmark-id='4'>Create a Protocol Rule</a></li></ul></li></ul></li><li><a managed-link="" href='#5' target="" bookmark-id='5'>REFERENCES</a></li></ul><a class='bookmark' id='1'></a></div><div class='kb-summary-section section'>This step-by-step article describes how to enable a Cisco Systems virtual private network (VPN) client computer using the IPSec protocol, on the internal network, to connect to an external Cisco VPN Concentrator using the &quot;transparent tunneling&quot; feature through Microsoft Internet Security and Acceleration Server 2000.<br><br><a managed-link="" href='#toc' target="" bookmark-id='toc'>back to the top</a><h3 class='sbody-h3'><a class='bookmark' id='2'></a>Provide Support for the Cisco VPN Client</h3>In most cases, IPSec VPN traffic does not pass through ISA Server 2000. However, Cisco Concentrator 3300, with the latest firmware updates, uses &quot;transparent tunneling&quot; that uses User Datagram Protocol (UDP) ports 500, 4500, and 10000 to communicate securely between VPN clients and concentrators.<br><br>To provide support for this configuration, create the following protocol definitions:<br><br><span class='text-base'>Note</span> The client computer must be configured as a SecureNat client.<div class='indent'>Port number: <span class='sbody-userinput'>500</span><br>Protocol type: <strong class='uiterm'>UDP</strong><br>Direction: <strong class='uiterm'>Send Receive</strong><br><br>Port number: <span class='sbody-userinput'>4500</span><br>Protocol type: <strong class='uiterm'>UDP</strong><br>Direction: <strong class='uiterm'>Send Receive</strong><br><br>Port number: <span class='sbody-userinput'>10000</span><br>Protocol type: <strong class='uiterm'>UDP</strong><br>Direction: <strong class='uiterm'>Send Recieve</strong></div><br><br><br>By creating these protocol definitions, you enable the SecureNat client to connect to the Cisco VPN server through ISA Server as all traffic is passed as UDP traffic. According to the Cisco Transparent tunneling technology, this traffic can traverse Network Address Translation (NAT) firewalls.<br><br><span class='text-base'>Note</span> You must make sure that your Access Policy permits these three custom protocols. <br><br><a managed-link="" href='#toc' target="" bookmark-id='toc'>back to the top</a><h4 class='sbody-h4'><a class='bookmark' id='3'></a>Create the Protocol Definitions</h4>Create the new custom protocols to enable the transparent tunneling feature. To do so, follow these steps: <br> <ol class='sbody-num_list'><li>Start the ISA Management snap-in. To do so, click<br><strong class='uiterm'>Start</strong>, point to <strong class='uiterm'>Programs</strong>, point to<br><strong class='uiterm'>Microsoft ISA Server</strong>, and then click <strong class='uiterm'>ISA Management</strong>.</li><li> Under <strong class='uiterm'>Policy Elements</strong>, locate the<br><strong class='uiterm'>Protocol Definitions</strong> container.</li><li>Right-click <strong class='uiterm'>Protocol Definitions</strong>, point to<br><strong class='uiterm'>New</strong>, and then click <strong class='uiterm'>Definition</strong>.</li><li>In the <strong class='uiterm'>Protocol definition name</strong> box, type a descriptive name for the definition (for example, type <span class='sbody-userinput'>Port 500 UDP Send Receive</span>), and then click <strong class='uiterm'>Next</strong>.<br></li><li>In the <strong class='uiterm'>Port number</strong> box, type<br><span class='sbody-userinput'>500</span>. In the <strong class='uiterm'>Protocol type</strong> list, click<br><strong class='uiterm'>UDP</strong>. In the <strong class='uiterm'>Direction</strong> list, click<br><strong class='uiterm'>Send Receive</strong> (do not click <strong class='uiterm'>Receive Send</strong>), and then click <strong class='uiterm'>Next</strong>.</li><li>Under <strong class='uiterm'>Do you want to use Secondary connections?</strong>, click <strong class='uiterm'>No</strong>, and then click<br><strong class='uiterm'>Next</strong>.</li><li>Confirm your settings, and then click<br><strong class='uiterm'>Finish</strong>.</li><li>In the left pane, right-click <strong class='uiterm'>Protocol Definitions</strong>, point to <strong class='uiterm'>New</strong>, and then click<br><strong class='uiterm'>Definition</strong>.</li><li>In the <strong class='uiterm'>Protocol definition name</strong> box, type a descriptive name for the definition (for example, type <span class='sbody-userinput'>Port 4500 UDP Send Receive</span>), and then click <strong class='uiterm'>Next</strong>.<br></li><li>In the <strong class='uiterm'>Port number</strong> box, type<br><span class='sbody-userinput'>4500</span>. In the <strong class='uiterm'>Protocol type</strong> list, click<br><strong class='uiterm'>UDP</strong>. In the <strong class='uiterm'>Direction</strong> list, click<br><strong class='uiterm'>Send Receive</strong> (do not click <strong class='uiterm'>Receive Send</strong>), and then click <strong class='uiterm'>Next</strong>.</li><li>Under <strong class='uiterm'>Do you want to use Secondary connections?</strong>, click <strong class='uiterm'>No</strong>, and then click<br><strong class='uiterm'>Next</strong>.</li><li>Confirm your settings, and then click<br><strong class='uiterm'>Finish</strong>.</li><li>Repeat the steps above to create the protocol using a value of 10000 in steps 9 and 10. </li></ol>The new custom protocols are listed in the right pane under<br> <strong class='uiterm'>Available Protocols</strong>.<br><br><a managed-link="" href='#toc' target="" bookmark-id='toc'>back to the top</a><h4 class='sbody-h4'><a class='bookmark' id='4'></a>Create a Protocol Rule</h4>Create a protocol rule to allow access using the new custom protocols that you created. To do so, follow these steps: <br> <ol class='sbody-num_list'><li>Start the ISA Management snap-in. To do this, click<br><strong class='uiterm'>Start</strong>, point to <strong class='uiterm'>Programs</strong>, point to<br><strong class='uiterm'>Microsoft ISA Server</strong>, and then click <strong class='uiterm'>ISA Management</strong>.</li><li>Under <strong class='uiterm'>Access Policy</strong>, locate to the<br><strong class='uiterm'>Protocol Rules</strong> container.</li><li>Right-click <strong class='uiterm'>Protocol Rules</strong>, point to<br><strong class='uiterm'>New</strong>, and then click <strong class='uiterm'>Rule</strong>.</li><li>In the <strong class='uiterm'>Protocol rule name</strong> box, type a name for the rule (for example, type <span class='sbody-userinput'>Allow Cisco IPSec VPN Client</span>), and then click <strong class='uiterm'>Next</strong>.</li><li>Click <strong class='uiterm'>Allow</strong>, and then click<br><strong class='uiterm'>Next</strong>.</li><li>In the <strong class='uiterm'>Apply this rule to</strong> list, click<br><strong class='uiterm'>Selected protocols</strong>.</li><li>In the <strong class='uiterm'>Protocols</strong> list, click to select the check boxes that correspond to the three custom protocols that you created earlier, and then click <strong class='uiterm'>Next</strong>.</li><li>In the <strong class='uiterm'>Use this schedule</strong> list, click the schedule that you want to use when allowing these protocols (for example, click<br><strong class='uiterm'>Work hours</strong>), and then click <strong class='uiterm'>Next</strong>.</li><li>Under <strong class='uiterm'>Apply the rule to requests from</strong>, click <strong class='uiterm'>Any request</strong> (unless you want to restrict these protocols to certain client address sets), and then click <strong class='uiterm'>Next</strong>.<br></li><li>Confirm the configuration selections, and then click<br><strong class='uiterm'>Finish</strong>.</li></ol>The new protocol rule is listed under <strong class='uiterm'>Available Protocol Rules</strong> in the right pane.<br><br><span class='text-base'>Note</span>  After you perform the steps to add UDP Port 10000 as a protocol definition, you may also have to add UDP port 20000 to be able to work with some of the newer Cisco VPN Concentrators. <br><br><span class='text-base'>Note</span> This article is designed for SecureNAT clients. You must remove the ISA Firewall client software. <br><br><a managed-link="" href='#toc' target="" bookmark-id='toc'>back to the top</a><a class='bookmark' id='5'></a></div><div class='kb-references-section section'>For information about how to obtain ISA Server 2000 Service Pack 1 (SP1), visit the following Microsoft Web site:<div class='indent'><a id='kb-link-1' href='http://technet.microsoft.com/en-us/library/cc750281.aspx' target='_self'>http://technet.microsoft.com/en-us/library/cc750281.aspx</a></div>For additional help and support with Microsoft Internet Security and Acceleration (ISA) Server, visit the following Microsoft Web site: <div class='indent'><a id='kb-link-2' href='http://www.microsoft.com/isaserver' target='_self'>http://www.microsoft.com/isaserver</a></div>For more information about ISA Server, visit the following non-Microsoft Web site:<div class='indent'><a id='kb-link-3' href='http://isaserver.org' target='_self'>http://www.isaserver.org</a></div>For additional information about Cisco Systems VPN devices, visit the following Cisco Web site:<div class='indent'><a id='kb-link-4' href='http://www.cisco.com/warp/public/44/jump/vpn_devices.shtml' target='_self'>http://www.cisco.com/warp/public/44/jump/vpn_devices.shtml</a></div><span> Microsoft provides third-party contact information to help you find technical support. This contact information may change without notice. Microsoft does not guarantee the accuracy of this third-party contact information. <br> </span><br><br><span> The third-party products that are discussed in this article are manufactured by companies that are independent of Microsoft. Microsoft makes no warranty, implied or otherwise, regarding the performance or reliability of these products. <br> </span><br><br><a managed-link="" href='#toc' target="" bookmark-id='toc'>back to the top</a></div><div class='kb-securedata-section section'>4500</div><div class='kb-securedata-section section'>Author: vicsin<br>Writer: v-deisle<br>Tech Reviewer:<br>  Editor: <br></div>