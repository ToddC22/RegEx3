<header><h1>The &quot;Win32_Service&quot; WMI class leaks memory in Windows Server 2008 R2 and in Windows 7</h1></header><div class='kb-notice-section section'>BUG #: <a href='http://bugcheck/bugs/ContentMaintenance/129810.asp' title='Link only available for Microsoft corporate network users' target='_blank'>129810 (Content Maintenance)</a>BUG #: <a href='http://bugcheck/bugs/WindowsSE/308917.asp' title='Link only available for Microsoft corporate network users' target='_blank'>308917 (Windows SE)</a></div><div class='kb-symptoms-section section'>Consider the following scenario:<br><ul class='sbody-free_list'><li>You have a computer that is running Windows Server 2008 R2 or Windows 7.</li><li>An application or a service uses the <span class='text-base'>Win32_Service</span> Windows Management Instrumentation (WMI) class to query some service information frequently.<br></li></ul>In this scenario, the memory usage of the Wmiprvse.exe process keeps increasing, and the system performance decreases. After a while, the system resources may be exhausted. Therefore, the applications or services that are running on the computer may stop working.</div><div class='kb-cause-section section'>This issue occurs because some allocated memory is not freed when you use the <span class='text-base'>Win32_Service</span> WMI class to query some service information.</div><div><h3 class='sbody-h3'>Hotfix information</h3><span> A supported hotfix is available from Microsoft. However, this hotfix is intended to correct only the problem that is described in this article. Apply this hotfix only to systems that are experiencing the problem described in this article. This hotfix might receive additional testing. Therefore, if you are not severely affected by this problem, we recommend that you wait for the next software update that contains this hotfix.<br><br>If the hotfix is available for download, there is a &quot;Hotfix download available&quot; section at the top of this Knowledge Base article. If this section does not appear, contact Microsoft Customer Service and Support to obtain the hotfix. <br><br><span class='text-base'>Note</span> If additional issues occur or if any troubleshooting is required, you might have to create a separate service request. The usual support costs will apply to additional support questions and issues that do not qualify for this specific hotfix. For a complete list of Microsoft Customer Service and Support telephone numbers or to create a separate service request, visit the following Microsoft Web site: <div class='indent'><a id='kb-link-1' href='/contactus/?ws=support' target='_self'>http://support.microsoft.com/contactus/?ws=support</a></div><span class='text-base'>Note</span> The &quot;Hotfix download available&quot; form displays the languages for which the hotfix is available. If you do not see your language, it is because a hotfix is not available for that language.</span><h4 class='sbody-h4'>Prerequisites</h4>To apply this hotfix, you must be running Windows 7 or Windows Server 2008 R2.<h4 class='sbody-h4'>Restart requirement</h4><span>You must restart the computer after you apply this hotfix.</span><h4 class='sbody-h4'>Hotfix replacement information</h4><span>This hotfix does not replace a previously released hotfix.</span><h4 class='sbody-h4'>File information</h4>The English (United States) version of this hotfix installs files that have the attributes that are listed in the following tables. The dates and the times for these files are listed in Coordinated Universal Time (UTC). The dates and the times for these files on your local computer are displayed in your local time together with your current daylight saving time (DST) bias. Additionally, the dates and the times may change when you perform certain operations on the files.<h5 class='sbody-h5 text-subtitle'>Windows 7 and Windows Server 2008 R2 file information notes<br></h5><span class='text-base'>Important</span> Windows 7 hotfixes and Windows Server 2008 R2 hotfixes are included in the same packages. However, hotfixes on the Hotfix Request page are listed under both operating systems. To request the hotfix package that applies to one or both operating systems, select the hotfix that is listed under &quot;Windows 7/Windows Server 2008 R2&quot; on the page. Always refer to the &quot;Applies To&quot; section in articles to determine the actual operating system that each hotfix applies to.<ul class='sbody-free_list'><li>The MANIFEST files (.manifest) and the MUM files (.mum) that are installed for each environment are <a managed-link="" href='#manifests1' target="" bookmark-id='manifests1'>listed separately</a> in the &quot;Additional file information for Windows Server 2008 R2 and for Windows 7&quot; section. MUM and MANIFEST files, and the associated security catalog (.cat) files, are extremely important to maintain the state of the updated components. The security catalog files, for which the attributes are not listed, are signed with a Microsoft digital signature.</li></ul><h5 class='sbody-h5 text-subtitle'>For all supported x86-based versions of Windows 7</h5><div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><th class='sbody-th'>File name</th><th class='sbody-th'>File version</th><th class='sbody-th'>File size</th><th class='sbody-th'>Date</th><th class='sbody-th'>Time</th><th class='sbody-th'>Platform</th></tr><tr class='sbody-tr'><td class='sbody-td'>Cimwin32.dll</td><td class='sbody-td'>6.1.7600.20683</td><td class='sbody-td'>1,340,928</td><td class='sbody-td'>03-Apr-2010</td><td class='sbody-td'>07:57</td><td class='sbody-td'>x86</td></tr></table></div><h5 class='sbody-h5 text-subtitle'>For all supported x64-based versions of Windows 7 and of Windows Server 2008 R2</h5><div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><th class='sbody-th'>File name</th><th class='sbody-th'>File version</th><th class='sbody-th'>File size</th><th class='sbody-th'>Date</th><th class='sbody-th'>Time</th><th class='sbody-th'>Platform</th></tr><tr class='sbody-tr'><td class='sbody-td'>Cimwin32.dll</td><td class='sbody-td'>6.1.7600.20683</td><td class='sbody-td'>2,055,168</td><td class='sbody-td'>03-Apr-2010</td><td class='sbody-td'>07:30</td><td class='sbody-td'>x64</td></tr></table></div><h5 class='sbody-h5 text-subtitle'>For all supported IA-64-based versions of Windows Server 2008 R2</h5><div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><th class='sbody-th'>File name</th><th class='sbody-th'>File version</th><th class='sbody-th'>File size</th><th class='sbody-th'>Date</th><th class='sbody-th'>Time</th><th class='sbody-th'>Platform</th></tr><tr class='sbody-tr'><td class='sbody-td'>Cimwin32.dll</td><td class='sbody-td'>6.1.7600.20683</td><td class='sbody-td'>4,279,808</td><td class='sbody-td'>03-Apr-2010</td><td class='sbody-td'>05:49</td><td class='sbody-td'>IA-64</td></tr></table></div><span></span></div><div class='kb-securedata-section section'>If this hotfix is not posted for public download (meaning a public URL for this hotfix is not provided in this article), distribution requires technical lead, escalation team member, or manager approval and the following information applies:<br><br><ul class='sbody-free_list'><li>To receive the hotfix, customers must be experiencing the bug that is mentioned in the &quot;Symptoms&quot; section.</li><li> You must track the customers you send this to and supply them with the next service pack when it becomes available (if a service pack is released).</li></ul>This hotfix is scheduled to be included with Windows 7 Service Pack 1 and with Windows Server 2008 R2 Service Pack 1.<br><br></div><div class='kb-securedata-section section'>The &quot;Resolution&quot; section states whether this hotfix is available as a hotfix or in the latest service pack. For comparison and testing, the original hotfix is available on the <a id='kb-link-3' href='http://hotfix' target='_self'>http://hotfix</a> Web site.<br></div><div class='kb-resolution-section section'><span></span></div><div class='kb-status-section section'><span>Microsoft has confirmed that this is a problem in the Microsoft products that are listed in the &quot;Applies to&quot; section.</span></div><div class='kb-moreinformation-section section'>More information about the <span class='text-base'>Win32_Service</span> class, visit the following Microsoft Web site: <br><a id='kb-link-4' href='http://msdn.microsoft.com/en-us/library/aa394418(vs.85).aspx' target='_self'>General information about the "Win32_Service" class</a><br><span>For more information about software update terminology, click the following article number to view the article in the Microsoft Knowledge Base:<br><br><div class='indent'><a id='kb-link-5' href='/en-us/help/824684'>824684 </a> Description of the standard terminology that is used to describe Microsoft software updates<br><br></div></span><h3 class='sbody-h3'>Additional file information</h3><a class='bookmark' id='manifests1'></a><h4 class='sbody-h4'>Additional file information for Windows 7 and for Windows Server 2008 R2</h4><h5 class='sbody-h5 text-subtitle'>Additional files for all supported x86-based versions of Windows 7</h5><div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File name</span></td><td class='sbody-td'>Update.mum</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File version</span></td><td class='sbody-td'>Not Applicable</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File size</span></td><td class='sbody-td'>1,618</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Date (UTC)</span></td><td class='sbody-td'>04-Apr-2010</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Time (UTC)</span></td><td class='sbody-td'>09:35</td></tr><tr class='sbody-tr'><td class='sbody-td'></td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File name</span></td><td class='sbody-td'>X86_95da8f7ab7af2c2510b2afb1afbdf646_31bf3856ad364e35_6.1.7600.20683_none_c478db6c920ad15f.manifest</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File version</span></td><td class='sbody-td'>Not Applicable</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File size</span></td><td class='sbody-td'>719</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Date (UTC)</span></td><td class='sbody-td'>04-Apr-2010</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Time (UTC)</span></td><td class='sbody-td'>09:35</td></tr><tr class='sbody-tr'><td class='sbody-td'></td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File name</span></td><td class='sbody-td'>X86_microsoft-windows-w..ovider-cimwin32-dll_31bf3856ad364e35_6.1.7600.20683_none_d008e7578082c860.manifest</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File version</span></td><td class='sbody-td'>Not Applicable</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File size</span></td><td class='sbody-td'>5,224</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Date (UTC)</span></td><td class='sbody-td'>03-Apr-2010</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Time (UTC)</span></td><td class='sbody-td'>08:30</td></tr><tr class='sbody-tr'><td class='sbody-td'></td></tr></table></div><h5 class='sbody-h5 text-subtitle'>Additional files for all supported x64-based versions of Windows 7 and of Windows Server 2008 R2</h5><div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File name</span></td><td class='sbody-td'>Amd64_5628fe11ac6c8448683a8ee03d7453f1_31bf3856ad364e35_6.1.7600.20683_none_d2d27d61538808a8.manifest</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File version</span></td><td class='sbody-td'>Not Applicable</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File size</span></td><td class='sbody-td'>723</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Date (UTC)</span></td><td class='sbody-td'>04-Apr-2010</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Time (UTC)</span></td><td class='sbody-td'>09:35</td></tr><tr class='sbody-tr'><td class='sbody-td'></td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File name</span></td><td class='sbody-td'>Amd64_microsoft-windows-w..ovider-cimwin32-dll_31bf3856ad364e35_6.1.7600.20683_none_2c2782db38e03996.manifest</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File version</span></td><td class='sbody-td'>Not Applicable</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File size</span></td><td class='sbody-td'>5,228</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Date (UTC)</span></td><td class='sbody-td'>03-Apr-2010</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Time (UTC)</span></td><td class='sbody-td'>09:31</td></tr><tr class='sbody-tr'><td class='sbody-td'></td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File name</span></td><td class='sbody-td'>Update.mum</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File version</span></td><td class='sbody-td'>Not Applicable</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File size</span></td><td class='sbody-td'>1,850</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Date (UTC)</span></td><td class='sbody-td'>04-Apr-2010</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Time (UTC)</span></td><td class='sbody-td'>09:35</td></tr><tr class='sbody-tr'><td class='sbody-td'></td></tr></table></div><h5 class='sbody-h5 text-subtitle'>Additional files for all supported IA-64-based versions of Windows Server 2008 R2</h5><div class='table-responsive'><table class='sbody-table table'><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File name</span></td><td class='sbody-td'>Ia64_29b7e4ed610d7351356872a91c830a8b_31bf3856ad364e35_6.1.7600.20683_none_bd34cf4385c389ca.manifest</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File version</span></td><td class='sbody-td'>Not Applicable</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File size</span></td><td class='sbody-td'>721</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Date (UTC)</span></td><td class='sbody-td'>04-Apr-2010</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Time (UTC)</span></td><td class='sbody-td'>09:35</td></tr><tr class='sbody-tr'><td class='sbody-td'></td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File name</span></td><td class='sbody-td'>Ia64_microsoft-windows-w..ovider-cimwin32-dll_31bf3856ad364e35_6.1.7600.20683_none_d00a8b4d8080d15c.manifest</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File version</span></td><td class='sbody-td'>Not Applicable</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File size</span></td><td class='sbody-td'>5,226</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Date (UTC)</span></td><td class='sbody-td'>03-Apr-2010</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Time (UTC)</span></td><td class='sbody-td'>09:24</td></tr><tr class='sbody-tr'><td class='sbody-td'></td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File name</span></td><td class='sbody-td'>Update.mum</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File version</span></td><td class='sbody-td'>Not Applicable</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>File size</span></td><td class='sbody-td'>1,684</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Date (UTC)</span></td><td class='sbody-td'>04-Apr-2010</td></tr><tr class='sbody-tr'><td class='sbody-td'><span class='text-base'>Time (UTC)</span></td><td class='sbody-td'>09:35</td></tr><tr class='sbody-tr'><td class='sbody-td'></td></tr></table></div></div><div class='kb-moreinformation-section section'><h3 class='sbody-h3'>Call stack information</h3>The following is the call stack when this issue occurs: <pre class='sbody-pre'><br><br>00: (0000000077c2ed2d) ntdll!RtlAllocateHeap+0x4d1bd <br>01: (000007fefe1f1332) msvcrt!malloc+0x70 <br>02: (000007fee67d1039) cimwin32!operator new+0x9 <br>03: (000007fee6863061) cimwin32!CWin32Service::LoadPropertyValuesWin2K+0x4a1 <br>04: (000007fee6862af4) cimwin32!CWin32Service::AddDynamicInstancesNT+0x200 <br>05: (000007fee6860e25) cimwin32!CWin32Service::ExecQuery+0x41 <br>06: (000007fef3dc58e4) framedynos!Provider::ExecuteQuery+0x88 <br>07: (000007fef3dc5692) framedynos!CWbemProviderGlue::ExecQueryAsync+0x392 <br>08: (00000000ffa62845) WmiPrvSE!CInterceptor_IWbemSyncProvider::Helper_ExecQueryAsync+0x544 <br>09: (00000000ffa625d5) WmiPrvSE!CInterceptor_IWbemSyncProvider::ExecQueryAsync+0x192 <br>10: (000007feffcbc7f5) rpcrt4!Invoke+0x65 <br>11: (000007feffcbb0b2) rpcrt4!NdrStubCall2+0x32a <br>12: (000007fefed1e175) ole32!CStdStubBuffer_Invoke+0x8b <br>13: (000007fef51ed36d) fastprox!CBaseStublet::Invoke+0x19 <br>14: (000007fefed1fc0d) ole32!SyncStubInvoke+0x5d <br>15: (000007fefed1fb83) ole32!StubInvoke+0xdb <br>16: (000007fefebbfd60) ole32!CCtxComChnl::ContextInvoke+0x190 <br>17: (000007fefed1fa22) ole32!AppInvoke+0xc2 <br>18: (000007fefed1f76b) ole32!ComInvokeWithLockAndIPID+0x52b <br>19: (000007fefed1ed6d) ole32!ThreadInvoke+0x30d <br>20: (000007feffcb9c24) rpcrt4!DispatchToStubInCNoAvrf+0x14 <br>21: (000007feffcb9d86) rpcrt4!RPC_INTERFACE::DispatchToStubWorker+0x146 <br>22: (000007feffcbc44b) rpcrt4!RPC_INTERFACE::DispatchToStub+0x9b <br>23: (000007feffcbc38b) rpcrt4!RPC_INTERFACE::DispatchToStubWithObject+0x5b <br>24: (000007feffcbc322) rpcrt4!LRPC_SCALL::DispatchRequest+0x422 <br>25: (000007feffcba11d) rpcrt4!LRPC_SCALL::HandleRequest+0x20d <br>26: (000007feffcc7ddf) rpcrt4!LRPC_ADDRESS::ProcessIO+0x3bf <br>27: (000007feffcc7995) rpcrt4!LrpcIoComplete+0xa5 <br>28: (0000000077bab43b) ntdll!TppAlpcpExecuteCallback+0x26b <br>29: (0000000077ba923f) ntdll!TppWorkerThread+0x3f8 <br>30: (000000007798f56d) kernel32!BaseThreadInitThunk+0xd <br>31: (0000000077bc3281) ntdll!RtlUserThreadStart+0x1d<br> </pre></div><div class='kb-securedata-section section'><span><div class='kb-securedata-section section'><span class='text-base'>Author: folkertb<br>Writer: v-stxu<br>Tech Reviewer: folkertb;stevenxu;v-yuluo;osajid; ryangal;thomasgs<br>Editor: v-lynan</span></div></span></div>